<!DOCTYPE html>

<html lang="en" data-content_root="../../../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>src.susie.ephemeris &#8212; Susie Sept. 2023 documentation</title>
    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=b86133f3" />
    <link rel="stylesheet" type="text/css" href="../../../_static/basic_mod.css?v=9b2032db" />
    <link rel="stylesheet" type="text/css" href="../../../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css?v=be8a1c11" />
    <script src="../../../_static/documentation_options.js?v=cc8b8c85"></script>
    <script src="../../../_static/doctools.js?v=9bcbadda"></script>
    <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../../_static/js/theme.js"></script>
    <script src="../../../_static/js/petite-vue.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
  </head><body data-dark_mode_code_blocks="true">

<div id="top_nav">
    

    <nav>
        
            
        

        <p id="toggle_sidebar">
            <a href="#" title="Toggle sidebar">|||</a>
        </p>
        <h1><a href="../../../index.html" title="Go to homepage">Susie Sept. 2023 documentation</a></h1>

        <a id="mode_toggle" href="#" @click.prevent="handleClick" :title="mode">
    <template v-if="mode == 'light'">
        <svg width="100%" height="100%" viewBox="0 0 79 80" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xml:space="preserve" style="fill-rule:evenodd;clip-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:2;"><g id="mode_light"><rect id="Bounds" x="0" y="-0" width="78.623" height="79.049" style="fill:none;"/><circle cx="39.311" cy="39.524" r="15.734" style="fill:#fff;"/><g id="beams"><g id="beam"><path id="beam1" serif:id="beam" d="M44.212,4.901c0,-2.705 -2.196,-4.901 -4.901,-4.901c-2.704,-0 -4.9,2.196 -4.9,4.901l-0,9.614c-0,2.705 2.196,4.901 4.9,4.901c2.705,0 4.901,-2.196 4.901,-4.901l0,-9.614Z" style="fill:#fff;"/></g><g id="beam2" serif:id="beam"><path id="beam3" serif:id="beam" d="M67.48,18.073c1.913,-1.912 1.913,-5.018 0,-6.931c-1.912,-1.912 -5.018,-1.912 -6.931,0l-6.798,6.799c-1.912,1.912 -1.912,5.018 0,6.931c1.913,1.912 5.018,1.912 6.931,-0l6.798,-6.799Z" style="fill:#fff;"/></g><g id="beam4" serif:id="beam"><path id="beam5" serif:id="beam" d="M25.728,61.108c1.912,-1.913 1.912,-5.018 -0,-6.931c-1.913,-1.913 -5.019,-1.913 -6.931,-0l-6.799,6.798c-1.912,1.913 -1.912,5.019 0,6.931c1.913,1.913 5.019,1.913 6.931,0l6.799,-6.798Z" style="fill:#fff;"/></g><g id="beam6" serif:id="beam"><path id="beam7" serif:id="beam" d="M60.682,54.177c-1.913,-1.913 -5.018,-1.913 -6.931,-0c-1.912,1.913 -1.912,5.018 0,6.931l6.798,6.798c1.913,1.913 5.019,1.913 6.931,0c1.913,-1.912 1.913,-5.018 0,-6.931l-6.798,-6.798Z" style="fill:#fff;"/></g><g id="beam8" serif:id="beam"><path id="beam9" serif:id="beam" d="M4.901,34.623c-2.705,0 -4.901,2.196 -4.901,4.901c0,2.705 2.196,4.901 4.901,4.901l9.614,0c2.705,0 4.901,-2.196 4.901,-4.901c0,-2.705 -2.196,-4.901 -4.901,-4.901l-9.614,0Z" style="fill:#fff;"/></g><g id="beam10" serif:id="beam"><path id="beam11" serif:id="beam" d="M44.212,64.534c0,-2.705 -2.196,-4.901 -4.901,-4.901c-2.704,-0 -4.9,2.196 -4.9,4.901l-0,9.614c-0,2.705 2.196,4.901 4.9,4.901c2.705,-0 4.901,-2.196 4.901,-4.901l0,-9.614Z" style="fill:#fff;"/></g><g id="beam12" serif:id="beam"><path id="beam13" serif:id="beam" d="M18.929,11.142c-1.912,-1.912 -5.018,-1.912 -6.931,0c-1.912,1.913 -1.912,5.019 0,6.931l6.799,6.799c1.912,1.912 5.018,1.912 6.931,-0c1.912,-1.913 1.912,-5.019 -0,-6.931l-6.799,-6.799Z" style="fill:#fff;"/></g><g id="beam14" serif:id="beam"><path id="beam15" serif:id="beam" d="M64.108,34.623c-2.705,0 -4.901,2.196 -4.901,4.901c-0,2.705 2.196,4.901 4.901,4.901l9.614,0c2.705,0 4.901,-2.196 4.901,-4.901c-0,-2.705 -2.196,-4.901 -4.901,-4.901l-9.614,0Z" style="fill:#fff;"/></g></g></g></svg>
    </template>

    <template v-if="mode == 'dark'">
        <svg width="100%" height="100%" viewBox="0 0 79 80" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xml:space="preserve" style="fill-rule:evenodd;clip-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:2;"><g id="mode_dark"><rect id="Bounds" x="0" y="-0" width="78.623" height="79.049" style="fill:none;"/><circle cx="39.311" cy="39.524" r="15.734" style="fill:#fff;"/><g id="beams"><g id="beam"><path id="beam1" serif:id="beam" d="M44.212,14.515c0,-2.705 -2.196,-4.901 -4.901,-4.901c-2.704,0 -4.901,2.196 -4.901,4.901c0,2.705 2.197,4.901 4.901,4.901c2.705,0 4.901,-2.196 4.901,-4.901Z" style="fill:#fff;"/></g><g id="beam2" serif:id="beam"><path id="beam3" serif:id="beam" d="M60.662,24.892c1.902,-1.902 1.902,-4.99 0,-6.892l-0.04,-0.039c-1.901,-1.902 -4.989,-1.902 -6.891,-0c-1.901,1.901 -1.901,4.989 0,6.891l0.04,0.04c1.902,1.901 4.989,1.901 6.891,-0Z" style="fill:#fff;"/></g><g id="beam4" serif:id="beam"><path id="beam5" serif:id="beam" d="M25.732,61.103c1.91,-1.91 1.91,-5.011 0,-6.921l-0.009,-0.01c-1.91,-1.91 -5.012,-1.91 -6.921,-0c-1.91,1.91 -1.91,5.011 -0,6.921l0.01,0.01c1.909,1.91 5.011,1.91 6.92,-0Z" style="fill:#fff;"/></g><g id="beam6" serif:id="beam"><path id="beam7" serif:id="beam" d="M60.672,54.167c-1.907,-1.907 -5.004,-1.907 -6.911,0l-0.02,0.02c-1.907,1.907 -1.907,5.004 0,6.911c1.907,1.907 5.004,1.907 6.911,-0l0.02,-0.02c1.907,-1.907 1.907,-5.004 0,-6.911Z" style="fill:#fff;"/></g><g id="beam8" serif:id="beam"><path id="beam9" serif:id="beam" d="M14.52,34.623c-2.702,0 -4.896,2.194 -4.896,4.896l0,0.01c0,2.702 2.194,4.896 4.896,4.896c2.702,0 4.896,-2.194 4.896,-4.896l-0,-0.01c-0,-2.702 -2.194,-4.896 -4.896,-4.896Z" style="fill:#fff;"/></g><g id="beam10" serif:id="beam"><path id="beam11" serif:id="beam" d="M44.212,64.534c0,-2.705 -2.196,-4.901 -4.901,-4.901c-2.704,-0 -4.901,2.196 -4.901,4.901c0,2.704 2.197,4.9 4.901,4.9c2.705,0 4.901,-2.196 4.901,-4.9Z" style="fill:#fff;"/></g><g id="beam12" serif:id="beam"><path id="beam13" serif:id="beam" d="M25.73,17.943c-1.911,-1.911 -5.015,-1.911 -6.926,0l-0.005,0.005c-1.911,1.911 -1.911,5.015 0,6.926c1.911,1.911 5.015,1.911 6.926,0l0.005,-0.005c1.911,-1.911 1.911,-5.014 -0,-6.926Z" style="fill:#fff;"/></g><g id="beam14" serif:id="beam"><path id="beam15" serif:id="beam" d="M64.098,34.623c-2.699,0 -4.891,2.192 -4.891,4.892l-0,0.019c-0,2.699 2.192,4.891 4.891,4.891c2.7,0 4.892,-2.192 4.892,-4.891l0,-0.019c0,-2.7 -2.192,-4.892 -4.892,-4.892Z" style="fill:#fff;"/></g></g></g></svg>
    </template>

    <template v-if="mode == 'darkest'">
        <svg width="100%" height="100%" viewBox="0 0 79 80" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xml:space="preserve" style="fill-rule:evenodd;clip-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:2;"><g id="mode_darkest"><rect id="Bounds" x="0" y="-0" width="78.623" height="79.049" style="fill:none;"/><path d="M39.315,23.791c8.684,-0 15.734,7.05 15.734,15.733c0,8.684 -7.05,15.734 -15.734,15.734c-8.683,0 -15.733,-7.05 -15.733,-15.734c-0,-8.683 7.05,-15.733 15.733,-15.733Zm0,4.737c6.069,0 10.997,4.927 10.997,10.996c-0,6.069 -4.928,10.996 -10.997,10.996c-6.068,0 -10.996,-4.927 -10.996,-10.996c0,-6.069 4.928,-10.996 10.996,-10.996Z" style="fill:#fff;"/><g id="beams"><g id="beam"><path id="beam1" serif:id="beam" d="M44.216,14.515c0,-2.705 -2.196,-4.901 -4.901,-4.901c-2.704,0 -4.9,2.196 -4.9,4.901c-0,2.705 2.196,4.901 4.9,4.901c2.705,0 4.901,-2.196 4.901,-4.901Z" style="fill:#fff;"/></g><g id="beam2" serif:id="beam"><path id="beam3" serif:id="beam" d="M60.666,24.892c1.902,-1.902 1.902,-4.99 0,-6.892l-0.04,-0.039c-1.901,-1.902 -4.989,-1.902 -6.891,-0c-1.901,1.901 -1.901,4.989 0,6.891l0.04,0.04c1.902,1.901 4.99,1.901 6.891,-0Z" style="fill:#fff;"/></g><g id="beam4" serif:id="beam"><path id="beam5" serif:id="beam" d="M25.737,61.103c1.909,-1.91 1.909,-5.011 -0,-6.921l-0.01,-0.01c-1.91,-1.91 -5.011,-1.91 -6.921,-0c-1.91,1.91 -1.91,5.011 -0,6.921l0.01,0.01c1.91,1.91 5.011,1.91 6.921,-0Z" style="fill:#fff;"/></g><g id="beam6" serif:id="beam"><path id="beam7" serif:id="beam" d="M60.676,54.167c-1.907,-1.907 -5.004,-1.907 -6.911,0l-0.02,0.02c-1.907,1.907 -1.907,5.004 0,6.911c1.907,1.907 5.004,1.907 6.911,-0l0.02,-0.02c1.907,-1.907 1.907,-5.004 0,-6.911Z" style="fill:#fff;"/></g><g id="beam8" serif:id="beam"><path id="beam9" serif:id="beam" d="M14.524,34.623c-2.702,0 -4.896,2.194 -4.896,4.896l0,0.01c0,2.702 2.194,4.896 4.896,4.896c2.702,0 4.896,-2.194 4.896,-4.896l0,-0.01c0,-2.702 -2.194,-4.896 -4.896,-4.896Z" style="fill:#fff;"/></g><g id="beam10" serif:id="beam"><path id="beam11" serif:id="beam" d="M44.216,64.534c0,-2.705 -2.196,-4.901 -4.901,-4.901c-2.704,-0 -4.9,2.196 -4.9,4.901c-0,2.704 2.196,4.9 4.9,4.9c2.705,0 4.901,-2.196 4.901,-4.9Z" style="fill:#fff;"/></g><g id="beam12" serif:id="beam"><path id="beam13" serif:id="beam" d="M25.734,17.943c-1.911,-1.911 -5.015,-1.911 -6.926,0l-0.005,0.005c-1.911,1.911 -1.911,5.015 0,6.926c1.911,1.911 5.015,1.911 6.926,0l0.005,-0.005c1.911,-1.911 1.911,-5.014 0,-6.926Z" style="fill:#fff;"/></g><g id="beam14" serif:id="beam"><path id="beam15" serif:id="beam" d="M64.103,34.623c-2.7,0 -4.892,2.192 -4.892,4.892l-0,0.019c-0,2.699 2.192,4.891 4.892,4.891c2.699,0 4.891,-2.192 4.891,-4.891l0,-0.019c0,-2.7 -2.192,-4.892 -4.891,-4.892Z" style="fill:#fff;"/></g></g></g></svg>
    </template>
</a>

<script>
(function() {
    const LOCAL_STORAGE_KEY = 'piccoloThemeMode'

    var initialMode = localStorage.getItem(LOCAL_STORAGE_KEY)

    if (initialMode) {
        // Make sure the value in local storage is valid
        if (['light', 'dark', 'darkest'].indexOf(initialMode) == -1) {
            initialMode = 'light'
            localStorage.setItem(LOCAL_STORAGE_KEY, initialMode)
        }
    } else {
        // Check if the client prefers dark mode
        if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
            initialMode = 'dark'
        } else {
            initialMode = 'light'
        }
        localStorage.setItem(LOCAL_STORAGE_KEY, initialMode)
    }

    document.documentElement.dataset.mode = initialMode

    PetiteVue.createApp({
        'mode': initialMode,
        handleClick() {
            let currentMode = this.mode

            if (currentMode == 'light') {
                this.mode = 'dark'
            } else if (currentMode == 'dark') {
                this.mode = 'darkest'
            } else if (currentMode == 'darkest') {
                this.mode = 'light'
            }

            document.documentElement.dataset.mode = this.mode
            localStorage.setItem(LOCAL_STORAGE_KEY, this.mode)

            console.log(this.mode)
        }
    }).mount('#mode_toggle')
})()
</script>
            <p class="mobile_search_link">
                <a href="../../../search.html" title="Search">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 65 64" fill-rule="evenodd" stroke-linejoin="round" stroke-miterlimit="2">
                        <path d="M14.873 40.009c-2.315-3.943-3.642-8.532-3.642-13.429C11.231 11.91 23.141 0 37.811 0s26.58 11.91 26.58 26.58-11.91 26.58-26.58 26.58a26.44 26.44 0 0 1-14.277-4.161L9.739 62.794a3.12 3.12 0 0 1-4.413 0L.913 58.382c-1.217-1.218-1.217-3.196 0-4.413l13.96-13.96zM37.811 8.054c10.225 0 18.526 8.301 18.526 18.526s-8.301 18.526-18.526 18.526-18.526-8.301-18.526-18.526S27.586 8.054 37.811 8.054z" fill="#fff" />
                    </svg>
                </a>
            </p>
        

        <div class="searchbox_wrapper">
            
<search id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
    </nav>
</div>

    
      <div class="sphinxsidebar" role="navigation" aria-label="Main">
        <div class="sphinxsidebarwrapper"><ul>
<li class="toctree-l1"><a class="reference internal" href="../../../susie.html">User Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../FAQ.html">Frequently Asked Questions</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../basic_usage.html">Basic Usage of TimingData and Ephemeris Objects</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../special_usage.html">Special TimingData Object Usage</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../observing_schedule.html">Generating an Observing Schedule</a></li>
</ul>

        </div>
      </div>


    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for src.susie.ephemeris</h1><div class="highlight"><pre>
<span></span><span class="kn">from</span><span class="w"> </span><span class="nn">abc</span><span class="w"> </span><span class="kn">import</span> <span class="n">ABC</span><span class="p">,</span> <span class="n">abstractmethod</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pytz</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">lmfit</span><span class="w"> </span><span class="kn">import</span> <span class="n">Model</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">astropy.units</span><span class="w"> </span><span class="kn">import</span> <span class="n">Quantity</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">astropy.units</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">u</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">astropy.time</span><span class="w"> </span><span class="kn">import</span> <span class="n">Time</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">astropy.coordinates</span><span class="w"> </span><span class="kn">import</span> <span class="n">SkyCoord</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">astroplan</span><span class="w"> </span><span class="kn">import</span> <span class="n">FixedTarget</span><span class="p">,</span> <span class="n">Observer</span><span class="p">,</span> <span class="n">EclipsingSystem</span><span class="p">,</span> <span class="n">AtNightConstraint</span><span class="p">,</span> <span class="n">AltitudeConstraint</span><span class="p">,</span> <span class="n">is_event_observable</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">astroquery.ipac.nexsci.nasa_exoplanet_archive</span><span class="w"> </span><span class="kn">import</span> <span class="n">NasaExoplanetArchive</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">susie.timing_data</span><span class="w"> </span><span class="kn">import</span> <span class="n">TimingData</span> <span class="c1"># Use this for package pushes</span>
<span class="c1"># from .timing_data import TimingData # Use this for running tests</span>
<span class="c1"># from timing_data import TimingData # Use this for running this file</span>

<span class="k">class</span><span class="w"> </span><span class="nc">BaseModel</span><span class="p">(</span><span class="n">ABC</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Abstract class that defines the structure of different model classes.&quot;&quot;&quot;</span>
    <span class="nd">@abstractmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_initial_params</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">tra_or_occ</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Defines the structure for retrieving initial parameters for the model fit method.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        x : numpy.ndarray[int]</span>
<span class="sd">            The epoch data as received from the TimingData object.</span>
<span class="sd">        y : numpy.ndarray[float]</span>
<span class="sd">            The mid-time data as received from the TimingData object.</span>
<span class="sd">        tra_or_occ: numpy.ndarray[str]</span>
<span class="sd">            An array indicating the type of each event, with entries being either </span>
<span class="sd">            &quot;tra&quot; for transit or &quot;occ&quot; for occultation.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        A dictionary containing initial parameter values for the LMfit Model fitting procedure.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">pass</span>

    <span class="nd">@abstractmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">yerr</span><span class="p">,</span> <span class="n">tra_or_occ</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Fits a model to timing data.</span>

<span class="sd">        Defines the structure for fitting an model (linear, quadratic or precession) to timing data. </span>
<span class="sd">        All subclasses must implement this method.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">            x : numpy.ndarray[int]</span>
<span class="sd">                The epoch data as recieved from the TimingData object.</span>
<span class="sd">            y : numpy.ndarray[float]</span>
<span class="sd">                The mid-time data as recieved from the TimingData object.</span>
<span class="sd">            yerr : numpy.ndarray[float]</span>
<span class="sd">                The mid-time error data as recieved from the TimingData object.</span>
<span class="sd">            tra_or_occ: numpy.ndarray[str]</span>
<span class="sd">                An array indicating the type of each event, with entries being either </span>
<span class="sd">                &quot;tra&quot; for transit or &quot;occ&quot; for occultation.</span>

<span class="sd">        Returns</span>
<span class="sd">        ------- </span>
<span class="sd">            A dictionary containing model best-fit parameter values. </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">pass</span>


<span class="k">class</span><span class="w"> </span><span class="nc">LinearModel</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Subclass of BaseModel that implements a linear fit.&quot;&quot;&quot;</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_initial_params</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">tra_or_occ</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Computes and returns the initial parameters for the model fit method.</span>

<span class="sd">        This method calculates the conjunction time (T0) and orbital period (P) </span>
<span class="sd">        using the provided timing data. The conjunction time is set to the first </span>
<span class="sd">        transit time, while the orbital period is estimated as the median of the </span>
<span class="sd">        differences between consecutive mid-times of transits and occultations.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        x : numpy.ndarray[int]</span>
<span class="sd">            The epoch data as recieved from the TimingData object.</span>
<span class="sd">        y : numpy.ndarray[float]</span>
<span class="sd">            The mid-time data as received from the TimingData object.</span>
<span class="sd">        tra_or_occ : numpy.ndarray[str]</span>
<span class="sd">            An array indicating the type of each event, with entries being either </span>
<span class="sd">            &quot;tra&quot; for transit or &quot;occ&quot; for occultation.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        dict</span>
<span class="sd">            A dictionary containing:</span>
<span class="sd">            - &quot;conjunction_time&quot; (float): The mid-time of the transit events corresponding to Epoch = 0.</span>
<span class="sd">            - &quot;period&quot; (float): The median time difference between consecutive events </span>
<span class="sd">            (transits and occultations).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">tra_mask</span> <span class="o">=</span> <span class="n">tra_or_occ</span> <span class="o">==</span> <span class="s2">&quot;tra&quot;</span>
        <span class="n">occ_mask</span> <span class="o">=</span> <span class="n">tra_or_occ</span> <span class="o">==</span> <span class="s2">&quot;occ&quot;</span>
        <span class="c1"># Getting difference between the first and last values of tra array</span>
        <span class="n">mid_time_diff_tra</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">roll</span><span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="n">tra_mask</span><span class="p">],</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">-</span><span class="n">y</span><span class="p">[</span><span class="n">tra_mask</span><span class="p">])</span>
        <span class="n">epochs_diff_tra</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">roll</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">tra_mask</span><span class="p">],</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">-</span><span class="n">x</span><span class="p">[</span><span class="n">tra_mask</span><span class="p">])</span>
        <span class="c1"># Dividing to get the period and accessing final value if it exists</span>
        <span class="n">period_tra</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">divide</span><span class="p">(</span><span class="n">mid_time_diff_tra</span><span class="p">,</span> <span class="n">epochs_diff_tra</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="n">tra_mask</span><span class="p">]</span><span class="o">.</span><span class="n">size</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
        <span class="c1"># Getting difference between the first and last values of occ array</span>
        <span class="n">mid_time_diff_occ</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">roll</span><span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="n">occ_mask</span><span class="p">],</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">-</span><span class="n">y</span><span class="p">[</span><span class="n">occ_mask</span><span class="p">])</span>
        <span class="n">epochs_diff_occ</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">roll</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">occ_mask</span><span class="p">],</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">-</span><span class="n">x</span><span class="p">[</span><span class="n">occ_mask</span><span class="p">])</span>
        <span class="c1"># Dividing to get the period and accessing final value if it exists</span>
        <span class="n">period_occ</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">divide</span><span class="p">(</span><span class="n">mid_time_diff_occ</span><span class="p">,</span> <span class="n">epochs_diff_occ</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="n">occ_mask</span><span class="p">]</span><span class="o">.</span><span class="n">size</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
        <span class="c1"># Finding final period by getting average of the two</span>
        <span class="n">period</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">([</span><span class="n">period_tra</span><span class="p">,</span> <span class="n">period_occ</span><span class="p">])</span>
        <span class="c1"># Conjunction time (we assume to use transits, use occultations if there are no transits)</span>
        <span class="n">T0</span> <span class="o">=</span> <span class="n">y</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">x</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">x</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">]</span>
        <span class="n">return_data</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;conjunction_time&quot;</span><span class="p">:</span> <span class="n">T0</span><span class="p">,</span>
            <span class="s2">&quot;period&quot;</span><span class="p">:</span> <span class="n">period</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="n">return_data</span>
    
    <span class="k">def</span><span class="w"> </span><span class="nf">lin_fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">E</span><span class="p">,</span> <span class="n">T0</span><span class="p">,</span> <span class="n">P</span><span class="p">,</span> <span class="n">tra_or_occ_enum</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Calculates a linear function with given data.</span>

<span class="sd">        Uses the equation </span>
<span class="sd">         - (period * epochs + initial mid time) for transit observations </span>
<span class="sd">         - (period * epochs + (initial mid time + (½ * period ))) for occultation observations </span>
<span class="sd">        </span>
<span class="sd">        as a linear function for the LMfit Model.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">            E: numpy.ndarray[float]</span>
<span class="sd">                The epoch data as recieved from the TimingData object.</span>
<span class="sd">            T0: float</span>
<span class="sd">                The initial mid-time, also known as conjunction time.</span>
<span class="sd">            P: float</span>
<span class="sd">                The exoplanet orbital period.</span>
<span class="sd">            tra_or_occ_enum: numpy.ndarray[int]</span>
<span class="sd">                An array indicating the type of each event, with enumerated entries being either </span>
<span class="sd">                0 for transit or 1 for occultation.</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">            result: numpy.ndarray[float]</span>
<span class="sd">                A linear function to be used with the LMfit Model, returned as:</span>
<span class="sd">                    :math:`P*E + T_0` if the data point is an observed transit (denoted by 0)</span>
<span class="sd">                    :math:`P*E + (T_0 + \\frac{1}{2}*P)` if the data point is an observed occultation (denoted by 1)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">E</span><span class="p">))</span>
        <span class="n">tra_mask</span> <span class="o">=</span> <span class="n">tra_or_occ_enum</span> <span class="o">==</span> <span class="mi">0</span>
        <span class="n">occ_mask</span> <span class="o">=</span> <span class="n">tra_or_occ_enum</span> <span class="o">==</span> <span class="mi">1</span>
        <span class="n">result</span><span class="p">[</span><span class="n">tra_mask</span><span class="p">]</span> <span class="o">=</span> <span class="n">T0</span> <span class="o">+</span> <span class="n">P</span><span class="o">*</span><span class="n">E</span><span class="p">[</span><span class="n">tra_mask</span><span class="p">]</span>
        <span class="n">result</span><span class="p">[</span><span class="n">occ_mask</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">T0</span> <span class="o">+</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">P</span><span class="p">)</span> <span class="o">+</span> <span class="n">P</span><span class="o">*</span><span class="n">E</span><span class="p">[</span><span class="n">occ_mask</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">result</span>
    
    <span class="k">def</span><span class="w"> </span><span class="nf">fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">yerr</span><span class="p">,</span> <span class="n">tra_or_occ</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Fits observed data to a linear model.</span>

<span class="sd">        Compares the model data from the TimingData object to the linear fit calculated with </span>
<span class="sd">        lin_fit method. Then minimizes the difference between the two sets of data. The LMfit Model then </span>
<span class="sd">        returns the parameters of the linear function corresponding to period, conjunction time, and their </span>
<span class="sd">        respective errors. These parameters are returned in a dictionary to the user.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">            x: numpy.ndarray[int]</span>
<span class="sd">                The epoch data as recieved from the TimingData object.</span>
<span class="sd">            y: numpy.ndarray[float]</span>
<span class="sd">                The mid-time data as recieved from the TimingData object.</span>
<span class="sd">            yerr: numpy.ndarray[float]</span>
<span class="sd">                The mid-time error data as recieved from the TimingData object.</span>
<span class="sd">            tra_or_occ: numpy.ndarray[str]</span>
<span class="sd">                An array indicating the type of each event, with entries being either </span>
<span class="sd">                &quot;tra&quot; for transit or &quot;occ&quot; for occultation.</span>
<span class="sd">            </span>
<span class="sd">        Keyword Arguments</span>
<span class="sd">        ------------------    </span>
<span class="sd">            init_params: dict (Optional)</span>
<span class="sd">                A dictionary containing inital parameter values to pass to the LMfit model. Includes:</span>
<span class="sd">                    * &#39;period&#39;: Estimated orbital period of the exoplanet (in units of days),</span>
<span class="sd">                    * &#39;conjunction_time&#39;: Time of conjunction of exoplanet transit or occultation</span>

<span class="sd">        Returns</span>
<span class="sd">        ------- </span>
<span class="sd">        return_data: dict</span>
<span class="sd">            A dictionary of best-fit parameter values from the fit model.</span>
<span class="sd">            Example:</span>

<span class="sd">            .. code-block:: python</span>

<span class="sd">                {</span>
<span class="sd">                &#39;period&#39;: Estimated orbital period of the exoplanet (in units of days),</span>
<span class="sd">                &#39;period_err&#39;: Uncertainty associated with orbital period (in units of days),</span>
<span class="sd">                &#39;conjunction_time&#39;: Time of conjunction of exoplanet transit or occultation,</span>
<span class="sd">                &#39;conjunction_time_err&#39;: Uncertainty associated with conjunction_time</span>
<span class="sd">                }</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">init_params</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;init_params&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_initial_params</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">tra_or_occ</span><span class="p">))</span>
        <span class="n">tra_or_occ_enum</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span> <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="s1">&#39;tra&#39;</span> <span class="k">else</span> <span class="mi">1</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">tra_or_occ</span><span class="p">]</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">Model</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lin_fit</span><span class="p">,</span> <span class="n">independent_vars</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;E&quot;</span><span class="p">,</span> <span class="s2">&quot;tra_or_occ_enum&quot;</span><span class="p">])</span>
        <span class="n">params</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">make_params</span><span class="p">(</span><span class="n">T0</span><span class="o">=</span><span class="n">init_params</span><span class="p">[</span><span class="s2">&quot;conjunction_time&quot;</span><span class="p">],</span> <span class="n">P</span><span class="o">=</span><span class="n">init_params</span><span class="p">[</span><span class="s2">&quot;period&quot;</span><span class="p">],</span> <span class="n">tra_or_occ_enum</span><span class="o">=</span><span class="n">tra_or_occ_enum</span><span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">weights</span><span class="o">=</span><span class="mf">1.0</span><span class="o">/</span><span class="n">yerr</span><span class="p">,</span> <span class="n">E</span><span class="o">=</span><span class="n">x</span><span class="p">,</span> <span class="n">tra_or_occ_enum</span><span class="o">=</span><span class="n">tra_or_occ_enum</span><span class="p">)</span>
        <span class="n">return_data</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;period&quot;</span><span class="p">:</span> <span class="n">result</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;P&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
            <span class="s2">&quot;period_err&quot;</span><span class="p">:</span> <span class="n">result</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;P&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">stderr</span><span class="p">,</span>
            <span class="s2">&quot;conjunction_time&quot;</span><span class="p">:</span> <span class="n">result</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;T0&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
            <span class="s2">&quot;conjunction_time_err&quot;</span><span class="p">:</span> <span class="n">result</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;T0&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">stderr</span>
        <span class="p">}</span>
        <span class="k">return</span><span class="p">(</span><span class="n">return_data</span><span class="p">)</span>


<span class="k">class</span><span class="w"> </span><span class="nc">QuadraticModel</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Subclass of BaseModel that implements a quadratic fit.&quot;&quot;&quot;</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_initial_params</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">tra_or_occ</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Computes and returns the initial parameters for the model fit method.</span>

<span class="sd">        This method calculates the conjunction time (T0) and orbital period (P) </span>
<span class="sd">        using the provided timing data. The conjunction time is set to the first </span>
<span class="sd">        transit time, while the orbital period is estimated as the median of the </span>
<span class="sd">        differences between consecutive mid-times of transits and occultations.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        x : numpy.ndarray[int]</span>
<span class="sd">            The epoch data as recieved from the TimingData object.</span>
<span class="sd">        y : numpy.ndarray[float]</span>
<span class="sd">            The mid-time data as received from the TimingData object.</span>
<span class="sd">        tra_or_occ : numpy.ndarray[str]</span>
<span class="sd">            An array indicating the type of each event, with entries being either </span>
<span class="sd">            &quot;tra&quot; for transit or &quot;occ&quot; for occultation.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        dict</span>
<span class="sd">            A dictionary containing:</span>
<span class="sd">            - &quot;conjunction_time&quot; (float): The mid-time of the transit events corresponding to Epoch = 0.</span>
<span class="sd">            - &quot;period&quot; (float): The median time difference between consecutive events </span>
<span class="sd">            (transits and occultations).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">tra_mask</span> <span class="o">=</span> <span class="n">tra_or_occ</span> <span class="o">==</span> <span class="s2">&quot;tra&quot;</span>
        <span class="n">occ_mask</span> <span class="o">=</span> <span class="n">tra_or_occ</span> <span class="o">==</span> <span class="s2">&quot;occ&quot;</span>
        <span class="c1"># Getting difference between the first and last values of tra array</span>
        <span class="n">mid_time_diff_tra</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">roll</span><span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="n">tra_mask</span><span class="p">],</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">-</span><span class="n">y</span><span class="p">[</span><span class="n">tra_mask</span><span class="p">])</span>
        <span class="n">epochs_diff_tra</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">roll</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">tra_mask</span><span class="p">],</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">-</span><span class="n">x</span><span class="p">[</span><span class="n">tra_mask</span><span class="p">])</span>
        <span class="c1"># Dividing to get the period and accessing final value if it exists</span>
        <span class="n">period_tra</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">divide</span><span class="p">(</span><span class="n">mid_time_diff_tra</span><span class="p">,</span> <span class="n">epochs_diff_tra</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="n">tra_mask</span><span class="p">]</span><span class="o">.</span><span class="n">size</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
        <span class="c1"># Getting difference between the first and last values of occ array</span>
        <span class="n">mid_time_diff_occ</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">roll</span><span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="n">occ_mask</span><span class="p">],</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">-</span><span class="n">y</span><span class="p">[</span><span class="n">occ_mask</span><span class="p">])</span>
        <span class="n">epochs_diff_occ</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">roll</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">occ_mask</span><span class="p">],</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">-</span><span class="n">x</span><span class="p">[</span><span class="n">occ_mask</span><span class="p">])</span>
        <span class="c1"># Dividing to get the period and accessing final value if it exists</span>
        <span class="n">period_occ</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">divide</span><span class="p">(</span><span class="n">mid_time_diff_occ</span><span class="p">,</span> <span class="n">epochs_diff_occ</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="n">occ_mask</span><span class="p">]</span><span class="o">.</span><span class="n">size</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
        <span class="c1"># Finding final period by getting average of the two</span>
        <span class="n">period</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">([</span><span class="n">period_tra</span><span class="p">,</span> <span class="n">period_occ</span><span class="p">])</span>
        <span class="c1"># Conjunction time (we assume to use transits, use occultations if there are no transits)</span>
        <span class="n">T0</span> <span class="o">=</span> <span class="n">y</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">x</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">x</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">]</span>
        <span class="n">return_data</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;conjunction_time&quot;</span><span class="p">:</span> <span class="n">T0</span><span class="p">,</span>
            <span class="s2">&quot;period&quot;</span><span class="p">:</span> <span class="n">period</span><span class="p">,</span>
            <span class="s2">&quot;decay_rate&quot;</span><span class="p">:</span> <span class="mf">0.0</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="n">return_data</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">quad_fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">E</span><span class="p">,</span> <span class="n">T0</span><span class="p">,</span> <span class="n">P</span><span class="p">,</span> <span class="n">dPdE</span><span class="p">,</span> <span class="n">tra_or_occ_enum</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Calculates a quadratic function with given data.</span>

<span class="sd">        Uses the equation </span>
<span class="sd">         - ((0.5 * change in period over epoch * (epoch²)) + (period * epoch) + conjunction time) for transit observations</span>
<span class="sd">         - ((0.5 * change in period over epoch * (epoch²)) + (period * epoch) + conjunction time) for occultation observations as a quadratic function for the LMfit Model.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">            E: numpy.ndarray[int]</span>
<span class="sd">                The epoch data as recieved from the TimingData object.</span>
<span class="sd">            T0: float</span>
<span class="sd">                The initial mid-time, also known as conjunction time.</span>
<span class="sd">            P: float</span>
<span class="sd">                The exoplanet orbital period.</span>
<span class="sd">            dPdE: float</span>
<span class="sd">                Change in period with respect to epoch.</span>
<span class="sd">            tra_or_occ_enum: numpy.ndarray[int]</span>
<span class="sd">                An array indicating the type of each event, with enumerated entries being either </span>
<span class="sd">                0 for transit or 1 for occultation.</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">            result: numpy.ndarray[float]</span>
<span class="sd">                A quadratic function to be used with the LMfit Model, returned as:</span>
<span class="sd">                    :math:`\\frac{1}{2}*\\frac{dP}{dE}*E^2 + P*E + T_0` if the data point is an observed transit (denoted by 0)</span>
<span class="sd">                    :math:`\\frac{1}{2}*\\frac{dP}{dE}*E^2 + P*E + (T_0 + \\frac{1}{2}*P)` if the data point is an observed occultation (denoted by 1)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">E</span><span class="p">))</span>
        <span class="n">tra_mask</span> <span class="o">=</span> <span class="n">tra_or_occ_enum</span> <span class="o">==</span> <span class="mi">0</span>
        <span class="n">occ_mask</span> <span class="o">=</span> <span class="n">tra_or_occ_enum</span> <span class="o">==</span> <span class="mi">1</span>
        <span class="n">result</span><span class="p">[</span><span class="n">tra_mask</span><span class="p">]</span> <span class="o">=</span> <span class="n">T0</span> <span class="o">+</span> <span class="n">P</span><span class="o">*</span><span class="n">E</span><span class="p">[</span><span class="n">tra_mask</span><span class="p">]</span> <span class="o">+</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">dPdE</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">E</span><span class="p">[</span><span class="n">tra_mask</span><span class="p">],</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">result</span><span class="p">[</span><span class="n">occ_mask</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">T0</span> <span class="o">+</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">P</span><span class="p">)</span> <span class="o">+</span> <span class="n">P</span><span class="o">*</span><span class="n">E</span><span class="p">[</span><span class="n">occ_mask</span><span class="p">]</span> <span class="o">+</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">dPdE</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">E</span><span class="p">[</span><span class="n">occ_mask</span><span class="p">],</span> <span class="mi">2</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">result</span>
    
    <span class="k">def</span><span class="w"> </span><span class="nf">fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">yerr</span><span class="p">,</span> <span class="n">tra_or_occ</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Fits observed data to a quadratic model.</span>

<span class="sd">        Compares the observed data from the TimingData object to the quadratic fit calculated with quad_fit </span>
<span class="sd">        method. Then minimizes the difference between the two sets of data. The LMfit Model then returns the </span>
<span class="sd">        parameters of the quadratic function corresponding to period, conjunction time, period change by epoch, </span>
<span class="sd">        and their respective errors. These parameters are returned in a dictionary to the user.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">            x: numpy.ndarray[int]</span>
<span class="sd">                The epoch data as recieved from the TimingData object.</span>
<span class="sd">            y: numpy.ndarray[float]</span>
<span class="sd">                The mid-time data as recieved from the TimingData object.</span>
<span class="sd">            yerr: numpy.ndarray[float]</span>
<span class="sd">                The mid-time error data as recieved from the TimingData object.</span>
<span class="sd">            tra_or_occ: numpy.ndarray[str]</span>
<span class="sd">                An array indicating the type of each event, with entries being either </span>
<span class="sd">                &quot;tra&quot; for transit or &quot;occ&quot; for occultation.</span>
<span class="sd">        </span>
<span class="sd">        Keyword Arguments</span>
<span class="sd">        ------------------</span>
<span class="sd">            init_params: dict (Optional)</span>
<span class="sd">                A dictionary containing inital parameter values to pass to the LMfit model. Includes:</span>
<span class="sd">                    * &#39;period&#39;: Estimated orbital period of the exoplanet (in units of days),</span>
<span class="sd">                    * &#39;conjunction_time&#39;: Time of conjunction of exoplanet transit or occultation</span>
<span class="sd">                    * &#39;decay_rate&#39;: The exoplanet period change with respect to epoch (in units of days)</span>

<span class="sd">        Returns</span>
<span class="sd">        ------- </span>
<span class="sd">        return_data: dict</span>
<span class="sd">            A dictionary of best-fit parameter values from the fit model. </span>
<span class="sd">            Example:</span>
<span class="sd">                {</span>
<span class="sd">                 &#39;period&#39;: Estimated orbital period of the exoplanet (in units of days),</span>
<span class="sd">                 &#39;period_err&#39;: Uncertainty associated with orbital period (in units of days),</span>
<span class="sd">                 &#39;conjunction_time&#39;: Time of conjunction of exoplanet transit or occultation,</span>
<span class="sd">                 &#39;conjunction_time_err&#39;: Uncertainty associated with conjunction_time</span>
<span class="sd">                 &#39;period_change_by_epoch&#39;: The exoplanet period change with respect to epoch (in units of days),</span>
<span class="sd">                 &#39;period_change_by_epoch_err&#39;: The uncertainties associated with period_change_by_epoch (in units of days)</span>
<span class="sd">                }</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">tra_or_occ_enum</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span> <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="s1">&#39;tra&#39;</span> <span class="k">else</span> <span class="mi">1</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">tra_or_occ</span><span class="p">]</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">Model</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">quad_fit</span><span class="p">,</span> <span class="n">independent_vars</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;E&quot;</span><span class="p">,</span> <span class="s2">&quot;tra_or_occ_enum&quot;</span><span class="p">])</span>
        <span class="n">init_params</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;init_params&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_initial_params</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">tra_or_occ</span><span class="p">))</span>
        <span class="n">params</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">make_params</span><span class="p">(</span><span class="n">T0</span><span class="o">=</span><span class="n">init_params</span><span class="p">[</span><span class="s2">&quot;conjunction_time&quot;</span><span class="p">],</span> <span class="n">P</span><span class="o">=</span><span class="n">init_params</span><span class="p">[</span><span class="s2">&quot;period&quot;</span><span class="p">],</span> <span class="n">dPdE</span><span class="o">=</span><span class="n">init_params</span><span class="p">[</span><span class="s2">&quot;decay_rate&quot;</span><span class="p">],</span> <span class="n">tra_or_occ_enum</span><span class="o">=</span><span class="n">tra_or_occ_enum</span><span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">weights</span><span class="o">=</span><span class="mf">1.0</span><span class="o">/</span><span class="n">yerr</span><span class="p">,</span> <span class="n">E</span><span class="o">=</span><span class="n">x</span><span class="p">,</span> <span class="n">tra_or_occ_enum</span><span class="o">=</span><span class="n">tra_or_occ_enum</span><span class="p">)</span>
        <span class="n">return_data</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;period&quot;</span><span class="p">:</span> <span class="n">result</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;P&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
            <span class="s2">&quot;period_err&quot;</span><span class="p">:</span> <span class="n">result</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;P&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">stderr</span><span class="p">,</span>
            <span class="s2">&quot;conjunction_time&quot;</span><span class="p">:</span> <span class="n">result</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;T0&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
            <span class="s2">&quot;conjunction_time_err&quot;</span><span class="p">:</span> <span class="n">result</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;T0&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">stderr</span><span class="p">,</span>
            <span class="s2">&quot;period_change_by_epoch&quot;</span><span class="p">:</span> <span class="n">result</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;dPdE&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
            <span class="s2">&quot;period_change_by_epoch_err&quot;</span><span class="p">:</span> <span class="n">result</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;dPdE&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">stderr</span>
        <span class="p">}</span>
        <span class="k">return</span><span class="p">(</span><span class="n">return_data</span><span class="p">)</span>
    

<span class="k">class</span><span class="w"> </span><span class="nc">PrecessionModel</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Subclass of BaseModel that implements fitting of timing data to a precession orbital model.&quot;&quot;&quot;</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_initial_params</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">tra_or_occ</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Computes and returns initial parameters for the model fit method.</span>

<span class="sd">        This method calculates the conjunction time (T0) and orbital period (P) </span>
<span class="sd">        using the provided timing data. The conjunction time is set to the first </span>
<span class="sd">        transit time, while the orbital period is estimated as the difference </span>
<span class="sd">        between the first and last mid-times divided by the difference between </span>
<span class="sd">        the first and last epoch. If occultations are included, the final estimated </span>
<span class="sd">        period is the average of the transit and occultation period estimates.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        x : numpy.ndarray of int</span>
<span class="sd">            Epoch data as received from the TimingData object.</span>
<span class="sd">        y : numpy.ndarray of float</span>
<span class="sd">            Mid-time data as received from the TimingData object.</span>
<span class="sd">        tra_or_occ : numpy.ndarray of str</span>
<span class="sd">            Array indicating the event type for each observation, with entries </span>
<span class="sd">            either &quot;tra&quot; for transit or &quot;occ&quot; for occultation.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        dict</span>
<span class="sd">            Dictionary containing initial parameter estimates:</span>
<span class="sd">            - &quot;conjunction_time&quot; (float): Mid-time at epoch zero.</span>
<span class="sd">            - &quot;period&quot; (float): Estimated orbital period (days).</span>
<span class="sd">            - &quot;eccentricity&quot; (float): Orbital eccentricity (default 0.001).</span>
<span class="sd">            - &quot;pericenter&quot; (float): Argument of pericenter in radians (default 2.0).</span>
<span class="sd">            - &quot;precession_rate&quot; (float): Rate of pericenter change per epoch (default 0.001).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">tra_mask</span> <span class="o">=</span> <span class="n">tra_or_occ</span> <span class="o">==</span> <span class="s2">&quot;tra&quot;</span>
        <span class="n">occ_mask</span> <span class="o">=</span> <span class="n">tra_or_occ</span> <span class="o">==</span> <span class="s2">&quot;occ&quot;</span>
        <span class="c1"># Getting difference between the first and last values of tra array</span>
        <span class="n">mid_time_diff_tra</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">roll</span><span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="n">tra_mask</span><span class="p">],</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">-</span><span class="n">y</span><span class="p">[</span><span class="n">tra_mask</span><span class="p">])</span>
        <span class="n">epochs_diff_tra</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">roll</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">tra_mask</span><span class="p">],</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">-</span><span class="n">x</span><span class="p">[</span><span class="n">tra_mask</span><span class="p">])</span>
        <span class="c1"># Dividing to get the period and accessing final value if it exists</span>
        <span class="n">period_tra</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">divide</span><span class="p">(</span><span class="n">mid_time_diff_tra</span><span class="p">,</span> <span class="n">epochs_diff_tra</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="n">tra_mask</span><span class="p">]</span><span class="o">.</span><span class="n">size</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
        <span class="c1"># Getting difference between the first and last values of occ array</span>
        <span class="n">mid_time_diff_occ</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">roll</span><span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="n">occ_mask</span><span class="p">],</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">-</span><span class="n">y</span><span class="p">[</span><span class="n">occ_mask</span><span class="p">])</span>
        <span class="n">epochs_diff_occ</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">roll</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">occ_mask</span><span class="p">],</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">-</span><span class="n">x</span><span class="p">[</span><span class="n">occ_mask</span><span class="p">])</span>
        <span class="c1"># Dividing to get the period and accessing final value if it exists</span>
        <span class="n">period_occ</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">divide</span><span class="p">(</span><span class="n">mid_time_diff_occ</span><span class="p">,</span> <span class="n">epochs_diff_occ</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="n">occ_mask</span><span class="p">]</span><span class="o">.</span><span class="n">size</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
        <span class="c1"># Finding final period by getting average of the two</span>
        <span class="n">period</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">([</span><span class="n">period_tra</span><span class="p">,</span> <span class="n">period_occ</span><span class="p">])</span>
        <span class="c1"># Conjunction time (we assume to use transits, use occultations if there are no transits)</span>
        <span class="n">T0</span> <span class="o">=</span> <span class="n">y</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">x</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">x</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">]</span>
        <span class="c1"># T0 = y[tra_mask][0]</span>
        <span class="c1"># # Pull the eccentricity from the NASA Exoplanet Archive</span>
        <span class="c1"># service = pyvo.dal.TAPService(&quot;https://exoplanetarchive.ipac.caltech.edu/TAP&quot;)</span>
        <span class="c1"># query = f&quot;SELECT pl_orbeccen FROM ps WHERE pl_name=&#39;TrES-5 b&#39;&quot;</span>
        <span class="c1"># results = service.search(query)</span>
        <span class="c1"># table = results.to_table()</span>
        <span class="c1"># eccentricity = next((x for x in np.array(table[&quot;pl_orbeccen&quot;]) if not np.isnan(x) and x != 0.0), 0.001)</span>
        <span class="c1"># # Default of 2 radians (114.592 degrees) if nothing is found</span>
        <span class="c1"># # arg_of_periastron = (next((x for x in np.array(table[&quot;pl_orblper&quot;]) if not np.isnan(x) and x != 0.0), 114.592) * np.pi) / 180</span>
        <span class="c1"># # Calculate the initial values using the quadratic model</span>
        <span class="c1"># quad_ephem = Model(TimingData(&quot;jd&quot;, x, y, yerr, tra_or_occ, &quot;tdb&quot;)).fit_model(&quot;quadratic&quot;)</span>
        <span class="c1"># a = 0.5*quad_ephem[&quot;period_change_by_epoch&quot;]</span>
        <span class="c1"># b = quad_ephem[&quot;period&quot;]</span>
        <span class="c1"># c = quad_ephem[&quot;conjunction_time&quot;]</span>
        <span class="c1"># p = [a, b, c]</span>
        <span class="c1"># roots = np.roots(p)</span>
        <span class="c1"># w_0 = ((((2*a)/(b)) * roots[0] + 0.5) / (((2*a)/(b)) * roots[0] - 1)) * np.pi</span>
        <span class="c1"># dwdE = (np.pi) / (roots[0] - roots[1])</span>
        <span class="c1"># e = (c - ((b**2)/(4*a))) * ((2*np.pi) / b)</span>
        <span class="c1"># return_data = {</span>
        <span class="c1">#     &quot;conjunction_time&quot;: T0,</span>
        <span class="c1">#     &quot;period&quot;: period,</span>
        <span class="c1">#     &quot;eccentricity&quot;: eccentricity,</span>
        <span class="c1">#     &quot;pericenter&quot;: w_0,</span>
        <span class="c1">#     &quot;precession_rate&quot;: dwdE</span>
        <span class="c1"># }</span>
        <span class="n">return_data</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;conjunction_time&quot;</span><span class="p">:</span> <span class="n">T0</span><span class="p">,</span>
            <span class="s2">&quot;period&quot;</span><span class="p">:</span> <span class="n">period</span><span class="p">,</span>
            <span class="s2">&quot;eccentricity&quot;</span><span class="p">:</span> <span class="mf">0.001</span><span class="p">,</span>
            <span class="s2">&quot;pericenter&quot;</span><span class="p">:</span> <span class="mf">2.0</span><span class="p">,</span>
            <span class="s2">&quot;precession_rate&quot;</span><span class="p">:</span> <span class="mf">0.001</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="n">return_data</span>
    
    <span class="k">def</span><span class="w"> </span><span class="nf">_anomalistic_period</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">P</span><span class="p">,</span> <span class="n">dwdE</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculates the anomalistic period given the sidereal period and precession rate.</span>

<span class="sd">        Uses the formula:</span>

<span class="sd">        .. math::</span>

<span class="sd">            P_a = \frac{P}{1 - \frac{1}{2\pi} \frac{d\omega}{dE}}</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        P : float</span>
<span class="sd">            Sidereal orbital period of the exoplanet (in days).</span>
<span class="sd">        dwdE : float</span>
<span class="sd">            Precession rate, the change in pericenter with respect to epoch (radians per epoch).</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        float</span>
<span class="sd">            The calculated anomalistic period (in days).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">P</span><span class="o">/</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="p">((</span><span class="mf">1.0</span><span class="o">/</span><span class="p">(</span><span class="mf">2.0</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">))</span><span class="o">*</span><span class="n">dwdE</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">result</span>
    
    <span class="k">def</span><span class="w"> </span><span class="nf">_pericenter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">E</span><span class="p">,</span> <span class="n">w0</span><span class="p">,</span> <span class="n">dwdE</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculates the argument of pericenter for given epochs.</span>

<span class="sd">        Uses the linear relation:</span>

<span class="sd">        .. math::</span>

<span class="sd">            \omega(E) = \omega_0 + \frac{d\omega}{dE} \cdot E</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        E : numpy.ndarray of int</span>
<span class="sd">            Epoch data as received from the TimingData object.</span>
<span class="sd">        w0 : float</span>
<span class="sd">            Argument of pericenter at epoch zero (in radians).</span>
<span class="sd">        dwdE : float</span>
<span class="sd">            Precession rate, i.e., change in pericenter per epoch (radians per epoch).</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        numpy.ndarray of float</span>
<span class="sd">            Calculated pericenter values for each epoch.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">w0</span> <span class="o">+</span> <span class="p">(</span><span class="n">dwdE</span><span class="o">*</span><span class="n">E</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">result</span>
    
    <span class="k">def</span><span class="w"> </span><span class="nf">precession_fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">E</span><span class="p">,</span> <span class="n">T0</span><span class="p">,</span> <span class="n">P</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">w0</span><span class="p">,</span> <span class="n">dwdE</span><span class="p">,</span> <span class="n">tra_or_occ_enum</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculates the precession function for given orbital data.</span>

<span class="sd">        This function computes the expected mid-times for each epoch based on the </span>
<span class="sd">        precession model, using different formulas for transit and occultation events:</span>

<span class="sd">        - For transit observations:</span>
<span class="sd">        </span>
<span class="sd">        .. math::</span>

<span class="sd">            T(E) = T_0 + E \cdot P - \frac{e \cdot P_a}{\pi} \cos \left( \omega(E) \right)</span>

<span class="sd">        - For occultation observations:</span>

<span class="sd">        .. math::</span>

<span class="sd">            T(E) = T_0 + \frac{P_a}{2} + E \cdot P + \frac{e \cdot P_a}{\pi} \cos \left( \omega(E) \right)</span>

<span class="sd">        where</span>

<span class="sd">        - :math:`P_a` is the anomalistic period calculated from :math:`P` and the precession rate,</span>
<span class="sd">        - :math:`\omega(E)` is the pericenter angle as a function of epoch.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        E : numpy.ndarray of int</span>
<span class="sd">            Epoch data as received from the TimingData object.</span>
<span class="sd">        T0 : float</span>
<span class="sd">            Initial mid-time (conjunction time).</span>
<span class="sd">        P : float</span>
<span class="sd">            Sidereal orbital period of the exoplanet.</span>
<span class="sd">        e : float</span>
<span class="sd">            Orbital eccentricity.</span>
<span class="sd">        w0 : float</span>
<span class="sd">            Argument of pericenter at epoch zero (in radians).</span>
<span class="sd">        dwdE : float</span>
<span class="sd">            Precession rate (change in pericenter per epoch, in radians).</span>
<span class="sd">        tra_or_occ_enum : numpy.ndarray of int</span>
<span class="sd">            Array indicating event types: 0 for transit, 1 for occultation.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        result : numpy.ndarray of float</span>
<span class="sd">            Calculated mid-times for each epoch using the precession model.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">E</span><span class="p">))</span>
        <span class="n">P_a</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_anomalistic_period</span><span class="p">(</span><span class="n">P</span><span class="p">,</span> <span class="n">dwdE</span><span class="p">)</span>
        <span class="n">tra_mask</span> <span class="o">=</span> <span class="n">tra_or_occ_enum</span> <span class="o">==</span> <span class="mi">0</span>
        <span class="n">occ_mask</span> <span class="o">=</span> <span class="n">tra_or_occ_enum</span> <span class="o">==</span> <span class="mi">1</span>
        <span class="n">result</span><span class="p">[</span><span class="n">tra_mask</span><span class="p">]</span> <span class="o">=</span> <span class="n">T0</span> <span class="o">+</span> <span class="p">(</span><span class="n">E</span><span class="p">[</span><span class="n">tra_mask</span><span class="p">]</span><span class="o">*</span><span class="n">P</span><span class="p">)</span> <span class="o">-</span> <span class="p">((</span><span class="n">e</span><span class="o">*</span><span class="n">P_a</span><span class="p">)</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_pericenter</span><span class="p">(</span><span class="n">E</span><span class="p">[</span><span class="n">tra_mask</span><span class="p">],</span> <span class="n">w0</span><span class="p">,</span> <span class="n">dwdE</span><span class="p">))</span>
        <span class="n">result</span><span class="p">[</span><span class="n">occ_mask</span><span class="p">]</span> <span class="o">=</span> <span class="n">T0</span> <span class="o">+</span> <span class="n">P_a</span><span class="o">/</span><span class="mf">2.0</span> <span class="o">+</span> <span class="p">(</span><span class="n">E</span><span class="p">[</span><span class="n">occ_mask</span><span class="p">]</span><span class="o">*</span><span class="n">P</span><span class="p">)</span> <span class="o">+</span> <span class="p">((</span><span class="n">e</span><span class="o">*</span><span class="n">P_a</span><span class="p">)</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_pericenter</span><span class="p">(</span><span class="n">E</span><span class="p">[</span><span class="n">occ_mask</span><span class="p">],</span> <span class="n">w0</span><span class="p">,</span> <span class="n">dwdE</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">result</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">yerr</span><span class="p">,</span> <span class="n">tra_or_occ</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Fits observed timing data to a precession model.</span>

<span class="sd">        This method compares observed mid-time data from the `TimingData` object with the </span>
<span class="sd">        model values calculated by the `precession_fit` function. It uses the LMfit </span>
<span class="sd">        library to minimize the difference between the observed and model data, optimizing </span>
<span class="sd">        parameters including orbital period, conjunction time, eccentricity, pericenter, </span>
<span class="sd">        and the rate of pericenter change per epoch.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        x : numpy.ndarray of int</span>
<span class="sd">            Epoch data as received from the TimingData object.</span>
<span class="sd">        y : numpy.ndarray of float</span>
<span class="sd">            Mid-time data as received from the TimingData object.</span>
<span class="sd">        yerr : numpy.ndarray of float</span>
<span class="sd">            Mid-time error data as received from the TimingData object.</span>
<span class="sd">        tra_or_occ : numpy.ndarray of str</span>
<span class="sd">            Array indicating the event type for each data point, with values `&quot;tra&quot;` for transit or `&quot;occ&quot;` for occultation.</span>
<span class="sd">        </span>
<span class="sd">        Keyword Arguments</span>
<span class="sd">        -----------------</span>
<span class="sd">        init_params : dict, optional</span>
<span class="sd">            Dictionary of initial parameter guesses to seed the fit. Required keys depend on the model type:</span>

<span class="sd">            For `&#39;linear&#39;`:</span>
<span class="sd">                - `&#39;period&#39;` (float): Estimated orbital period (in days).</span>
<span class="sd">                - `&#39;conjunction_time&#39;` (float): Reference time of mid-transit or occultation.</span>

<span class="sd">            For `&#39;quadratic&#39;`:</span>
<span class="sd">                - All `&#39;linear&#39;` parameters.</span>
<span class="sd">                - `&#39;decay_rate&#39;` (float): Change in period per epoch (in days/epoch).</span>

<span class="sd">            For `&#39;precession&#39;`:</span>
<span class="sd">                - All `&#39;linear&#39;` parameters.</span>
<span class="sd">                - `&#39;eccentricity&#39;` (float): Orbital eccentricity (unitless).</span>
<span class="sd">                - `&#39;pericenter&#39;` (float): Argument of pericenter (in radians).</span>
<span class="sd">                - `&#39;precession_rate&#39;` (float): Rate of pericenter precession per epoch (in radians/epoch).</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        return_data : dict</span>
<span class="sd">            Dictionary of best-fit parameter values from the fit model. Included keys and their descriptions:</span>

<span class="sd">            - &#39;period&#39; : float</span>
<span class="sd">                Estimated orbital period (days).</span>
<span class="sd">            - &#39;period_err&#39; : float</span>
<span class="sd">                Uncertainty in the orbital period (days).</span>
<span class="sd">            - &#39;conjunction_time&#39; : float</span>
<span class="sd">                Time of conjunction (days).</span>
<span class="sd">            - &#39;conjunction_time_err&#39; : float</span>
<span class="sd">                Uncertainty in conjunction time (days).</span>
<span class="sd">            - &#39;eccentricity&#39; : float</span>
<span class="sd">                Orbital eccentricity.</span>
<span class="sd">            - &#39;eccentricity_err&#39; : float</span>
<span class="sd">                Uncertainty in eccentricity.</span>
<span class="sd">            - &#39;pericenter&#39; : float</span>
<span class="sd">                Argument of pericenter (radians).</span>
<span class="sd">            - &#39;pericenter_err&#39; : float</span>
<span class="sd">                Uncertainty in pericenter.</span>
<span class="sd">            - &#39;pericenter_change_by_epoch&#39; : float</span>
<span class="sd">                Precession rate (radians per epoch).</span>
<span class="sd">            - &#39;pericenter_change_by_epoch_err&#39; : float</span>
<span class="sd">                Uncertainty in precession rate.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># NOTE:</span>
            <span class="c1"># STARTING VAL OF dwdE CANNOT BE 0, WILL RESULT IN NAN VALUES FOR THE MODEL</span>
        <span class="n">tra_or_occ_enum</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span> <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="s1">&#39;tra&#39;</span> <span class="k">else</span> <span class="mi">1</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">tra_or_occ</span><span class="p">]</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">Model</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">precession_fit</span><span class="p">,</span> <span class="n">independent_vars</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;E&quot;</span><span class="p">,</span> <span class="s2">&quot;tra_or_occ_enum&quot;</span><span class="p">])</span>
        <span class="n">init_params</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;init_params&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_initial_params</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">tra_or_occ</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">init_params</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">init_params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_initial_params</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">yerr</span><span class="p">,</span> <span class="n">tra_or_occ</span><span class="p">)</span>
        <span class="c1"># Can put bounds between 0 and 2pi for omega0 THIS DOES NOT WORK, WILL MESS UP RESULTS</span>
        <span class="c1"># TODO: Try out bound for d omega dE for abs(dwdE) &lt; 2pi/delta E</span>
        <span class="c1"># params = model.make_params(T0=init_params[&quot;conjunction_time&quot;], P=init_params[&quot;period&quot;], e=dict(value=init_params[&quot;eccentricity&quot;], min=0, max=1), w0=dict(value=init_params[&quot;pericenter&quot;], min=0, max=2*np.pi), dwdE=dict(value=init_params[&quot;precession_rate&quot;]), tra_or_occ_enum=tra_or_occ_enum)</span>
        <span class="n">params</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">make_params</span><span class="p">(</span><span class="n">T0</span><span class="o">=</span><span class="n">init_params</span><span class="p">[</span><span class="s2">&quot;conjunction_time&quot;</span><span class="p">],</span> <span class="n">P</span><span class="o">=</span><span class="n">init_params</span><span class="p">[</span><span class="s2">&quot;period&quot;</span><span class="p">],</span> <span class="n">e</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="n">init_params</span><span class="p">[</span><span class="s2">&quot;eccentricity&quot;</span><span class="p">],</span> <span class="nb">min</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span> <span class="n">w0</span><span class="o">=</span><span class="n">init_params</span><span class="p">[</span><span class="s2">&quot;pericenter&quot;</span><span class="p">],</span> <span class="n">dwdE</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="n">init_params</span><span class="p">[</span><span class="s2">&quot;precession_rate&quot;</span><span class="p">]),</span> <span class="n">tra_or_occ_enum</span><span class="o">=</span><span class="n">tra_or_occ_enum</span><span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">weights</span><span class="o">=</span><span class="mf">1.0</span><span class="o">/</span><span class="n">yerr</span><span class="p">,</span> <span class="n">E</span><span class="o">=</span><span class="n">x</span><span class="p">,</span> <span class="n">tra_or_occ_enum</span><span class="o">=</span><span class="n">tra_or_occ_enum</span><span class="p">)</span>
        <span class="n">return_data</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;period&quot;</span><span class="p">:</span> <span class="n">result</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;P&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
            <span class="s2">&quot;period_err&quot;</span><span class="p">:</span> <span class="n">result</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;P&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">stderr</span><span class="p">,</span>
            <span class="s2">&quot;conjunction_time&quot;</span><span class="p">:</span> <span class="n">result</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;T0&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
            <span class="s2">&quot;conjunction_time_err&quot;</span><span class="p">:</span> <span class="n">result</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;T0&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">stderr</span><span class="p">,</span>
            <span class="s2">&quot;eccentricity&quot;</span><span class="p">:</span> <span class="n">result</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;e&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
            <span class="s2">&quot;eccentricity_err&quot;</span><span class="p">:</span> <span class="n">result</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;e&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">stderr</span><span class="p">,</span>
            <span class="s2">&quot;pericenter&quot;</span><span class="p">:</span> <span class="n">result</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;w0&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
            <span class="s2">&quot;pericenter_err&quot;</span><span class="p">:</span> <span class="n">result</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;w0&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">stderr</span><span class="p">,</span>
            <span class="s2">&quot;pericenter_change_by_epoch&quot;</span><span class="p">:</span> <span class="n">result</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;dwdE&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
            <span class="s2">&quot;pericenter_change_by_epoch_err&quot;</span><span class="p">:</span> <span class="n">result</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;dwdE&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">stderr</span>
        <span class="p">}</span>
        <span class="k">return</span><span class="p">(</span><span class="n">return_data</span><span class="p">)</span>


<span class="k">class</span><span class="w"> </span><span class="nc">ModelFactory</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Factory class for creating and fitting model instances based on the specified model type.</span>

<span class="sd">    This class provides a static interface to instantiate the appropriate `BaseModel` subclass</span>
<span class="sd">    (either `&#39;linear&#39;`, `&#39;quadratic&#39;`, or `&#39;precession&#39;`) and fit it to timing data.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">create_model</span><span class="p">(</span><span class="n">model_type</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">yerr</span><span class="p">,</span> <span class="n">tra_or_occ</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Instantiates the appropriate `BaseModel` subclass and fits it to the data.</span>

<span class="sd">        Given a user-specified model type (`&#39;linear&#39;`, `&#39;quadratic&#39;`, or `&#39;precession&#39;`),</span>
<span class="sd">        this method uses the model factory to create the corresponding `BaseModel` subclass,</span>
<span class="sd">        runs its `fit_model()` method, and returns the resulting dictionary of best-fit parameters.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        model_type : str</span>
<span class="sd">            The type of model to fit. Must be one of:</span>
<span class="sd">            - `&#39;linear&#39;`: Constant-period orbital model.</span>
<span class="sd">            - `&#39;quadratic&#39;`: Linear model with a period change (e.g., tidal decay).</span>
<span class="sd">            - `&#39;precession&#39;`: Model including apsidal precession.</span>

<span class="sd">        Keyword Arguments</span>
<span class="sd">        -----------------</span>
<span class="sd">        init_params : dict, optional</span>
<span class="sd">            Dictionary of initial parameter guesses to seed the fit. Required keys depend on the model type:</span>

<span class="sd">            For `&#39;linear&#39;`:</span>
<span class="sd">                - `&#39;period&#39;` (float): Estimated orbital period (in days).</span>
<span class="sd">                - `&#39;conjunction_time&#39;` (float): Reference time of mid-transit or occultation.</span>

<span class="sd">            For `&#39;quadratic&#39;`:</span>
<span class="sd">                - All `&#39;linear&#39;` parameters.</span>
<span class="sd">                - `&#39;decay_rate&#39;` (float): Change in period per epoch (in days/epoch).</span>

<span class="sd">            For `&#39;precession&#39;`:</span>
<span class="sd">                - All `&#39;linear&#39;` parameters.</span>
<span class="sd">                - `&#39;eccentricity&#39;` (float): Orbital eccentricity (unitless).</span>
<span class="sd">                - `&#39;pericenter&#39;` (float): Argument of pericenter (in radians).</span>
<span class="sd">                - `&#39;precession_rate&#39;` (float): Rate of pericenter precession per epoch (in radians/epoch).</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        model_data : dict</span>
<span class="sd">            Dictionary of best-fit parameters from the model, including:</span>

<span class="sd">            Common to all models:</span>
<span class="sd">                - `&#39;model_type&#39;`: Name of the model used (`&#39;linear&#39;`, `&#39;quadratic&#39;`, or `&#39;precession&#39;`).</span>
<span class="sd">                - `&#39;model_data&#39;`: Array of predicted mid-times using best-fit parameters.</span>
<span class="sd">                - `&#39;period&#39;`, `&#39;period_err&#39;`: Fitted orbital period and its uncertainty.</span>
<span class="sd">                - `&#39;conjunction_time&#39;`, `&#39;conjunction_time_err&#39;`: Fitted time of conjunction and its uncertainty.</span>

<span class="sd">            Additional for `&#39;quadratic&#39;`:</span>
<span class="sd">                - `&#39;period_change_by_epoch&#39;`, `&#39;period_change_by_epoch_err&#39;`: Rate of period change per epoch and its uncertainty.</span>

<span class="sd">            Additional for `&#39;precession&#39;`:</span>
<span class="sd">                - `&#39;eccentricity&#39;`, `&#39;eccentricity_err&#39;`</span>
<span class="sd">                - `&#39;pericenter&#39;`, `&#39;pericenter_err&#39;`</span>
<span class="sd">                - `&#39;pericenter_change_by_epoch&#39;`, `&#39;pericenter_change_by_epoch_err&#39;`: Precession rate and its uncertainty.</span>
<span class="sd">                    }</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        ValueError</span>
<span class="sd">            If `model_type` is not one of `&#39;linear&#39;`, `&#39;quadratic&#39;`, or `&#39;precession&#39;`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">models</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;linear&quot;</span><span class="p">:</span> <span class="n">LinearModel</span><span class="p">,</span>
            <span class="s2">&quot;quadratic&quot;</span><span class="p">:</span> <span class="n">QuadraticModel</span><span class="p">,</span>
            <span class="s2">&quot;precession&quot;</span><span class="p">:</span> <span class="n">PrecessionModel</span>
        <span class="p">}</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">model_class</span> <span class="o">=</span> <span class="n">models</span><span class="p">[</span><span class="n">model_type</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Invalid model type &#39;</span><span class="si">{</span><span class="n">model_type</span><span class="si">}</span><span class="s2">&#39;. Expected one of: </span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span><span class="si">}</span><span class="s2">.&quot;</span>
            <span class="p">)</span>

        <span class="n">model</span> <span class="o">=</span> <span class="n">model_class</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">yerr</span><span class="p">,</span> <span class="n">tra_or_occ</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>


<div class="viewcode-block" id="Ephemeris">
<a class="viewcode-back" href="../../../susie.html#src.susie.ephemeris.Ephemeris">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Ephemeris</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Represents the fit model using transit or occultation mid-time data over epochs.</span>

<span class="sd">    Parameters</span>
<span class="sd">    -----------</span>
<span class="sd">    timing_data: TimingData obj</span>
<span class="sd">        A successfully instantiated TimingData object holding epochs, mid-times, and uncertainties.</span>
<span class="sd">        </span>
<span class="sd">    Raises</span>
<span class="sd">    ----------</span>
<span class="sd">     ValueError:</span>
<span class="sd">        Raised if timing_data is not an instance of the TimingData object.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">timing_data</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initializing the model object</span>

<span class="sd">        Parameters</span>
<span class="sd">        -----------</span>
<span class="sd">        timing_data: TimingData obj</span>
<span class="sd">            A successfully instantiated TimingData object holding epochs, mid-times, and uncertainties.</span>
<span class="sd">        </span>
<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">            ValueError :</span>
<span class="sd">                error raised if &#39;timing_data&#39; is not an instance of &#39;TimingData&#39; object.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">timing_data</span> <span class="o">=</span> <span class="n">timing_data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_validate</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tra_mask</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">timing_data</span><span class="o">.</span><span class="n">tra_or_occ</span> <span class="o">==</span> <span class="s2">&quot;tra&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">occ_mask</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">timing_data</span><span class="o">.</span><span class="n">tra_or_occ</span> <span class="o">==</span> <span class="s2">&quot;occ&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_validate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Check that timing_data is an instance of the TimingData object.</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">            ValueError :</span>
<span class="sd">                error raised if &#39;timing_data&#39; is not an instance of &#39;TimingData&#39; object.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">timing_data</span><span class="p">,</span> <span class="n">TimingData</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Variable &#39;timing_data&#39; expected type of object &#39;TimingData&#39;.&quot;</span><span class="p">)</span>
        
    <span class="k">def</span><span class="w"> </span><span class="nf">_get_timing_data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns timing data for use.</span>

<span class="sd">        Returns the epoch, mid-time, and mid-time uncertainty data from the TimingData object.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">            x: numpy.ndarray[int]</span>
<span class="sd">                The epoch data as recieved from the TimingData object.</span>
<span class="sd">            y: numpy.ndarray[float]</span>
<span class="sd">                The mid-time data as recieved from the TimingData object.</span>
<span class="sd">            yerr: numpy.ndarray[float]</span>
<span class="sd">                The mid-time error data as recieved from the TimingData object.</span>
<span class="sd">            tra_or_occ: numpy.ndarray[str]</span>
<span class="sd">                An array indicating the type of each event, with entries being either </span>
<span class="sd">                &quot;tra&quot; for transit or &quot;occ&quot; for occultation.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">timing_data</span><span class="o">.</span><span class="n">epochs</span>
        <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">timing_data</span><span class="o">.</span><span class="n">mid_times</span>
        <span class="n">yerr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">timing_data</span><span class="o">.</span><span class="n">mid_time_uncertainties</span>
        <span class="n">tra_or_occ</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">timing_data</span><span class="o">.</span><span class="n">tra_or_occ</span>
        <span class="k">return</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">yerr</span><span class="p">,</span> <span class="n">tra_or_occ</span>
    
    <span class="k">def</span><span class="w"> </span><span class="nf">_get_model_parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_type</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Creates and fits a model to the timing data, returning best-fit parameters.</span>

<span class="sd">        This method retrieves timing data from the `TimingData` object, selects the appropriate</span>
<span class="sd">        subclass of `BaseModel` using the `ModelFactory`, and fits the model to the data.</span>
<span class="sd">        It returns a dictionary containing the model&#39;s best-fit parameters and associated metadata.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        model_type : str</span>
<span class="sd">            The type of model to fit. Must be one of:</span>
<span class="sd">            - `&#39;linear&#39;`: Constant-period orbital model.</span>
<span class="sd">            - `&#39;quadratic&#39;`: Linear model with a period change (e.g., tidal decay).</span>
<span class="sd">            - `&#39;precession&#39;`: Model including apsidal precession.</span>

<span class="sd">        Keyword Arguments</span>
<span class="sd">        -----------------</span>
<span class="sd">        init_params : dict, optional</span>
<span class="sd">            Dictionary of initial parameter guesses to seed the fit. Required keys depend on the model type:</span>

<span class="sd">            For `&#39;linear&#39;`:</span>
<span class="sd">                - `&#39;period&#39;` (float): Estimated orbital period (in days).</span>
<span class="sd">                - `&#39;conjunction_time&#39;` (float): Reference time of mid-transit or occultation.</span>

<span class="sd">            For `&#39;quadratic&#39;`:</span>
<span class="sd">                - All `&#39;linear&#39;` parameters.</span>
<span class="sd">                - `&#39;decay_rate&#39;` (float): Change in period per epoch (in days/epoch).</span>

<span class="sd">            For `&#39;precession&#39;`:</span>
<span class="sd">                - All `&#39;linear&#39;` parameters.</span>
<span class="sd">                - `&#39;eccentricity&#39;` (float): Orbital eccentricity (unitless).</span>
<span class="sd">                - `&#39;pericenter&#39;` (float): Argument of pericenter (in radians).</span>
<span class="sd">                - `&#39;precession_rate&#39;` (float): Rate of pericenter precession per epoch (in radians/epoch).</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        model_data : dict</span>
<span class="sd">            Dictionary of best-fit parameters from the model, including:</span>

<span class="sd">            Common to all models:</span>
<span class="sd">                - `&#39;model_type&#39;`: Name of the model used (`&#39;linear&#39;`, `&#39;quadratic&#39;`, or `&#39;precession&#39;`).</span>
<span class="sd">                - `&#39;model_data&#39;`: Array of predicted mid-times using best-fit parameters.</span>
<span class="sd">                - `&#39;period&#39;`, `&#39;period_err&#39;`: Fitted orbital period and its uncertainty.</span>
<span class="sd">                - `&#39;conjunction_time&#39;`, `&#39;conjunction_time_err&#39;`: Fitted time of conjunction and its uncertainty.</span>

<span class="sd">            Additional for `&#39;quadratic&#39;`:</span>
<span class="sd">                - `&#39;period_change_by_epoch&#39;`, `&#39;period_change_by_epoch_err&#39;`: Rate of period change per epoch and its uncertainty.</span>

<span class="sd">            Additional for `&#39;precession&#39;`:</span>
<span class="sd">                - `&#39;eccentricity&#39;`, `&#39;eccentricity_err&#39;`</span>
<span class="sd">                - `&#39;pericenter&#39;`, `&#39;pericenter_err&#39;`</span>
<span class="sd">                - `&#39;pericenter_change_by_epoch&#39;`, `&#39;pericenter_change_by_epoch_err&#39;`: Precession rate and its uncertainty.</span>
<span class="sd">                    }</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        ValueError</span>
<span class="sd">            If `model_type` is not one of `&#39;linear&#39;`, `&#39;quadratic&#39;`, or `&#39;precession&#39;`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Step 1: Get data from transit times obj</span>
        <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">yerr</span><span class="p">,</span> <span class="n">tra_or_occ</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_timing_data</span><span class="p">()</span>
        <span class="c1"># Step 2: Create the model with the given variables &amp; user inputs. </span>
        <span class="c1"># This will return a dictionary with the best-fit parameters as key value pairs.</span>
        <span class="n">model_data</span> <span class="o">=</span> <span class="n">ModelFactory</span><span class="o">.</span><span class="n">create_model</span><span class="p">(</span><span class="n">model_type</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">yerr</span><span class="p">,</span> <span class="n">tra_or_occ</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="c1"># Step 3: Return the data dictionary with the best-fit parameters</span>
        <span class="k">return</span> <span class="n">model_data</span>
    
    <span class="k">def</span><span class="w"> </span><span class="nf">_get_k_value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_type</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns the number of fit parameters for a given model.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">            model_type: str</span>
<span class="sd">                Either &#39;linear&#39;, &#39;quadratic&#39;, or &#39;precession&#39;, used to specify how many fit parameters are present in the model.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">            An int representing the number of fit parameters for the model. This will be: </span>
<span class="sd">                * 2 for a linear model </span>
<span class="sd">                * 3 for a quadratic model</span>
<span class="sd">                * 5 for a precession model</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">            ValueError</span>
<span class="sd">                If the model_type is an unsupported model type. Currently supported model types are </span>
<span class="sd">                &#39;linear&#39;, &#39;quadratic&#39;, and &#39;precession&#39;.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">model_type</span> <span class="o">==</span> <span class="s1">&#39;linear&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">2</span>
        <span class="k">elif</span> <span class="n">model_type</span> <span class="o">==</span> <span class="s1">&#39;quadratic&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">3</span>
        <span class="k">elif</span> <span class="n">model_type</span> <span class="o">==</span> <span class="s1">&#39;precession&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">5</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Only linear, quadratic, and precession ephemerides are supported at this time.&#39;</span><span class="p">)</span>
    
    <span class="k">def</span><span class="w"> </span><span class="nf">_calc_anomalistic_period</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">P</span><span class="p">,</span> <span class="n">dwdE</span><span class="p">):</span>
<span class="w">       </span><span class="sd">&quot;&quot;&quot;Calculates the anomalistic period given values of sidereal period and precession rate (change in pericenter over epoch).</span>

<span class="sd">        Uses the equation</span>
<span class="sd">        :math:`\\frac{P}{(1 - \\frac{1}{2*\\pi})*frac{dw}{dE}}`</span>
<span class="sd">       </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">            P: float</span>
<span class="sd">                The exoplanet sidereal orbital period.</span>
<span class="sd">            dwdE: float</span>
<span class="sd">                The precession rate, which is the change in pericenter with respect to epoch.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">            A float of the calculated anomalistic period.</span>
<span class="sd">       &quot;&quot;&quot;</span>
       <span class="n">result</span> <span class="o">=</span> <span class="n">P</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">))</span><span class="o">*</span><span class="n">dwdE</span><span class="p">)</span>
       <span class="k">return</span> <span class="n">result</span>
    
    <span class="k">def</span><span class="w"> </span><span class="nf">_calc_pericenter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">E</span><span class="p">,</span> <span class="n">w0</span><span class="p">,</span> <span class="n">dwdE</span><span class="p">):</span>
<span class="w">       </span><span class="sd">&quot;&quot;&quot;Calculates the pericenter given a list of epochs and values of argument of pericenter and precession rate (change in pericenter with respect to epoch).</span>

<span class="sd">        Uses the equation</span>
<span class="sd">        :math:`w0 + \\frac{dw}{dE} * E`</span>


<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">            E: numpy.ndarray[int]</span>
<span class="sd">                The epochs.</span>
<span class="sd">            w0: int</span>
<span class="sd">                The pericenter.</span>
<span class="sd">            dwdE: float</span>
<span class="sd">                Change in pericenter with respect to epoch.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">           A numpy.ndarray[float] of the calculated pericenter as a function of epochs.</span>
<span class="sd">       &quot;&quot;&quot;</span>
       <span class="n">result</span> <span class="o">=</span> <span class="n">w0</span> <span class="o">+</span> <span class="n">dwdE</span><span class="o">*</span><span class="n">E</span>
       <span class="k">return</span> <span class="n">result</span>
    
    <span class="k">def</span><span class="w"> </span><span class="nf">_calc_linear_model_uncertainties</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">T0_err</span><span class="p">,</span> <span class="n">P_err</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Calculates the uncertainties of a given linear model when compared to observed data in TimingData.</span>
<span class="sd">        </span>
<span class="sd">        Uses the equation </span>
<span class="sd">         - .. math::</span>
<span class="sd">            \\sigma(\\text{t pred, tra}) = \\sqrt{(\\sigma(T_0)^2 + \\sigma(P)^2 * E^2)}</span>
<span class="sd">            for transit observations</span>
<span class="sd">         - .. math::</span>
<span class="sd">            \\sigma(\\text{t pred, tra}) = \\sqrt{(\\sigma(T_0)^2 + \\sigma(P)^2 * (\\frac{1}{2} + E)^2)}</span>
<span class="sd">            for occultation observations</span>
<span class="sd">         - σ(t pred, tra) = √(σ(T0)² + σ(P)² * E²) for transit observations</span>
<span class="sd">         - σ(t pred, occ) = √(σ(T0)² + σ(P)² * (½ + E)²) for occultation observations</span>
<span class="sd">         </span>
<span class="sd">        where σ(T0)=conjunction time error, E=epoch, and σ(P)=period error, to calculate the uncertainties </span>
<span class="sd">        between the model data and observed data.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">            T0_err: float</span>
<span class="sd">                The error associated with the best-fit conjunction time from a linear model.</span>
<span class="sd">            P_err: float</span>
<span class="sd">                The error associated with the best-fit period from a linear model.</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">            A list of uncertainties associated with the model passed in, calculated with the </span>
<span class="sd">            equation above and the TimingData epochs.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">timing_data</span><span class="o">.</span><span class="n">epochs</span><span class="p">))</span>
        <span class="n">result</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">tra_mask</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">T0_err</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">timing_data</span><span class="o">.</span><span class="n">epochs</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">tra_mask</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">P_err</span><span class="o">**</span><span class="mi">2</span><span class="p">)))</span>
        <span class="n">result</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">occ_mask</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">T0_err</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="p">(((</span><span class="bp">self</span><span class="o">.</span><span class="n">timing_data</span><span class="o">.</span><span class="n">epochs</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">occ_mask</span><span class="p">]</span><span class="o">+</span><span class="mf">0.5</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">P_err</span><span class="o">**</span><span class="mi">2</span><span class="p">)))</span>
        <span class="k">return</span> <span class="n">result</span>
    
    <span class="k">def</span><span class="w"> </span><span class="nf">_calc_quadratic_model_uncertainties</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">T0_err</span><span class="p">,</span> <span class="n">P_err</span><span class="p">,</span> <span class="n">dPdE_err</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Calculates the uncertainties of a given quadratic model when compared to observed data in TimingData.</span>
<span class="sd">        </span>
<span class="sd">        Uses the equation </span>
<span class="sd">         - .. math::</span>
<span class="sd">            \\sigma(\\text{t pred, tra}) = \\sqrt{(\\sigma(T_0)^2 + (\\sigma(P)^2 * E^2) + (\\frac{1}{4} * \\sigma(\\frac{dP}{dE})^2 * E^4))} </span>
<span class="sd">            for transit observations</span>
<span class="sd">         - .. math::</span>
<span class="sd">            \\sigma(\\text{t pred, tra}) = \\sqrt{(\\sigma(T_0)^2 + (\\sigma(P)^2 * (\\frac{1}{2} + E^2)) + (\\frac{1}{4} * \\sigma(\\frac{dP}{dE})^2 * E^4))} </span>
<span class="sd">            for occultation observation��(σ(T0)² + (σ(P)² * E²) + (¼ * σ(dP/dE)² * E⁴)) for transit observation</span>
<span class="sd">         - σ(t pred, occ) = √(σ(T0)² + (σ(P)² * (½ + E)²) + (¼ * σ(dP/dE)² * E⁴)) for occultation observations</span>
<span class="sd">        where σ(T0)=conjunction time error, E=epoch, σ(P)=period error, and σ(dP/dE)=period change with respect </span>
<span class="sd">        to epoch error, to calculate the uncertainties between the model data and the observed data.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">            T0_err: float</span>
<span class="sd">                The error associated with the best-fit conjunction time from a quadratic model.</span>
<span class="sd">            P_err: float</span>
<span class="sd">                The error associated with the best-fit period from a quadratic model.</span>
<span class="sd">            dPdE_err: float</span>
<span class="sd">                The error associated with the best-fit decay rate from a quadratic model.</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">            A list of uncertainties associated with the model passed in, calculated with the </span>
<span class="sd">            equation above and the TimingData epochs.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">timing_data</span><span class="o">.</span><span class="n">epochs</span><span class="p">))</span>
        <span class="n">result</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">tra_mask</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">T0_err</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">timing_data</span><span class="o">.</span><span class="n">epochs</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">tra_mask</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">P_err</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span> <span class="o">+</span> <span class="p">((</span><span class="mi">1</span><span class="o">/</span><span class="mi">4</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">timing_data</span><span class="o">.</span><span class="n">epochs</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">tra_mask</span><span class="p">]</span><span class="o">**</span><span class="mi">4</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">dPdE_err</span><span class="o">**</span><span class="mi">2</span><span class="p">)))</span>
        <span class="n">result</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">occ_mask</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">T0_err</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="p">(((</span><span class="bp">self</span><span class="o">.</span><span class="n">timing_data</span><span class="o">.</span><span class="n">epochs</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">occ_mask</span><span class="p">]</span><span class="o">+</span><span class="mf">0.5</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">P_err</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span> <span class="o">+</span> <span class="p">((</span><span class="mi">1</span><span class="o">/</span><span class="mi">4</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">timing_data</span><span class="o">.</span><span class="n">epochs</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">occ_mask</span><span class="p">]</span><span class="o">**</span><span class="mi">4</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">dPdE_err</span><span class="o">**</span><span class="mi">2</span><span class="p">)))</span>
        <span class="k">return</span> <span class="n">result</span>
    
    <span class="c1"># ————————————————————WORK IN PROGRESS—————————————————————————————</span>

    <span class="c1"># # Precession Uncertainites</span>
    <span class="c1"># def _calc_t0_model_uncertainty(self, T0_err):</span>
    <span class="c1">#     return T0_err**2</span>

    <span class="c1"># def _calc_eccentricity_model_uncertainty(self, P, dwdE, w0, E, e_err):</span>
    <span class="c1">#     return (-P/((1-(1/(2*np.pi))*dwdE)*np.pi) * np.cos(w0 + dwdE*E))**2 * e_err**2</span>

    <span class="c1"># def _calc_pericenter_model_uncertainty(self, e, P, dwdE, w0, E, w0_err):</span>
    <span class="c1">#     return ((e*P)/((1-(1/(2*np.pi))*dwdE)*np.pi) * np.sin(w0 + dwdE*E))**2 * w0_err**2</span>
    
    <span class="c1"># def _calc_change_in_pericenter_transit_model_uncertainty(self, e, P, dwdE, w0, E, dwdE_err):</span>
    <span class="c1">#     return (((-2*e*P)/((1-(1/(2*np.pi))*dwdE)**2)) * np.cos(w0 + dwdE*E) + E*np.sin(w0 + dwdE*E) * ((-e*P)/((1-(1/(2*np.pi))*dwdE)*np.pi)))**2 * dwdE_err**2</span>
    
    <span class="c1"># def _calc_change_in_pericenter_occ_model_uncertainty(self, e, P, dwdE, w0, E, dwdE_err):</span>
    <span class="c1">#     return (((np.pi*P)/((1-(1/(2*np.pi))*dwdE)**2)) + ((2*e*P)/((1-(1/(2*np.pi))*dwdE)**2)) * np.cos(w0 + dwdE*E) + E*np.sin(w0 + dwdE*E) * ((e*P)/((1-(1/(2*np.pi))*dwdE)*np.pi)))**2 * dwdE_err**2</span>

    <span class="c1"># def _calc_period_transit_model_uncertainty(self, e, dwdE, w0, E, P_err):</span>
    <span class="c1">#     return (E - e/((1-(1/(2*np.pi))*dwdE)*np.pi) * np.cos(w0 + dwdE*E))**2 * P_err**2</span>
        
    <span class="c1"># def _calc_period_occ_model_uncertainty(self, e, dwdE, w0, E, P_err):</span>
    <span class="c1">#     return (E + e/(2*(1-(1/(2*np.pi))*dwdE)) + e/((1-(1/(2*np.pi))*dwdE)*np.pi)* np.cos(w0 + dwdE*E))**2 * P_err**2</span>

    <span class="c1"># # def _get_precession_model_partial_derivatives(self, tra_or_occ, epoch)</span>
    <span class="c1"># #     if tra:</span>
    <span class="c1"># #         return [self._calc_t0_model_uncertainty(T0), self._calc_eccentricity_model_uncertainty(P, dwdE, w0, epoch, e_err), self._calc_pericenter_model_uncertainty(e, P, dwdE, w0, epoch, w0_err), self._calc_change_in_pericenter_transit_model_uncertainty( e, P, dwdE, w0, epoch, dwdE_err), self._calc_period_transit_model_uncertainty(e, dwdE, w0,  self.timing_data.epochs[i], P_err)]</span>
    
    <span class="c1"># def _calc_precession_model_uncertainties(self, model_params):</span>
    <span class="c1">#     T0_err = model_params[&#39;conjunction_time_err&#39;]</span>
    <span class="c1">#     P_err = model_params[&#39;period_err&#39;]</span>
    <span class="c1">#     dwdE_err = model_params[&#39;pericenter_change_by_epoch_err&#39;]</span>
    <span class="c1">#     e_err = model_params[&#39;eccentricity_err&#39;]</span>
    <span class="c1">#     w0_err = model_params[&#39;pericenter_err&#39;]</span>
    <span class="c1">#     T0 = model_params[&#39;conjunction_time&#39;]</span>
    <span class="c1">#     P = model_params[&#39;period&#39;]</span>
    <span class="c1">#     dwdE = model_params[&#39;pericenter_change_by_epoch&#39;]</span>
    <span class="c1">#     e = model_params[&#39;eccentricity&#39;]</span>
    <span class="c1">#     w0 = model_params[&#39;pericenter&#39;]       </span>
    <span class="c1">#     result = []</span>
    <span class="c1">#     for i, t_type in enumerate(self.timing_data.tra_or_occ):</span>
    <span class="c1">#         if t_type == &#39;tra&#39;:</span>
    <span class="c1">#             # transit data</span>
    <span class="c1">#             result.append(np.sqrt(self._calc_t0_model_uncertainty(T0_err) + self._calc_eccentricity_model_uncertainty(P, dwdE, w0,self.timing_data.epochs[i], e_err) + self._calc_pericenter_model_uncertainty(e, P, dwdE, w0, self.timing_data.epochs[i], w0_err) + self._calc_change_in_pericenter_transit_model_uncertainty( e, P, dwdE, w0, self.timing_data.epochs[i], dwdE_err) + self._calc_period_transit_model_uncertainty(e, dwdE, w0,  self.timing_data.epochs[i], P_err)))</span>
    <span class="c1">#         elif t_type == &#39;occ&#39;:</span>
    <span class="c1">#             # occultation data</span>
    <span class="c1">#             result.append(np.sqrt(self._calc_t0_model_uncertainty(T0_err) + self._calc_eccentricity_model_uncertainty(P, dwdE, w0,self.timing_data.epochs[i], e_err) + self._calc_pericenter_model_uncertainty(e, P, dwdE, w0, self.timing_data.epochs[i], w0_err) + self._calc_change_in_pericenter_occ_model_uncertainty( e, P, dwdE, w0, self.timing_data.epochs[i], dwdE_err) + self._calc_period_occ_model_uncertainty(e, dwdE, w0,  self.timing_data.epochs[i], P_err)))</span>
    <span class="c1">#     return np.array(result)</span>

    <span class="c1"># ———————————————————————————————————————————————————————————————————————————————————————————</span>
    
    <span class="k">def</span><span class="w"> </span><span class="nf">_calc_linear_model</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">E</span><span class="p">,</span> <span class="n">T0</span><span class="p">,</span> <span class="n">P</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Calculates mid-times using best-fit parameter values from a linear model fit.</span>
<span class="sd">        </span>
<span class="sd">        Uses the equation:</span>
<span class="sd">         - (T0 + PE) for transit observations</span>
<span class="sd">         - ((T0 + ½P) + PE) for occultation observations</span>
<span class="sd">        to calculate the mid-times for each epoch where T0 is conjunction time, P is period, </span>
<span class="sd">        and E is epoch.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">            E: numpy.ndarray[int]</span>
<span class="sd">                The epochs pulled from the TimingData object.</span>
<span class="sd">            T0: float</span>
<span class="sd">                The best-fit conjunction time from a linear model fit.</span>
<span class="sd">            P: float</span>
<span class="sd">                The best-fit orbital period from a linear model fit.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">            A numpy array of mid-times calculated for each epoch.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">timing_data</span><span class="o">.</span><span class="n">epochs</span><span class="p">))</span>
        <span class="n">result</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">tra_mask</span><span class="p">]</span> <span class="o">=</span> <span class="n">T0</span> <span class="o">+</span> <span class="p">(</span><span class="n">P</span><span class="o">*</span><span class="n">E</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">tra_mask</span><span class="p">])</span>
        <span class="n">result</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">occ_mask</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">T0</span> <span class="o">+</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">P</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">P</span><span class="o">*</span><span class="n">E</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">occ_mask</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">result</span>
    
    <span class="k">def</span><span class="w"> </span><span class="nf">_calc_quadratic_model</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">E</span><span class="p">,</span> <span class="n">T0</span><span class="p">,</span> <span class="n">P</span><span class="p">,</span> <span class="n">dPdE</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Calculates mid-times using best-fit parameter values from a quadratic model fit.</span>

<span class="sd">        Uses the equation:</span>
<span class="sd">         - (T0 + PE + (½ * dPdE * E²)) for transit observations</span>
<span class="sd">         - ((T0 + ½P) + PE + (½ * dPdE * E²)) for occultation observations</span>
<span class="sd">        to calculate the mid-times over each epoch where T0 is conjunction time, P is period, E is epoch, </span>
<span class="sd">        and dPdE is the orbital decay rate (period change with respect to epoch).</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">            E: numpy.ndarray[int]</span>
<span class="sd">                The epochs pulled from the TimingData object.</span>
<span class="sd">            T0: float</span>
<span class="sd">                The best-fit conjunction time from a quadratic model fit.</span>
<span class="sd">            P: float</span>
<span class="sd">                The best-fit orbital period from a quadratic model fit.</span>
<span class="sd">            dPdE: float</span>
<span class="sd">                The best-fit orbital decay rate (period change with respect to epoch) from a quadratic model fit.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">            A numpy array of mid-times calculated for each epoch.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">timing_data</span><span class="o">.</span><span class="n">epochs</span><span class="p">))</span>
        <span class="n">result</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">tra_mask</span><span class="p">]</span> <span class="o">=</span> <span class="n">T0</span> <span class="o">+</span> <span class="n">P</span><span class="o">*</span><span class="n">E</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">tra_mask</span><span class="p">]</span> <span class="o">+</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">dPdE</span><span class="o">*</span><span class="n">E</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">tra_mask</span><span class="p">]</span><span class="o">*</span><span class="n">E</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">tra_mask</span><span class="p">]</span>
        <span class="n">result</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">occ_mask</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">T0</span> <span class="o">+</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">P</span><span class="p">)</span> <span class="o">+</span> <span class="n">P</span><span class="o">*</span><span class="n">E</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">occ_mask</span><span class="p">]</span> <span class="o">+</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">dPdE</span><span class="o">*</span><span class="n">E</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">occ_mask</span><span class="p">]</span><span class="o">*</span><span class="n">E</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">occ_mask</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">result</span>
    
    <span class="k">def</span><span class="w"> </span><span class="nf">_calc_precession_model</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">E</span><span class="p">,</span> <span class="n">T0</span><span class="p">,</span> <span class="n">P</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">w0</span><span class="p">,</span> <span class="n">dwdE</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Calculates mid-times using best-fit parameter values from a precession model fit.</span>

<span class="sd">        Uses the equation:</span>
<span class="sd">         -  T0 + E*P - (e*anomalistic period)/pi * cos(pericenter) for transit observations</span>
<span class="sd">         -  T0 + (anomalistic period / 2) + (e*anomalistic period)/pi * cos(pericenter) for occultation observations</span>
<span class="sd">        to calculate the mid-times over each epoch where T0 is conjunction time, P is sideral period, E is epoch, </span>
<span class="sd">        dwdE is the precession rate (pericenter change with respect to epoch), w0 is the argument of pericenter, </span>
<span class="sd">        and e is eccentricity.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">            E: numpy.ndarray[int]</span>
<span class="sd">                The epochs.</span>
<span class="sd">            T0: float</span>
<span class="sd">                The initial mid-time, also known as conjunction time.</span>
<span class="sd">            P: float</span>
<span class="sd">                The sideral orbital period of the exoplanet.</span>
<span class="sd">            e: float</span>
<span class="sd">                The eccentricity.</span>
<span class="sd">            w0: int</span>
<span class="sd">                The argument of pericenter.</span>
<span class="sd">            dwdE: float</span>
<span class="sd">                The precession rate, which is the change in pericenter with respect to epoch.</span>
<span class="sd">            tra_or_occ: numpy.ndarray[str]</span>
<span class="sd">                An array indicating the type of each event, with entries being either </span>
<span class="sd">                &quot;tra&quot; for transit or &quot;occ&quot; for occultation.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">            A numpy array of mid-times calculated for each epoch.</span>
<span class="sd">        &quot;&quot;&quot;</span> 
        <span class="n">result</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">timing_data</span><span class="o">.</span><span class="n">epochs</span><span class="p">))</span>
        <span class="n">result</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">tra_mask</span><span class="p">]</span> <span class="o">=</span> <span class="n">T0</span> <span class="o">+</span> <span class="n">E</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">tra_mask</span><span class="p">]</span><span class="o">*</span><span class="n">P</span> <span class="o">-</span> <span class="p">((</span><span class="n">e</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">_calc_anomalistic_period</span><span class="p">(</span><span class="n">P</span><span class="p">,</span> <span class="n">dwdE</span><span class="p">))</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_calc_pericenter</span><span class="p">(</span><span class="n">E</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">tra_mask</span><span class="p">],</span> <span class="n">w0</span><span class="p">,</span> <span class="n">dwdE</span><span class="p">))</span>
        <span class="n">result</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">occ_mask</span><span class="p">]</span> <span class="o">=</span> <span class="n">T0</span> <span class="o">+</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_calc_anomalistic_period</span><span class="p">(</span><span class="n">P</span><span class="p">,</span> <span class="n">dwdE</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">E</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">occ_mask</span><span class="p">]</span><span class="o">*</span><span class="n">P</span><span class="p">)</span> <span class="o">+</span> <span class="p">((</span><span class="n">e</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">_calc_anomalistic_period</span><span class="p">(</span><span class="n">P</span><span class="p">,</span> <span class="n">dwdE</span><span class="p">))</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_calc_pericenter</span><span class="p">(</span><span class="n">E</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">occ_mask</span><span class="p">],</span> <span class="n">w0</span><span class="p">,</span> <span class="n">dwdE</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">result</span>
    
    <span class="k">def</span><span class="w"> </span><span class="nf">_calc_sum_of_errs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">numerator</span><span class="p">,</span> <span class="n">denominator</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Calculates the sum of minimized errors. </span>

<span class="sd">            Equations are pulled from &quot;Numerical Recipes: The Art of Scientific Computing&quot;</span>
<span class="sd">            3rd Edition by Press et. al on page 781 (eq. 15.2.4). </span>

<span class="sd">            Σ (numerator / (denominator)²)</span>

<span class="sd">            Parameters</span>
<span class="sd">            ----------</span>
<span class="sd">                numerator: np.array[float]</span>
<span class="sd">                    The numerator value.</span>
<span class="sd">                denominator: np.array[float]</span>
<span class="sd">                    The denominator value.</span>

<span class="sd">            Returns</span>
<span class="sd">            -------</span>
<span class="sd">                A calculated float value using the equation: Σ (numerator / (denominator)²)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">((</span><span class="n">numerator</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">denominator</span><span class="p">,</span> <span class="mi">2</span><span class="p">)))</span>
   
    <span class="k">def</span><span class="w"> </span><span class="nf">_calc_chi_squared</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_mid_times</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Calculates the residual chi squared values comparing the model fit and observed data.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">            model_mid_times : numpy.ndarray[float]</span>
<span class="sd">                Mid-times calculated from an model. This data can be accessed through the &#39;model_data&#39;</span>
<span class="sd">                key from a returned model data dictionary. </span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">            Chi-squared value : float</span>
<span class="sd">                The chi-squared value calculated with the equation:</span>
<span class="sd">                Σ(((observed mid-times - model calculated mid-times) / observed mid-time uncertainties)²)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># STEP 1: Get observed mid-times</span>
        <span class="n">observed_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">timing_data</span><span class="o">.</span><span class="n">mid_times</span>
        <span class="n">uncertainties</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">timing_data</span><span class="o">.</span><span class="n">mid_time_uncertainties</span>
        <span class="c1"># STEP 2: calculate X² with observed data and model data</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(((</span><span class="n">observed_data</span> <span class="o">-</span> <span class="n">model_mid_times</span><span class="p">)</span><span class="o">/</span><span class="n">uncertainties</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
    
    <span class="k">def</span><span class="w"> </span><span class="nf">_calc_delta_T0_prime_quad</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Calculates the value of ΔT0&#39; for a quadratic model, used in the analytical ΔBIC equation.</span>

<span class="sd">            Equation is pulled Metrics for Optimizing Searches for Tidally Decaying Exoplanets by </span>
<span class="sd">            Jackson et. al (2023) (eq. 32).</span>

<span class="sd">            ΔT0&#39; = (S_(e²)² - S_(e³)*S_e) / (S_(e²)*S - S_e²)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">sigma</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">timing_data</span><span class="o">.</span><span class="n">mid_time_uncertainties</span>
        <span class="n">epochs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">timing_data</span><span class="o">.</span><span class="n">epochs</span>
        <span class="n">S</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calc_sum_of_errs</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">sigma</span><span class="p">)</span>
        <span class="n">S_e</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calc_sum_of_errs</span><span class="p">(</span><span class="n">epochs</span><span class="p">,</span> <span class="n">sigma</span><span class="p">)</span>
        <span class="n">S_e2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calc_sum_of_errs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">epochs</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">sigma</span><span class="p">)</span>
        <span class="n">S_e3</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calc_sum_of_errs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">epochs</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">sigma</span><span class="p">)</span>
        <span class="n">delta_T0_prime</span> <span class="o">=</span> <span class="p">(</span><span class="n">S_e2</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="p">(</span><span class="n">S_e3</span><span class="o">*</span><span class="n">S_e</span><span class="p">))</span> <span class="o">/</span> <span class="p">((</span><span class="n">S_e2</span><span class="o">*</span><span class="n">S</span><span class="p">)</span> <span class="o">-</span> <span class="n">S_e</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">delta_T0_prime</span>
    
    <span class="k">def</span><span class="w"> </span><span class="nf">_calc_delta_P_prime_quad</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Calculates the value of ΔP&#39; for a quadratic model, used in the analytical ΔBIC equation.</span>
<span class="sd">            </span>
<span class="sd">            Equation is pulled Metrics for Optimizing Searches for Tidally Decaying Exoplanets by </span>
<span class="sd">            Jackson et. al (2023) (eq. 33).</span>
<span class="sd">            </span>
<span class="sd">            ΔP&#39; = (S_(e³)*S - S_(e²)*S_e) / (S_(e²)*S - S_e²)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">sigma</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">timing_data</span><span class="o">.</span><span class="n">mid_time_uncertainties</span>
        <span class="n">epochs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">timing_data</span><span class="o">.</span><span class="n">epochs</span>
        <span class="n">S</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calc_sum_of_errs</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">sigma</span><span class="p">)</span>
        <span class="n">S_e</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calc_sum_of_errs</span><span class="p">(</span><span class="n">epochs</span><span class="p">,</span> <span class="n">sigma</span><span class="p">)</span>
        <span class="n">S_e2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calc_sum_of_errs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">epochs</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">sigma</span><span class="p">)</span>
        <span class="n">S_e3</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calc_sum_of_errs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">epochs</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">sigma</span><span class="p">)</span>
        <span class="n">delta_P_prime</span> <span class="o">=</span> <span class="p">(</span><span class="n">S_e3</span><span class="o">*</span><span class="n">S</span> <span class="o">-</span> <span class="n">S_e2</span><span class="o">*</span><span class="n">S_e</span><span class="p">)</span> <span class="o">/</span> <span class="p">((</span><span class="n">S_e2</span><span class="o">*</span><span class="n">S</span><span class="p">)</span> <span class="o">-</span> <span class="n">S_e</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">delta_P_prime</span>
    
    <span class="k">def</span><span class="w"> </span><span class="nf">_calc_analytical_delta_bic_quad</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dPdE</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Calculates the analytical ΔBIC for a quadratic model.</span>

<span class="sd">            Equation is pulled Metrics for Optimizing Searches for Tidally Decaying Exoplanets by </span>
<span class="sd">            Jackson et. al (2023) (eq. 35).</span>

<span class="sd">            ΔBIC = 0.25(dPdE)² * sum(((E² - ΔP&#39;*E - ΔT0&#39;) / (uncertainties))²) - ln(N) + 1</span>
<span class="sd">            Where dPdE is the orbital decay rate, E are epochs, uncertainties are the uncertainties on the</span>
<span class="sd">            observed mid-times, and N is the total number of data points. Equations for ΔP&#39; and ΔT0&#39; can be </span>
<span class="sd">            found in the methods for _calc_delta_P_prime_quad and _calc_delta_T0_prime_quad.</span>

<span class="sd">            Parameters</span>
<span class="sd">            ----------</span>
<span class="sd">                dPdE: float</span>
<span class="sd">                    The best-fit parameter value for the orbital decay rate from a quadratic model fit.</span>

<span class="sd">            Returns</span>
<span class="sd">            -------</span>
<span class="sd">                analytical_delta_bic: np.ndarray[float]</span>
<span class="sd">                    The values of the analytical ΔBIC for each epoch.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">epochs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">timing_data</span><span class="o">.</span><span class="n">epochs</span>
        <span class="n">uncertainties</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">timing_data</span><span class="o">.</span><span class="n">mid_time_uncertainties</span>
        <span class="n">delta_P_prime</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calc_delta_P_prime_quad</span><span class="p">()</span>
        <span class="n">delta_T0_prime</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calc_delta_T0_prime_quad</span><span class="p">()</span>
        <span class="n">quad_param</span> <span class="o">=</span> <span class="mf">0.25</span> <span class="o">*</span> <span class="p">(</span><span class="n">dPdE</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">quad_sum</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(((</span><span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">epochs</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="n">delta_P_prime</span><span class="o">*</span><span class="n">epochs</span><span class="p">)</span> <span class="o">-</span> <span class="n">delta_T0_prime</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">uncertainties</span><span class="p">)),</span> <span class="mi">2</span><span class="p">))</span>
        <span class="n">analytical_delta_bic</span> <span class="o">=</span> <span class="n">quad_param</span> <span class="o">*</span> <span class="n">quad_sum</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">epochs</span><span class="p">))</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="k">return</span> <span class="n">analytical_delta_bic</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_calc_delta_P_prime_prec</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">w0</span><span class="p">,</span> <span class="n">dwdE</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Calculates the value of ΔP&#39; for a precession model, used in the analytical ΔBIC equation.</span>
<span class="sd">        </span>
<span class="sd">        deltaP_s&#39; = [(S_E * S_cos(omega) - S * S_E,cos(omega)) / (S * S_(E^2) - S_E^2)]</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">            timing_uncertainties: np.ndarray(float)</span>
<span class="sd">                The uncertainties of the observed mid-times.</span>
<span class="sd">            epochs: np.ndarray(int)</span>
<span class="sd">                Epochs of observations</span>
<span class="sd">            w_0: float</span>
<span class="sd">                The argument of pericenter, or &quot;pericenter&quot; from the precession model</span>
<span class="sd">            dwdE: float</span>
<span class="sd">                dwdE or &quot;change in pericenter over epochs&quot; from the precession model</span>
<span class="sd">                </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">            delta_P_prime: np.ndarray(float)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">epochs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">timing_data</span><span class="o">.</span><span class="n">epochs</span>
        <span class="n">sigma</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">timing_data</span><span class="o">.</span><span class="n">mid_time_uncertainties</span>
        <span class="n">cosw</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">w0</span> <span class="o">+</span> <span class="n">dwdE</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">timing_data</span><span class="o">.</span><span class="n">epochs</span><span class="p">)</span>
        <span class="n">S</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calc_sum_of_errs</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">sigma</span><span class="p">)</span>
        <span class="n">S_e</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calc_sum_of_errs</span><span class="p">(</span><span class="n">epochs</span><span class="p">,</span> <span class="n">sigma</span><span class="p">)</span>
        <span class="n">S_e2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calc_sum_of_errs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">epochs</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">sigma</span><span class="p">)</span>
        <span class="n">S_cosw</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calc_sum_of_errs</span><span class="p">(</span><span class="n">cosw</span><span class="p">,</span> <span class="n">sigma</span><span class="p">)</span>
        <span class="n">S_e_cosw</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calc_sum_of_errs</span><span class="p">((</span><span class="n">epochs</span><span class="o">*</span><span class="n">cosw</span><span class="p">),</span> <span class="n">sigma</span><span class="p">)</span>
        <span class="n">delta_P_prime</span> <span class="o">=</span> <span class="p">((</span><span class="n">S_e</span> <span class="o">*</span> <span class="n">S_cosw</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="n">S</span> <span class="o">*</span> <span class="n">S_e_cosw</span><span class="p">))</span> <span class="o">/</span> <span class="p">((</span><span class="n">S</span> <span class="o">*</span> <span class="n">S_e2</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="n">S_e</span> <span class="o">*</span> <span class="n">S_e</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">delta_P_prime</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_calc_delta_T0_prime_prec</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">w0</span><span class="p">,</span> <span class="n">dwdE</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Calculates the value of ΔT0&#39; for a precession model, used in the analytical ΔBIC equation.</span>
<span class="sd">        </span>
<span class="sd">        deltaT_0&#39; = [(S_E * S_E,cos(omega) - S_(E^2) * S_cos(omega)) / (S * S_(E^2) - S_E^2)]</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">            timing_uncertainties: np.ndarray(float)</span>
<span class="sd">                The uncertainties ???</span>
<span class="sd">            epochs: np.ndarray(int)</span>
<span class="sd">                Epochs of observations</span>
<span class="sd">            w_0: float</span>
<span class="sd">                Omega_0 or &quot;pericenter&quot; from the precession model</span>
<span class="sd">            dwdE: float</span>
<span class="sd">                dwdE or &quot;change in pericenter over epochs&quot; from the precession model</span>
<span class="sd">                </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">            delta_T0_prime: np.ndarray(float)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">epochs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">timing_data</span><span class="o">.</span><span class="n">epochs</span>
        <span class="n">sigma</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">timing_data</span><span class="o">.</span><span class="n">mid_time_uncertainties</span>
        <span class="n">cosw</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">w0</span><span class="o">+</span><span class="n">dwdE</span><span class="o">*</span><span class="n">epochs</span><span class="p">)</span>
        <span class="n">S</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calc_sum_of_errs</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">sigma</span><span class="p">)</span>
        <span class="n">S_e</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calc_sum_of_errs</span><span class="p">(</span><span class="n">epochs</span><span class="p">,</span> <span class="n">sigma</span><span class="p">)</span>
        <span class="n">S_e2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calc_sum_of_errs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">epochs</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">sigma</span><span class="p">)</span>
        <span class="n">S_cosw</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calc_sum_of_errs</span><span class="p">(</span><span class="n">cosw</span><span class="p">,</span> <span class="n">sigma</span><span class="p">)</span>
        <span class="n">S_e_cosw</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calc_sum_of_errs</span><span class="p">((</span><span class="n">epochs</span><span class="o">*</span><span class="n">cosw</span><span class="p">),</span> <span class="n">sigma</span><span class="p">)</span>
        <span class="n">delta_T0_prime</span> <span class="o">=</span> <span class="p">((</span><span class="n">S_e</span> <span class="o">*</span> <span class="n">S_e_cosw</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="n">S_e2</span> <span class="o">*</span> <span class="n">S_cosw</span><span class="p">))</span> <span class="o">/</span> <span class="p">((</span><span class="n">S</span> <span class="o">*</span> <span class="n">S_e2</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="n">S_e</span> <span class="o">*</span> <span class="n">S_e</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">delta_T0_prime</span>
    
    <span class="k">def</span><span class="w"> </span><span class="nf">_calc_analytical_delta_bic_prec</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Pa</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">w0</span><span class="p">,</span> <span class="n">dwdE</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Calculates the analytical ΔBIC for a precession model.</span>

<span class="sd">        delta BIC = ((e*P_a)/pi)^2 * sum(from i = 0 to N-1) [(timing uncertainties_i)^-2 * (cos(omega_i) + E_i * deltaP_s&#39; + deltaT_0&#39;)^2 -3 ln(N) + 3]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">epochs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">timing_data</span><span class="o">.</span><span class="n">epochs</span>
        <span class="n">sigma</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">timing_data</span><span class="o">.</span><span class="n">mid_time_uncertainties</span>
        <span class="n">cosw</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">w0</span> <span class="o">+</span> <span class="n">dwdE</span><span class="o">*</span><span class="n">epochs</span><span class="p">)</span>
        <span class="c1"># QUESTION: Does this period need to be recalculated at each step or is this also a constant</span>
        <span class="n">delta_T0_prime</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calc_delta_T0_prime_prec</span><span class="p">(</span><span class="n">w0</span><span class="p">,</span> <span class="n">dwdE</span><span class="p">)</span>
        <span class="n">delta_P_prime</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calc_delta_P_prime_prec</span><span class="p">(</span><span class="n">w0</span><span class="p">,</span> <span class="n">dwdE</span><span class="p">)</span>
        <span class="n">amplitude</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(((</span><span class="n">e</span><span class="o">*</span><span class="n">Pa</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)),</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">delta_bic_sum</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">sigma</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">((</span><span class="n">cosw</span> <span class="o">+</span> <span class="n">epochs</span><span class="o">*</span><span class="n">delta_P_prime</span> <span class="o">+</span> <span class="n">delta_T0_prime</span><span class="p">),</span> <span class="mi">2</span><span class="p">))</span>
        <span class="n">analytical_delta_bic</span> <span class="o">=</span> <span class="n">amplitude</span> <span class="o">*</span> <span class="n">delta_bic_sum</span> <span class="o">-</span> <span class="mf">3.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">epochs</span><span class="p">))</span> <span class="o">+</span> <span class="mf">3.0</span>
        <span class="k">return</span> <span class="n">analytical_delta_bic</span>
    
    <span class="k">def</span><span class="w"> </span><span class="nf">_subtract_linear_parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_mid_times</span><span class="p">,</span> <span class="n">T0</span><span class="p">,</span> <span class="n">P</span><span class="p">,</span> <span class="n">E</span><span class="p">,</span> <span class="n">tra_or_occ</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Subtracts the linear terms to show smaller changes in non-linear parameters.</span>

<span class="sd">        Uses the equations:</span>
<span class="sd">         - (model midtime - T0 - PE) for transit observations</span>
<span class="sd">         - (model midtime - T0 - (½P) - PE) for occultation observations</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">            model_mid_times : numpy.ndarray[float]</span>
<span class="sd">                Mid-times calculated from a model. This data can be accessed through the &#39;model_data&#39;</span>
<span class="sd">                key from a returned model data dictionary. </span>
<span class="sd">            T0: float</span>
<span class="sd">                The best-fit conjunction time from an model fit.</span>
<span class="sd">            P: float</span>
<span class="sd">                The best-fit orbital period from an model fit.</span>
<span class="sd">            E: numpy.ndarray[int]</span>
<span class="sd">                The epochs pulled from the TimingData object.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">            A numpy array of newly calculated values for plotting.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">tra_mask</span> <span class="o">=</span> <span class="n">tra_or_occ</span> <span class="o">==</span> <span class="s2">&quot;tra&quot;</span>
        <span class="n">occ_mask</span> <span class="o">=</span> <span class="n">tra_or_occ</span> <span class="o">==</span> <span class="s2">&quot;occ&quot;</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">E</span><span class="p">))</span>
        <span class="n">result</span><span class="p">[</span><span class="n">tra_mask</span><span class="p">]</span> <span class="o">=</span> <span class="n">model_mid_times</span><span class="p">[</span><span class="n">tra_mask</span><span class="p">]</span> <span class="o">-</span> <span class="n">T0</span> <span class="o">-</span> <span class="p">(</span><span class="n">P</span><span class="o">*</span><span class="n">E</span><span class="p">[</span><span class="n">tra_mask</span><span class="p">])</span>
        <span class="n">result</span><span class="p">[</span><span class="n">occ_mask</span><span class="p">]</span> <span class="o">=</span> <span class="n">model_mid_times</span><span class="p">[</span><span class="n">occ_mask</span><span class="p">]</span> <span class="o">-</span> <span class="n">T0</span> <span class="o">-</span> <span class="p">(</span><span class="mf">0.5</span><span class="o">*</span><span class="n">P</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="n">P</span><span class="o">*</span><span class="n">E</span><span class="p">[</span><span class="n">occ_mask</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">result</span>
    
<div class="viewcode-block" id="Ephemeris.fit_model">
<a class="viewcode-back" href="../../../susie.html#src.susie.ephemeris.Ephemeris.fit_model">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">fit_model</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_type</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Fits the timing data to a specified model using an LMFIT `Model.fit()` method.</span>

<span class="sd">            This function selects and fits one of three supported orbital models—linear, quadratic, or precession—</span>
<span class="sd">            to mid-time exoplanet data using non-linear least squares optimization.</span>

<span class="sd">            Parameters</span>
<span class="sd">            ----------</span>
<span class="sd">            model_type : str</span>
<span class="sd">                The type of model to fit. Must be one of:</span>
<span class="sd">                </span>
<span class="sd">                - `&#39;linear&#39;`: Constant-period orbital model.</span>
<span class="sd">                - `&#39;quadratic&#39;`: Linear model with a period change (e.g., tidal decay).</span>
<span class="sd">                - `&#39;precession&#39;`: Model including apsidal precession.</span>

<span class="sd">            Keyword Arguments</span>
<span class="sd">            -----------------</span>
<span class="sd">            init_params : dict, optional</span>
<span class="sd">                Dictionary of initial parameter guesses to seed the fit. Required keys depend on the model type:</span>

<span class="sd">                For `&#39;linear&#39;`:</span>
<span class="sd">                    - `&#39;period&#39;` (float): Estimated orbital period (in days).</span>
<span class="sd">                    - `&#39;conjunction_time&#39;` (float): Reference time of mid-transit or occultation.</span>

<span class="sd">                For `&#39;quadratic&#39;`:</span>
<span class="sd">                    - All `&#39;linear&#39;` parameters.</span>
<span class="sd">                    - `&#39;decay_rate&#39;` (float): Change in period per epoch (in days/epoch).</span>

<span class="sd">                For `&#39;precession&#39;`:</span>
<span class="sd">                    - All `&#39;linear&#39;` parameters.</span>
<span class="sd">                    - `&#39;eccentricity&#39;` (float): Orbital eccentricity (unitless).</span>
<span class="sd">                    - `&#39;pericenter&#39;` (float): Argument of pericenter (in radians).</span>
<span class="sd">                    - `&#39;precession_rate&#39;` (float): Rate of pericenter precession per epoch (in radians/epoch).</span>

<span class="sd">            Returns</span>
<span class="sd">            -------</span>
<span class="sd">            model_data : dict</span>
<span class="sd">                Dictionary of best-fit parameters from the model, including:</span>

<span class="sd">                Common to all models:</span>
<span class="sd">                    - `&#39;model_type&#39;`: Name of the model used (`&#39;linear&#39;`, `&#39;quadratic&#39;`, or `&#39;precession&#39;`).</span>
<span class="sd">                    - `&#39;model_data&#39;`: Array of predicted mid-times using best-fit parameters.</span>
<span class="sd">                    - `&#39;period&#39;`, `&#39;period_err&#39;`: Fitted orbital period and its uncertainty.</span>
<span class="sd">                    - `&#39;conjunction_time&#39;`, `&#39;conjunction_time_err&#39;`: Fitted time of conjunction and its uncertainty.</span>

<span class="sd">                Additional for `&#39;quadratic&#39;`:</span>
<span class="sd">                    - `&#39;period_change_by_epoch&#39;`, `&#39;period_change_by_epoch_err&#39;`: Rate of period change per epoch and its uncertainty.</span>

<span class="sd">                Additional for `&#39;precession&#39;`:</span>
<span class="sd">                    - `&#39;eccentricity&#39;`, `&#39;eccentricity_err&#39;`</span>
<span class="sd">                    - `&#39;pericenter&#39;`, `&#39;pericenter_err&#39;`</span>
<span class="sd">                    - `&#39;pericenter_change_by_epoch&#39;`, `&#39;pericenter_change_by_epoch_err&#39;`: Precession rate and its uncertainty.</span>
<span class="sd">            &quot;&quot;&quot;</span>

        <span class="n">model_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_model_parameters</span><span class="p">(</span><span class="n">model_type</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">model_data</span><span class="p">[</span><span class="s2">&quot;model_type&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">model_type</span>
        <span class="c1"># Once we get parameters back, we call _calc_blank_model </span>
        <span class="k">if</span> <span class="n">model_type</span> <span class="o">==</span> <span class="s2">&quot;linear&quot;</span><span class="p">:</span>
            <span class="c1"># Return dict with parameters and calculated mid-times</span>
            <span class="n">model_data</span><span class="p">[</span><span class="s2">&quot;model_data&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calc_linear_model</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">timing_data</span><span class="o">.</span><span class="n">epochs</span><span class="p">,</span> <span class="n">model_data</span><span class="p">[</span><span class="s2">&quot;conjunction_time&quot;</span><span class="p">],</span> <span class="n">model_data</span><span class="p">[</span><span class="s2">&quot;period&quot;</span><span class="p">])</span>
        <span class="k">elif</span> <span class="n">model_type</span> <span class="o">==</span> <span class="s2">&quot;quadratic&quot;</span><span class="p">:</span>
            <span class="n">model_data</span><span class="p">[</span><span class="s2">&quot;model_data&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calc_quadratic_model</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">timing_data</span><span class="o">.</span><span class="n">epochs</span><span class="p">,</span> <span class="n">model_data</span><span class="p">[</span><span class="s2">&quot;conjunction_time&quot;</span><span class="p">],</span> <span class="n">model_data</span><span class="p">[</span><span class="s2">&quot;period&quot;</span><span class="p">],</span> <span class="n">model_data</span><span class="p">[</span><span class="s2">&quot;period_change_by_epoch&quot;</span><span class="p">])</span>
        <span class="k">elif</span> <span class="n">model_type</span> <span class="o">==</span> <span class="s2">&quot;precession&quot;</span><span class="p">:</span>
            <span class="n">model_data</span><span class="p">[</span><span class="s2">&quot;model_data&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calc_precession_model</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">timing_data</span><span class="o">.</span><span class="n">epochs</span><span class="p">,</span> <span class="n">model_data</span><span class="p">[</span><span class="s2">&quot;conjunction_time&quot;</span><span class="p">],</span> <span class="n">model_data</span><span class="p">[</span><span class="s2">&quot;period&quot;</span><span class="p">],</span> <span class="n">model_data</span><span class="p">[</span><span class="s2">&quot;eccentricity&quot;</span><span class="p">],</span> <span class="n">model_data</span><span class="p">[</span><span class="s2">&quot;pericenter&quot;</span><span class="p">],</span> <span class="n">model_data</span><span class="p">[</span><span class="s2">&quot;pericenter_change_by_epoch&quot;</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">model_data</span></div>

    
<div class="viewcode-block" id="Ephemeris.get_model_uncertainties">
<a class="viewcode-back" href="../../../susie.html#src.susie.ephemeris.Ephemeris.get_model_uncertainties">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_model_uncertainties</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_data</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Calculates the mid-time uncertainties of specific model data when compared to the actual data. </span>

<span class="sd">        Calculate the uncertainties between the model data and actual data over epochs using the equations...</span>
<span class="sd">        </span>
<span class="sd">        For a linear model:</span>
<span class="sd">        </span>
<span class="sd">         - :math:`\\sigma(\\text{t pred, tra}) = \\sqrt{(\\sigma(T_0)^2 + \\sigma(P)^2 * E^2)}` for transit observations</span>

<span class="sd">         - :math:`\\sigma(\\text{t pred, tra}) = \\sqrt{(\\sigma(T_0)^2 + \\sigma(P)^2 * (\\frac{1}{2} + E)^2)}` for occultation observations</span>
<span class="sd">            </span>
<span class="sd">        For a quadratic model:</span>

<span class="sd">         - :math:`\\sigma(\\text{t pred, tra}) = \\sqrt{(\\sigma(T_0)^2 + (\\sigma(P)^2 * E^2) + (\\frac{1}{4} * \\sigma(\\frac{dP}{dE})^2 * E^4))}` for transit observations</span>

<span class="sd">         - :math:`\\sigma(\\text{t pred, tra}) = \\sqrt{(\\sigma(T_0)^2 + (\\sigma(P)^2 * (\\frac{1}{2} + E^2)) + (\\frac{1}{4} * \\sigma(\\frac{dP}{dE})^2 * E^4))}` for occultation observations</span>
<span class="sd">        </span>
<span class="sd">        where :math:`\\sigma(T_0) =` conjunction time error, :math:`E=` epoch, :math:`\\sigma(P)=` period error, and :math:`\\sigma(\\frac{dP}{dE})=` period change with respect to epoch error.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        model_data: dict</span>
<span class="sd">            The model data dictionary recieved from the `fit_model` method.</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">            A list of mid-time uncertainties associated with the model passed in, calculated with the </span>
<span class="sd">            equation above and the TimingData epochs.</span>
<span class="sd">        </span>
<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">            KeyError</span>
<span class="sd">                If the model type in not in the model parameter dictionary.</span>
<span class="sd">            KeyError</span>
<span class="sd">                If the model parameter error values are not in the model parameter dictionary.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">linear_params</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;conjunction_time&quot;</span><span class="p">,</span> <span class="s2">&quot;conjunction_time_err&quot;</span><span class="p">,</span> <span class="s2">&quot;period&quot;</span><span class="p">,</span> <span class="s2">&quot;period_err&quot;</span><span class="p">]</span>
        <span class="n">quad_params</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;conjunction_time&#39;</span><span class="p">,</span> <span class="s1">&#39;conjunction_time_err&#39;</span><span class="p">,</span> <span class="s1">&#39;period&#39;</span><span class="p">,</span> <span class="s1">&#39;period_err&#39;</span><span class="p">,</span> <span class="s1">&#39;period_change_by_epoch&#39;</span><span class="p">,</span> <span class="s1">&#39;period_change_by_epoch_err&#39;</span><span class="p">]</span>
        <span class="n">prec_params</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;conjunction_time&#39;</span><span class="p">,</span> <span class="s1">&#39;conjunction_time_err&#39;</span><span class="p">,</span> <span class="s1">&#39;period&#39;</span><span class="p">,</span> <span class="s1">&#39;period_err&#39;</span><span class="p">,</span> <span class="s1">&#39;pericenter_change_by_epoch&#39;</span><span class="p">,</span> <span class="s1">&#39;pericenter_change_by_epoch_err&#39;</span><span class="p">,</span> <span class="s1">&#39;eccentricity&#39;</span><span class="p">,</span> <span class="s1">&#39;eccentricity_err&#39;</span><span class="p">,</span> <span class="s1">&#39;pericenter&#39;</span><span class="p">,</span> <span class="s1">&#39;pericenter_err&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="s1">&#39;model_type&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">model_data</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="s2">&quot;Cannot find model type in model data. Please run the fit_model method to return model fit parameters.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">model_data</span><span class="p">[</span><span class="s1">&#39;model_type&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;linear&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">any</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">linear_params</span><span class="p">),</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">model_data</span><span class="o">.</span><span class="n">keys</span><span class="p">()))):</span>
                <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="s2">&quot;Cannot find conjunction time and period and/or their respective errors in model data. Please run the fit_model method with &#39;linear&#39; model_type to return model fit parameters.&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calc_linear_model_uncertainties</span><span class="p">(</span><span class="n">model_data</span><span class="p">[</span><span class="s1">&#39;conjunction_time_err&#39;</span><span class="p">],</span> <span class="n">model_data</span><span class="p">[</span><span class="s1">&#39;period_err&#39;</span><span class="p">])</span>
        <span class="k">elif</span> <span class="n">model_data</span><span class="p">[</span><span class="s1">&#39;model_type&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;quadratic&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">any</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">quad_params</span><span class="p">),</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">model_data</span><span class="o">.</span><span class="n">keys</span><span class="p">()))):</span>
                <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="s2">&quot;Cannot find conjunction time, period, and/or period change by epoch and/or their respective errors in model data. Please run the fit_model method with &#39;quadratic&#39; model_type to return model fit parameters.&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calc_quadratic_model_uncertainties</span><span class="p">(</span><span class="n">model_data</span><span class="p">[</span><span class="s1">&#39;conjunction_time_err&#39;</span><span class="p">],</span> <span class="n">model_data</span><span class="p">[</span><span class="s1">&#39;period_err&#39;</span><span class="p">],</span> <span class="n">model_data</span><span class="p">[</span><span class="s1">&#39;period_change_by_epoch_err&#39;</span><span class="p">])</span>
        <span class="k">elif</span> <span class="n">model_data</span><span class="p">[</span><span class="s1">&#39;model_type&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;precession&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">any</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">prec_params</span><span class="p">),</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">model_data</span><span class="o">.</span><span class="n">keys</span><span class="p">()))):</span>
                <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="s2">&quot;Cannot find conjunction time, period, eccentricity, pericenter, and/or pericenter change by epoch and/or their respective errors in model data. Please run the fit_model method with &#39;precession&#39; model_type to return model fit parameters.&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calc_precession_model_uncertainties</span><span class="p">(</span><span class="n">model_data</span><span class="p">)</span></div>


<div class="viewcode-block" id="Ephemeris.calc_bic">
<a class="viewcode-back" href="../../../susie.html#src.susie.ephemeris.Ephemeris.calc_bic">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">calc_bic</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_data</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Calculates the BIC value for a given model. </span>
<span class="sd">        </span>
<span class="sd">        The BIC value is a modified :math:`\\chi^2` value that penalizes for additional parameters. </span>
<span class="sd">        Uses the equation :math:`BIC = \\chi^2 + (k * log(N))` where :math:`\\chi^2=\\sum{\\frac{(\\text{</span>
<span class="sd">        observed midtimes - model midtimes})}{\\text{(observed midtime uncertainties})^2}},`</span>
<span class="sd">        k=number of fit parameters (2 for linear ephemerides, 3 for quadratic ephemerides, 5 for precession </span>
<span class="sd">        ephemerides), and N=total number of data points.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">            model_data: dict</span>
<span class="sd">                The model data dictionary recieved from the `fit_model` method.</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        ------- </span>
<span class="sd">            A float value representing the BIC value for this model.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Step 1: Get value of k based on model_type (linear=2, quad=3, custom=?)</span>
        <span class="n">num_params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_k_value</span><span class="p">(</span><span class="n">model_data</span><span class="p">[</span><span class="s1">&#39;model_type&#39;</span><span class="p">])</span>
        <span class="c1"># Step 2: Calculate chi-squared</span>
        <span class="n">chi_squared</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calc_chi_squared</span><span class="p">(</span><span class="n">model_data</span><span class="p">[</span><span class="s1">&#39;model_data&#39;</span><span class="p">])</span>
        <span class="c1"># Step 3: Calculate BIC</span>
        <span class="k">return</span> <span class="n">chi_squared</span> <span class="o">+</span> <span class="p">(</span><span class="n">num_params</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">model_data</span><span class="p">[</span><span class="s1">&#39;model_data&#39;</span><span class="p">])))</span></div>


<div class="viewcode-block" id="Ephemeris.calc_delta_bic">
<a class="viewcode-back" href="../../../susie.html#src.susie.ephemeris.Ephemeris.calc_delta_bic">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">calc_delta_bic</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model1</span><span class="o">=</span><span class="s2">&quot;linear&quot;</span><span class="p">,</span> <span class="n">model2</span><span class="o">=</span><span class="s2">&quot;quadratic&quot;</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Calculates the :math:`\\Delta BIC` value between linear and quadratic ephemerides using the given timing data. </span>
<span class="sd">        </span>
<span class="sd">        model1 BIC value - model2 BIC value, default of linear - quadratic BIC values.</span>
<span class="sd">        </span>
<span class="sd">        The BIC value is a modified :math:`\\chi^2` value that penalizes for additional parameters. The</span>
<span class="sd">        :math:`\\Delta BIC` value is the difference between the linear BIC value and the quadratic BIC value.</span>
<span class="sd">        Ephemerides that have smaller values of BIC are favored. Therefore, if the :math:`\\Delta BIC` value for your</span>
<span class="sd">        data is a large positive number (large linear BIC - small quadratic BIC), a quadratic model is favored and</span>
<span class="sd">        your data indicates possible orbital decay in your extrasolar system. If the :math:`\\Delta BIC` value for</span>
<span class="sd">        your data is a small number or negative (small linear BIC - large quadratic BIC), then a linear model is</span>
<span class="sd">        favored and your data may not indicate orbital decay. </span>

<span class="sd">        This function will run all model instantiation and BIC calculations for you using the TimingData</span>
<span class="sd">        information you entered.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">            model1: str</span>
<span class="sd">                This is the name of the first model.</span>
<span class="sd">            model2: str</span>
<span class="sd">                This is the name of second model, whose BIC value will be subtracted from the first.</span>

<span class="sd">        Returns</span>
<span class="sd">        ------- </span>
<span class="sd">            delta_bic : float</span>
<span class="sd">                Represents the :math:`\\Delta BIC` value for this timing data. </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">valid_ephemerides</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;linear&quot;</span><span class="p">,</span> <span class="s2">&quot;quadratic&quot;</span><span class="p">,</span> <span class="s2">&quot;precession&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">model1</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">valid_ephemerides</span> <span class="ow">or</span> <span class="n">model2</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">valid_ephemerides</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Only linear, quadratic, and precession ephemerides are accepted at this time.&quot;</span><span class="p">)</span>
        <span class="n">model1_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fit_model</span><span class="p">(</span><span class="n">model1</span><span class="p">)</span>
        <span class="n">model2_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fit_model</span><span class="p">(</span><span class="n">model2</span><span class="p">)</span>
        <span class="n">model1_bic</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calc_bic</span><span class="p">(</span><span class="n">model1_data</span><span class="p">)</span>
        <span class="n">model2_bic</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calc_bic</span><span class="p">(</span><span class="n">model2_data</span><span class="p">)</span>
        <span class="n">delta_bic</span> <span class="o">=</span> <span class="n">model1_bic</span> <span class="o">-</span> <span class="n">model2_bic</span>
        <span class="k">return</span> <span class="n">delta_bic</span></div>

    
    <span class="k">def</span><span class="w"> </span><span class="nf">_query_nasa_exoplanet_archive</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj_name</span><span class="p">,</span> <span class="n">ra</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">dec</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">select_query</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Queries the NASA Exoplanet Archive for system parameters.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">            obj_name: str</span>
<span class="sd">                The name of the exoplanet object.</span>
<span class="sd">            ra: float (Optional)</span>
<span class="sd">                The right ascension of the object to observe in the sky (most likely a planet or star).</span>
<span class="sd">            dec: float (Optional)</span>
<span class="sd">                The declination of the object to observe in the sky (most likely a planet or star).</span>
<span class="sd">            select_query: str</span>
<span class="sd">                The select query string. For examples please see the Astroquery documentation.</span>
<span class="sd">            </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">            obj_data: An astropy Table object</span>
<span class="sd">                The table of data returned from the NASA Exoplanet Archive query. For more information on </span>
<span class="sd">                how to work with these tables, please see the Astroquery NASA Exoplanet Archive documentation.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Get object data</span>
        <span class="n">obj_data</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">obj_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">select_query</span><span class="p">:</span>
                <span class="n">obj_data</span> <span class="o">=</span> <span class="n">NasaExoplanetArchive</span><span class="o">.</span><span class="n">query_object</span><span class="p">(</span><span class="n">obj_name</span><span class="p">,</span> <span class="n">select</span><span class="o">=</span><span class="n">select_query</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">obj_data</span> <span class="o">=</span> <span class="n">NasaExoplanetArchive</span><span class="o">.</span><span class="n">query_object</span><span class="p">(</span><span class="n">obj_name</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">ra</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">dec</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">select_query</span><span class="p">:</span>
                <span class="n">obj_data</span> <span class="o">=</span> <span class="n">NasaExoplanetArchive</span><span class="o">.</span><span class="n">query_region</span><span class="p">(</span>
                    <span class="n">table</span><span class="o">=</span><span class="s2">&quot;pscomppars&quot;</span><span class="p">,</span> <span class="n">coordinates</span><span class="o">=</span><span class="n">SkyCoord</span><span class="p">(</span><span class="n">ra</span><span class="o">=</span><span class="n">ra</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">deg</span><span class="p">,</span> <span class="n">dec</span><span class="o">=</span><span class="n">dec</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">deg</span><span class="p">),</span>
                    <span class="n">radius</span><span class="o">=</span><span class="mf">1.0</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">deg</span><span class="p">,</span> <span class="n">select</span><span class="o">=</span><span class="n">select_query</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">obj_data</span> <span class="o">=</span> <span class="n">NasaExoplanetArchive</span><span class="o">.</span><span class="n">query_region</span><span class="p">(</span>
                    <span class="n">table</span><span class="o">=</span><span class="s2">&quot;pscomppars&quot;</span><span class="p">,</span> <span class="n">coordinates</span><span class="o">=</span><span class="n">SkyCoord</span><span class="p">(</span><span class="n">ra</span><span class="o">=</span><span class="n">ra</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">deg</span><span class="p">,</span> <span class="n">dec</span><span class="o">=</span><span class="n">dec</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">deg</span><span class="p">),</span> <span class="n">radius</span><span class="o">=</span><span class="mf">1.0</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">deg</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Object must be specified with either (1) a recognized object name in the NASA Exoplanet Archive or (2) right ascension and declination in degrees as accepted by astropy.coordinates.ra and astropy.coordinates.dec.&quot;</span><span class="p">)</span>
        <span class="c1"># Check that the returned data is not empty</span>
        <span class="k">if</span> <span class="n">obj_data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">obj_data</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">obj_data</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">obj_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Nothing found for </span><span class="si">{</span><span class="n">obj_name</span><span class="si">}</span><span class="s2"> in the NASA Exoplanet Archive. Please check that your object is accepted and contains data on the archive&#39;s homepage.&quot;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">ra</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">dec</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Nothing found for the coordinates </span><span class="si">{</span><span class="n">ra</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">dec</span><span class="si">}</span><span class="s2"> in the NASA Exoplanet Archive. Please check that your values are correct and are in degrees as accepted by astropy.coordinates.ra and astropy.coordinates.dec.&quot;</span><span class="p">)</span>
    
    <span class="k">def</span><span class="w"> </span><span class="nf">_get_eclipse_duration</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj_name</span><span class="p">,</span> <span class="n">ra</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">dec</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Queries the NASA Exoplanet Archive for system parameters used in eclipse duration calculation.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">            obj_name: str</span>
<span class="sd">                The name of the exoplanet object.</span>
<span class="sd">            ra: float (Optional)</span>
<span class="sd">                The right ascension of the object to observe in the sky (most likely a planet or star).</span>
<span class="sd">            dec: float (Optional)</span>
<span class="sd">                The declination of the object to observe in the sky (most likely a planet or star).</span>
<span class="sd">            </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">nea_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_query_nasa_exoplanet_archive</span><span class="p">(</span><span class="n">obj_name</span><span class="p">,</span> <span class="n">ra</span><span class="p">,</span> <span class="n">dec</span><span class="p">,</span> <span class="n">select_query</span><span class="o">=</span><span class="s2">&quot;pl_trandur&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">nea_data</span><span class="p">[</span><span class="s2">&quot;pl_trandur&quot;</span><span class="p">]:</span>
            <span class="k">if</span> <span class="ow">not</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">val</span><span class="p">)):</span>
                <span class="n">val_to_store</span> <span class="o">=</span> <span class="n">val</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">Quantity</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="s1">&#39;mask&#39;</span><span class="p">):</span>
                    <span class="c1"># If the value is masked, just store value</span>
                    <span class="n">val_to_store</span> <span class="o">=</span> <span class="n">val</span><span class="o">.</span><span class="n">value</span>
                <span class="k">return</span> <span class="n">val_to_store</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">hour</span>
            
    <span class="k">def</span><span class="w"> </span><span class="nf">_validate_obs_start_time</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">time_str</span><span class="p">):</span>
        <span class="n">value_err_msg</span> <span class="o">=</span> <span class="s2">&quot;obs_start_time must be in the format YYYY-MM-DD. For example, 2024-10-29.&quot;</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">time_str</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">10</span><span class="p">:</span>
            <span class="k">return</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">value_err_msg</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">time_str</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">isdigit</span><span class="p">()</span> <span class="ow">and</span> <span class="n">time_str</span><span class="p">[</span><span class="mi">5</span><span class="p">:</span><span class="mi">7</span><span class="p">]</span><span class="o">.</span><span class="n">isdigit</span><span class="p">()</span> <span class="ow">and</span> <span class="n">time_str</span><span class="p">[</span><span class="mi">8</span><span class="p">:</span><span class="mi">10</span><span class="p">]</span><span class="o">.</span><span class="n">isdigit</span><span class="p">()):</span>
            <span class="k">return</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">value_err_msg</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">time_str</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;-&#39;</span> <span class="ow">and</span> <span class="n">time_str</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;-&#39;</span><span class="p">):</span>
            <span class="k">return</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">value_err_msg</span><span class="p">)</span>
        
    <span class="k">def</span><span class="w"> </span><span class="nf">_validate_observing_schedule_params</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">observer</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">obs_start_time</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_validate_obs_start_time</span><span class="p">(</span><span class="n">obs_start_time</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">observer</span><span class="p">,</span> <span class="n">Observer</span><span class="p">):</span>
            <span class="k">return</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;observer parameter must be an Astroplan Observer object. See the Astroplan documentation for more information: https://astroplan.readthedocs.io/en/latest/api/astroplan.Observer.html&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">FixedTarget</span><span class="p">):</span>
            <span class="k">return</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;target parameter must be an Astroplan FixedTarget object. See the Astroplan documentation for more information: https://astroplan.readthedocs.io/en/latest/api/astroplan.Target.html&quot;</span><span class="p">)</span>
        
    <span class="k">def</span><span class="w"> </span><span class="nf">_create_observing_schedule_dataframe</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">transits</span><span class="p">,</span> <span class="n">occultations</span><span class="p">):</span>
        <span class="n">transit_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">transits</span><span class="p">)</span>
        <span class="n">occultation_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">occultations</span><span class="p">)</span>
        <span class="n">transit_df</span> <span class="o">=</span> <span class="n">transit_df</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">dt</span><span class="p">:</span> <span class="n">dt</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2"> %H:%M:%S %z&quot;</span><span class="p">))</span>
        <span class="n">transit_df</span> <span class="o">=</span> <span class="n">transit_df</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="s2">&quot;ingress&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span> <span class="s2">&quot;egress&quot;</span><span class="p">})</span>
        <span class="n">occultation_df</span> <span class="o">=</span> <span class="n">occultation_df</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">dt</span><span class="p">:</span> <span class="n">dt</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2"> %H:%M:%S %z&quot;</span><span class="p">))</span>
        <span class="n">occultation_df</span> <span class="o">=</span> <span class="n">occultation_df</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="s2">&quot;ingress&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span> <span class="s2">&quot;egress&quot;</span><span class="p">})</span>
        <span class="n">transit_df</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;transit&quot;</span>
        <span class="n">occultation_df</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;occultation&quot;</span>
        <span class="n">final_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">transit_df</span><span class="p">,</span> <span class="n">occultation_df</span><span class="p">],</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">sorted_df</span> <span class="o">=</span> <span class="n">final_df</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s2">&quot;ingress&quot;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">sorted_df</span>

<div class="viewcode-block" id="Ephemeris.create_observer_obj">
<a class="viewcode-back" href="../../../susie.html#src.susie.ephemeris.Ephemeris.create_observer_obj">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">create_observer_obj</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">timezone</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">longitude</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">latitude</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">elevation</span><span class="o">=</span><span class="mf">0.0</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Creates the Astroplan Observer object.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">            timezone: str</span>
<span class="sd">                The local timezone. If a string, it will be passed through pytz.timezone() to produce the timezone object.</span>
<span class="sd">            name: str</span>
<span class="sd">                The name of the observer&#39;s location. This can either be a registered Astropy site</span>
<span class="sd">                name (get the latest site names with `EarthLocation.get_site_names()`), which will</span>
<span class="sd">                return the latitude, longitude, and elevation of the site OR it can be a custom name</span>
<span class="sd">                to keep track of your Observer object.</span>
<span class="sd">            latitude: float (Optional)</span>
<span class="sd">                The latitude of the observer&#39;s location on Earth.</span>
<span class="sd">            longitude: float (Optional)</span>
<span class="sd">                The longitude of the observer&#39;s location on Earth.</span>
<span class="sd">            elevation: float (Optional)</span>
<span class="sd">                The elevation of the observer&#39;s location on Earth.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">            The Astroplan Observer object.</span>
<span class="sd">        </span>
<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">            ValueError if neither coords nor name are given.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">observer</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">longitude</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">latitude</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># There are valid vals for lon and lat</span>
            <span class="n">observer</span> <span class="o">=</span> <span class="n">Observer</span><span class="p">(</span><span class="n">longitude</span><span class="o">=</span><span class="n">longitude</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">deg</span><span class="p">,</span> <span class="n">latitude</span><span class="o">=</span><span class="n">latitude</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">deg</span><span class="p">,</span> <span class="n">elevation</span><span class="o">=</span><span class="n">elevation</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">m</span><span class="p">,</span> <span class="n">timezone</span><span class="o">=</span><span class="n">timezone</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">observer</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="k">elif</span> <span class="n">name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># No vals for lon and lat, use site name</span>
            <span class="n">observer</span> <span class="o">=</span> <span class="n">Observer</span><span class="o">.</span><span class="n">at_site</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">timezone</span><span class="o">=</span><span class="n">timezone</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># No coords or site name given, raise error</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Observatory location must be specified with either (1) a site name specified by astropy.coordinates.EarthLocation.get_site_names() or (2) latitude and longitude in degrees as accepted by astropy.coordinates.Latitude and astropy.coordinates.Latitude.&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">observer</span></div>

            
<div class="viewcode-block" id="Ephemeris.create_target_obj">
<a class="viewcode-back" href="../../../susie.html#src.susie.ephemeris.Ephemeris.create_target_obj">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">create_target_obj</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">ra</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">dec</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Creates the Astroplan FixedTarget object.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">            coords: tuple(float, float) (Optional)</span>
<span class="sd">                The right ascension and declination of the object in the sky (most likely the planet&#39;s host star).</span>
<span class="sd">            name: str</span>
<span class="sd">                The name of the exoplanet host star. This can either be a registered object name, which will query</span>
<span class="sd">                a CDS name resolver (see the `Astroplan Target Documentation &lt;https://astroplan.readthedocs.io/en/latest/api/astroplan.Target.html&gt;`_ </span>
<span class="sd">                for more information on this) OR it can be a custom name to keep track of your FixedTarget object.</span>
<span class="sd">            ra: float (Optional)</span>
<span class="sd">                The right ascension of the object to observe in the sky (most likely a planet or star).</span>
<span class="sd">            dec: float (Optional)</span>
<span class="sd">                The declination of the object to observe in the sky (most likely a planet or star).</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">            The Astroplan FixedTarget object.</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">            ValueError if neither coords nor name are given.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">target</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">ra</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">dec</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># There are valid vals for ra and dec</span>
            <span class="n">skycoord</span> <span class="o">=</span> <span class="n">SkyCoord</span><span class="p">(</span><span class="n">ra</span><span class="o">=</span><span class="n">ra</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">deg</span><span class="p">,</span> <span class="n">dec</span><span class="o">=</span><span class="n">dec</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">deg</span><span class="p">)</span>
            <span class="n">target</span> <span class="o">=</span> <span class="n">FixedTarget</span><span class="p">(</span><span class="n">coord</span><span class="o">=</span><span class="n">skycoord</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">target</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="k">elif</span> <span class="n">name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># No vals for ra &amp; dec, query by object name</span>
            <span class="n">target</span> <span class="o">=</span> <span class="n">FixedTarget</span><span class="o">.</span><span class="n">from_name</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Neither ra &amp; dec or name given, raise error</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Object location must be specified with either (1) an valid object name or (2) right ascension and declination in degrees as accepted by astropy.coordinates.ra and astropy.coordinates.dec.&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">target</span></div>

    
<div class="viewcode-block" id="Ephemeris.get_observing_schedule">
<a class="viewcode-back" href="../../../susie.html#src.susie.ephemeris.Ephemeris.get_observing_schedule">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_observing_schedule</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_data</span><span class="p">,</span> <span class="n">timezone</span><span class="p">,</span> <span class="n">observer</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">n_transits</span><span class="p">,</span> <span class="n">n_occultations</span><span class="p">,</span> <span class="n">obs_start_time</span><span class="p">,</span> <span class="n">exoplanet_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">eclipse_duration</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">csv_filename</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns a list of observable future transits for the target object</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">            model_data: dict</span>
<span class="sd">                The model data dictionary recieved from the `fit_model` method.</span>
<span class="sd">            timezone: str</span>
<span class="sd">                The local timezone. If a string, it will be passed through `pytz.timezone()` to produce the timezone object.</span>
<span class="sd">            observer: Astroplan Observer obj</span>
<span class="sd">                An Astroplan Observer object holding information on the observer&#39;s Earth location. Can be created </span>
<span class="sd">                through the `create_observer_obj` method, or can be manually created. See the `Astroplan Observer Documentation &lt;https://astroplan.readthedocs.io/en/latest/api/astroplan.Observer.html&gt;`_</span>
<span class="sd">                for more information.</span>
<span class="sd">            target: Astroplan FixedTarget obj</span>
<span class="sd">                An Astroplan FixedTarget object holding information on the object observed. Can be created through the </span>
<span class="sd">                `create_target_obj` method, or can be manually created. See the `Astroplan Target Documentation &lt;https://astroplan.readthedocs.io/en/latest/api/astroplan.Target.html&gt;`_</span>
<span class="sd">                for more information.</span>
<span class="sd">            n_transits: int</span>
<span class="sd">                The number of transits to initially request. This will be filtered down by what is observable from</span>
<span class="sd">                the Earth location.</span>
<span class="sd">            n_occultations: int</span>
<span class="sd">                The number of occultations to initially request. This will be filtered down by what is observable from</span>
<span class="sd">                the Earth location.</span>
<span class="sd">            obs_start_time: str</span>
<span class="sd">                Time at which you would like to start looking for eclipse events. In the format YYYY-MM-DD. For</span>
<span class="sd">                example, if you would like to find eclipses happening after October 1st, 2024, the format would</span>
<span class="sd">                be &quot;2024-10-01&quot;.</span>
<span class="sd">            exoplanet_name: str (Optional)</span>
<span class="sd">                The name of the exoplanet. Used to query the NASA Exoplanet Archive for transit duration. If </span>
<span class="sd">                no name is provided, the right ascension and declination from the FixedTarget object will be used. </span>
<span class="sd">                Can also provide the transit duration manually instead using the `eclipse_duration` parameter.</span>
<span class="sd">            eclipse_duration: float (Optional)</span>
<span class="sd">                The full duration of the exoplanet transit from ingress to egress. If not given, will calculate</span>
<span class="sd">                using either provided system parameters or parameters pulled from the NASA Exoplanet Archive.</span>
<span class="sd">            csv_filename: str (Optional)</span>
<span class="sd">                If given, will save the returned schedule dataframe as a CSV file.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Validate some things before continuing</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_validate_observing_schedule_params</span><span class="p">(</span><span class="n">observer</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">obs_start_time</span><span class="p">)</span>
        <span class="c1"># Grab the most recent mid transit time</span>
        <span class="n">primary_eclipse_time</span> <span class="o">=</span> <span class="n">Time</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">timing_data</span><span class="o">.</span><span class="n">mid_times</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;jd&#39;</span><span class="p">)</span>
        <span class="c1"># Pull orbital period from the model data</span>
        <span class="n">orbital_period</span> <span class="o">=</span> <span class="n">model_data</span><span class="p">[</span><span class="s1">&#39;period&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">day</span>
        <span class="k">if</span> <span class="n">eclipse_duration</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># If not given, query the archive for it</span>
            <span class="n">eclipse_duration</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_eclipse_duration</span><span class="p">(</span><span class="n">exoplanet_name</span><span class="p">,</span> <span class="n">target</span><span class="o">.</span><span class="n">ra</span><span class="p">,</span> <span class="n">target</span><span class="o">.</span><span class="n">dec</span><span class="p">)</span>
        <span class="c1"># Create EclipsingSystem object</span>
        <span class="n">eclipsing_system</span> <span class="o">=</span> <span class="n">EclipsingSystem</span><span class="p">(</span><span class="n">primary_eclipse_time</span><span class="o">=</span><span class="n">primary_eclipse_time</span><span class="p">,</span>
                                <span class="n">orbital_period</span><span class="o">=</span><span class="n">orbital_period</span><span class="p">,</span> <span class="n">duration</span><span class="o">=</span><span class="n">eclipse_duration</span><span class="p">)</span>
        <span class="c1"># Set the observational parameters</span>
        <span class="c1"># Time to start looking</span>
        <span class="n">obs_time</span> <span class="o">=</span> <span class="n">Time</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">obs_start_time</span><span class="si">}</span><span class="s2"> 00:00&quot;</span><span class="p">)</span>
        <span class="c1"># Grab the number of transits and occultations asked for</span>
        <span class="n">ing_egr_transits</span> <span class="o">=</span> <span class="n">eclipsing_system</span><span class="o">.</span><span class="n">next_primary_ingress_egress_time</span><span class="p">(</span><span class="n">obs_time</span><span class="p">,</span> <span class="n">n_eclipses</span><span class="o">=</span><span class="n">n_transits</span><span class="p">)</span>
        <span class="n">ing_egr_occultations</span> <span class="o">=</span> <span class="n">eclipsing_system</span><span class="o">.</span><span class="n">next_secondary_ingress_egress_time</span><span class="p">(</span><span class="n">obs_time</span><span class="p">,</span> <span class="n">n_eclipses</span><span class="o">=</span><span class="n">n_occultations</span><span class="p">)</span>
        <span class="c1"># We need to check if the events are observable</span>
        <span class="n">constraints</span> <span class="o">=</span> <span class="p">[</span><span class="n">AtNightConstraint</span><span class="o">.</span><span class="n">twilight_civil</span><span class="p">(),</span> <span class="n">AltitudeConstraint</span><span class="p">(</span><span class="nb">min</span><span class="o">=</span><span class="mi">30</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">deg</span><span class="p">)]</span>
        <span class="n">transits_bool</span> <span class="o">=</span> <span class="n">is_event_observable</span><span class="p">(</span><span class="n">constraints</span><span class="p">,</span> <span class="n">observer</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">times_ingress_egress</span><span class="o">=</span><span class="n">ing_egr_transits</span><span class="p">)</span>
        <span class="n">occultations_bool</span> <span class="o">=</span> <span class="n">is_event_observable</span><span class="p">(</span><span class="n">constraints</span><span class="p">,</span> <span class="n">observer</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">times_ingress_egress</span><span class="o">=</span><span class="n">ing_egr_occultations</span><span class="p">)</span>
        <span class="n">observable_transits</span> <span class="o">=</span> <span class="n">ing_egr_transits</span><span class="p">[</span><span class="n">transits_bool</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
        <span class="n">observable_occultations</span> <span class="o">=</span> <span class="n">ing_egr_occultations</span><span class="p">[</span><span class="n">occultations_bool</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
        <span class="c1"># Change to their given timezone</span>
        <span class="n">tz</span> <span class="o">=</span> <span class="n">pytz</span><span class="o">.</span><span class="n">timezone</span><span class="p">(</span><span class="n">timezone</span><span class="p">)</span>
        <span class="n">converted_transits</span> <span class="o">=</span> <span class="n">observable_transits</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">timezone</span><span class="o">=</span><span class="n">tz</span><span class="p">)</span>
        <span class="n">converted_occultations</span> <span class="o">=</span> <span class="n">observable_occultations</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">timezone</span><span class="o">=</span><span class="n">tz</span><span class="p">)</span>
        <span class="c1"># Create dataframe from this</span>
        <span class="n">schedule_df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_observing_schedule_dataframe</span><span class="p">(</span><span class="n">converted_transits</span><span class="p">,</span> <span class="n">converted_occultations</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">csv_filename</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">schedule_df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">csv_filename</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">schedule_df</span></div>

    
<div class="viewcode-block" id="Ephemeris.plot_model">
<a class="viewcode-back" href="../../../susie.html#src.susie.ephemeris.Ephemeris.plot_model">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">plot_model</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_data</span><span class="p">,</span> <span class="n">subtract_lin_params</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">show_occultations</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">save_plot</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">save_filepath</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Plots a scatterplot of epochs vs. model calculated mid-times.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">            model_data: dict</span>
<span class="sd">                The model data dictionary recieved from the `fit_model` method.</span>
<span class="sd">            save_plot: bool </span>
<span class="sd">                If True, will save the plot as a figure.</span>
<span class="sd">            save_filepath: Optional(str)</span>
<span class="sd">                The path used to save the plot if `save_plot` is True.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">DAYS_TO_SECONDS</span> <span class="o">=</span> <span class="mi">1</span><span class="o">*</span><span class="mi">24</span><span class="o">*</span><span class="mi">60</span><span class="o">*</span><span class="mi">60</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="o">*</span><span class="p">(</span><span class="mi">16</span><span class="o">/</span><span class="mi">9</span><span class="p">),</span> <span class="mi">6</span><span class="p">))</span>
        <span class="n">y_data</span> <span class="o">=</span> <span class="n">model_data</span><span class="p">[</span><span class="s1">&#39;model_data&#39;</span><span class="p">]</span>
        <span class="n">y_times</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">timing_data</span><span class="o">.</span><span class="n">mid_times</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">y_times_errs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">timing_data</span><span class="o">.</span><span class="n">mid_time_uncertainties</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="c1"># Subtract the linear parameters if arg is True</span>
        <span class="k">if</span> <span class="n">subtract_lin_params</span><span class="p">:</span>
            <span class="n">y_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_subtract_linear_parameters</span><span class="p">(</span><span class="n">y_data</span><span class="p">,</span> <span class="n">model_data</span><span class="p">[</span><span class="s1">&#39;conjunction_time&#39;</span><span class="p">],</span> <span class="n">model_data</span><span class="p">[</span><span class="s1">&#39;period&#39;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">timing_data</span><span class="o">.</span><span class="n">epochs</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">timing_data</span><span class="o">.</span><span class="n">tra_or_occ</span><span class="p">)</span><span class="o">*</span><span class="n">DAYS_TO_SECONDS</span>
            <span class="n">y_times</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_subtract_linear_parameters</span><span class="p">(</span><span class="n">y_times</span><span class="p">,</span> <span class="n">model_data</span><span class="p">[</span><span class="s1">&#39;conjunction_time&#39;</span><span class="p">],</span> <span class="n">model_data</span><span class="p">[</span><span class="s1">&#39;period&#39;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">timing_data</span><span class="o">.</span><span class="n">epochs</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">timing_data</span><span class="o">.</span><span class="n">tra_or_occ</span><span class="p">)</span><span class="o">*</span><span class="n">DAYS_TO_SECONDS</span>
            <span class="n">y_times_errs</span><span class="o">*=</span><span class="n">DAYS_TO_SECONDS</span>
        <span class="c1"># Plot transits and occultations separately if arg is True</span>
        <span class="k">if</span> <span class="n">show_occultations</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">timing_data</span><span class="o">.</span><span class="n">epochs</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">tra_mask</span><span class="p">],</span> <span class="n">y_data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">tra_mask</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;#0033A0&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Transits&quot;</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">timing_data</span><span class="o">.</span><span class="n">epochs</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">occ_mask</span><span class="p">],</span> <span class="n">y_data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">occ_mask</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;#D64309&quot;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Occultations&quot;</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">timing_data</span><span class="o">.</span><span class="n">epochs</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">tra_mask</span><span class="p">],</span> <span class="n">y_times</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">tra_mask</span><span class="p">],</span> <span class="n">yerr</span><span class="o">=</span><span class="n">y_times_errs</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">tra_mask</span><span class="p">],</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;#0033A0&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Observed Transit Mid-Times&quot;</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">timing_data</span><span class="o">.</span><span class="n">epochs</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">occ_mask</span><span class="p">],</span> <span class="n">y_times</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">occ_mask</span><span class="p">],</span> <span class="n">yerr</span><span class="o">=</span><span class="n">y_times_errs</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">occ_mask</span><span class="p">],</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;#D64309&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Observed Occultation Mid-Times&quot;</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
        <span class="c1"># Else just plot all data together</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">timing_data</span><span class="o">.</span><span class="n">epochs</span><span class="p">,</span> <span class="n">y_data</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;#0033A0&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">timing_data</span><span class="o">.</span><span class="n">epochs</span><span class="p">,</span> <span class="n">y_times</span><span class="p">,</span> <span class="n">yerr</span><span class="o">=</span><span class="n">y_times_errs</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;#0033A0&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Observed Mid-Times&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Epochs&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">subtract_lin_params</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Lin-Subtracted Mid-Times (Seconds)&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Mid-Times (JD TDB)&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">model_data</span><span class="p">[</span><span class="s2">&quot;model_type&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">capitalize</span><span class="p">()</span><span class="si">}</span><span class="s1"> Model Mid-Times&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.25</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">ticklabel_format</span><span class="p">(</span><span class="n">style</span><span class="o">=</span><span class="s2">&quot;plain&quot;</span><span class="p">,</span> <span class="n">useOffset</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">save_plot</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">save_filepath</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">ax</span></div>


<div class="viewcode-block" id="Ephemeris.plot_timing_uncertainties">
<a class="viewcode-back" href="../../../susie.html#src.susie.ephemeris.Ephemeris.plot_timing_uncertainties">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">plot_timing_uncertainties</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_data</span><span class="p">,</span> <span class="n">save_plot</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">save_filepath</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Plots a scatterplot of uncertainties on the fit model for each epoch.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">            model_data: dict</span>
<span class="sd">                The model data dictionary recieved from the `fit_model` method.</span>
<span class="sd">            save_plot: bool </span>
<span class="sd">                If True, will save the plot as a figure.</span>
<span class="sd">            save_filepath: Optional(str)</span>
<span class="sd">                The path used to save the plot if `save_plot` is True.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># get uncertainties</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="o">*</span><span class="p">(</span><span class="mi">16</span><span class="o">/</span><span class="mi">9</span><span class="p">),</span> <span class="mi">6</span><span class="p">))</span>
        <span class="n">uncertainties</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_model_uncertainties</span><span class="p">(</span><span class="n">model_data</span><span class="p">)</span>
        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">timing_data</span><span class="o">.</span><span class="n">epochs</span>
        <span class="c1"># get T(E)-T0-PE (for transits), T(E)-T0-0.5P-PE (for occultations)</span>
        <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_subtract_linear_parameters</span><span class="p">(</span><span class="n">model_data</span><span class="p">[</span><span class="s1">&#39;model_data&#39;</span><span class="p">],</span> <span class="n">model_data</span><span class="p">[</span><span class="s1">&#39;conjunction_time&#39;</span><span class="p">],</span> <span class="n">model_data</span><span class="p">[</span><span class="s1">&#39;period&#39;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">timing_data</span><span class="o">.</span><span class="n">epochs</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">timing_data</span><span class="o">.</span><span class="n">tra_or_occ</span><span class="p">)</span>
        <span class="c1"># plot the y line, then the line +- the uncertainties</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;$t(E) - T_</span><span class="si">{0}</span><span class="s1"> - PE$&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="o">-</span><span class="n">uncertainties</span><span class="p">,</span> <span class="n">y</span><span class="o">+</span><span class="n">uncertainties</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;$(t(E) - T_</span><span class="si">{0}</span><span class="s1"> - PE) \pm σ_{t^</span><span class="si">{pred}</span><span class="s1">_</span><span class="si">{tra}</span><span class="s1">}$&#39;</span><span class="p">)</span>
        <span class="c1"># ax.plot(x, y + uncertainties, c=&#39;red&#39;, label=&#39;$(t(E) - T_{0} - PE) + σ_{t^{pred}_{tra}}$&#39;)</span>
        <span class="c1"># ax.plot(x, y - uncertainties, c=&#39;red&#39;, label=&#39;$(t(E) - T_{0} - PE) - σ_{t^{pred}_{tra}}$&#39;)</span>
        <span class="c1"># Add labels and show legend</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Epochs&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Mid-Time Uncertainties (JD TDB)&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Uncertainties of </span><span class="si">{</span><span class="n">model_data</span><span class="p">[</span><span class="s2">&quot;model_type&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">capitalize</span><span class="p">()</span><span class="si">}</span><span class="s1"> Model Mid-Times&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.25</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">save_plot</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">save_filepath</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">ax</span></div>


<div class="viewcode-block" id="Ephemeris.plot_oc_plot">
<a class="viewcode-back" href="../../../susie.html#src.susie.ephemeris.Ephemeris.plot_oc_plot">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">plot_oc_plot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_type</span><span class="p">,</span> <span class="n">save_plot</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">save_filepath</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Plots a scatter plot of observed minus calculated mid-times. </span>
<span class="sd">        </span>
<span class="sd">        Subtracts the linear portion from the observed mid-times. The linear portion is calculated using</span>
<span class="sd">        the best-fit parameters from the given model_type. </span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">            model_type: str</span>
<span class="sd">                Either &quot;quadratic&quot; or &quot;precession&quot;. One of the ephemerides being compared to the linear model.</span>
<span class="sd">            save_plot: bool </span>
<span class="sd">                If True, will save the plot as a figure.</span>
<span class="sd">            save_filepath: Optional(str)</span>
<span class="sd">                The path used to save the plot if `save_plot` is True.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="o">*</span><span class="p">(</span><span class="mi">16</span><span class="o">/</span><span class="mi">9</span><span class="p">),</span> <span class="mi">6</span><span class="p">))</span>
        <span class="n">DAYS_TO_SECONDS</span> <span class="o">=</span> <span class="mi">86400</span>
        <span class="c1"># y = T0 - PE - 0.5 dP/dE E^2</span>
        <span class="n">linear_model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fit_model</span><span class="p">(</span><span class="s2">&quot;linear&quot;</span><span class="p">)</span>
        <span class="n">model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fit_model</span><span class="p">(</span><span class="n">model_type</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="c1"># plot observed points w/ x=epoch, y=T(E)-T0-PE, yerr=sigmaT0</span>
        <span class="n">y</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_subtract_linear_parameters</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">timing_data</span><span class="o">.</span><span class="n">mid_times</span><span class="p">,</span> <span class="n">linear_model</span><span class="p">[</span><span class="s1">&#39;conjunction_time&#39;</span><span class="p">],</span> <span class="n">linear_model</span><span class="p">[</span><span class="s1">&#39;period&#39;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">timing_data</span><span class="o">.</span><span class="n">epochs</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">timing_data</span><span class="o">.</span><span class="n">tra_or_occ</span><span class="p">))</span> <span class="o">*</span> <span class="n">DAYS_TO_SECONDS</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">oc_vals</span> <span class="o">=</span> <span class="n">y</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">timing_data</span><span class="o">.</span><span class="n">epochs</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">yerr</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">timing_data</span><span class="o">.</span><span class="n">mid_time_uncertainties</span><span class="o">*</span><span class="n">DAYS_TO_SECONDS</span><span class="p">,</span> 
                    <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;#0033A0&#39;</span><span class="p">,</span>
                    <span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;$t(E) - T_{0,\mathrm</span><span class="si">{lin}</span><span class="s1">} - P_{\mathrm</span><span class="si">{lin}</span><span class="s1">} E$&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">model_type</span> <span class="o">==</span> <span class="s2">&quot;quadratic&quot;</span><span class="p">:</span>
            <span class="c1"># Plot additional quadratic curve</span>
            <span class="c1"># y = 0.5 dP/dE * (E - median E)^2</span>
            <span class="n">quad_curve</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.5</span><span class="o">*</span><span class="n">model</span><span class="p">[</span><span class="s1">&#39;period_change_by_epoch&#39;</span><span class="p">])</span><span class="o">*</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">timing_data</span><span class="o">.</span><span class="n">epochs</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">timing_data</span><span class="o">.</span><span class="n">epochs</span><span class="p">))</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">DAYS_TO_SECONDS</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">timing_data</span><span class="o">.</span><span class="n">epochs</span><span class="p">,</span>
                    <span class="p">(</span><span class="n">quad_curve</span><span class="p">),</span>
                    <span class="n">color</span><span class="o">=</span><span class="s1">&#39;#D64309&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;$\frac</span><span class="si">{1}{2}</span><span class="s1">(\frac</span><span class="si">{dP}{dE}</span><span class="s1">)E^2$&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">model_type</span> <span class="o">==</span> <span class="s2">&quot;precession&quot;</span><span class="p">:</span>
            <span class="c1"># Plot additional precession curve</span>
            <span class="n">tra_mask</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">timing_data</span><span class="o">.</span><span class="n">tra_or_occ</span> <span class="o">==</span> <span class="s2">&quot;tra&quot;</span>
            <span class="n">occ_mask</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">timing_data</span><span class="o">.</span><span class="n">tra_or_occ</span> <span class="o">==</span> <span class="s2">&quot;occ&quot;</span>
            <span class="n">precession_curve_tra</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="o">*</span><span class="p">((</span><span class="n">model</span><span class="p">[</span><span class="s2">&quot;eccentricity&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">model</span><span class="p">[</span><span class="s2">&quot;period&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="p">((</span><span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">))</span> <span class="o">*</span> <span class="n">model</span><span class="p">[</span><span class="s2">&quot;pericenter_change_by_epoch&quot;</span><span class="p">]))))</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">model</span><span class="p">[</span><span class="s2">&quot;pericenter&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">model</span><span class="p">[</span><span class="s2">&quot;pericenter_change_by_epoch&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">timing_data</span><span class="o">.</span><span class="n">epochs</span><span class="p">[</span><span class="n">tra_mask</span><span class="p">]</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">timing_data</span><span class="o">.</span><span class="n">epochs</span><span class="p">[</span><span class="n">tra_mask</span><span class="p">]))))))</span> <span class="o">*</span> <span class="n">DAYS_TO_SECONDS</span>
            <span class="n">precession_curve_occ</span> <span class="o">=</span> <span class="p">(((</span><span class="n">model</span><span class="p">[</span><span class="s2">&quot;eccentricity&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">model</span><span class="p">[</span><span class="s2">&quot;period&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="p">((</span><span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">))</span> <span class="o">*</span> <span class="n">model</span><span class="p">[</span><span class="s2">&quot;pericenter_change_by_epoch&quot;</span><span class="p">]))))</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">model</span><span class="p">[</span><span class="s2">&quot;pericenter&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">model</span><span class="p">[</span><span class="s2">&quot;pericenter_change_by_epoch&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">timing_data</span><span class="o">.</span><span class="n">epochs</span><span class="p">[</span><span class="n">occ_mask</span><span class="p">]</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">timing_data</span><span class="o">.</span><span class="n">epochs</span><span class="p">[</span><span class="n">occ_mask</span><span class="p">]))))))</span> <span class="o">*</span> <span class="n">DAYS_TO_SECONDS</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">timing_data</span><span class="o">.</span><span class="n">epochs</span><span class="p">[</span><span class="n">tra_mask</span><span class="p">],</span>
                    <span class="p">(</span><span class="n">precession_curve_tra</span><span class="p">),</span>
                    <span class="n">color</span><span class="o">=</span><span class="s1">&#39;#D64309&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;$-\frac</span><span class="si">{eP_a}</span><span class="s1">{\pi}\cos\omega(E)$&#39;</span><span class="p">)</span>
                <span class="c1"># $\frac{1}{2}(\frac{dP}{dE})E^2$</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">timing_data</span><span class="o">.</span><span class="n">epochs</span><span class="p">[</span><span class="n">occ_mask</span><span class="p">],</span>
                    <span class="p">(</span><span class="n">precession_curve_occ</span><span class="p">),</span>
                    <span class="n">color</span><span class="o">=</span><span class="s1">&#39;#D64309&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s2">&quot;:&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;$\frac</span><span class="si">{eP_a}</span><span class="s1">{\pi}\cos\omega(E)$&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Epoch&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;O-C (seconds)&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Observed Minus </span><span class="si">{</span><span class="n">model_type</span><span class="o">.</span><span class="n">capitalize</span><span class="p">()</span><span class="si">}</span><span class="s1"> Model Calculated Mid-Times&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.25</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">save_plot</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">save_filepath</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">ax</span></div>


<div class="viewcode-block" id="Ephemeris.plot_running_delta_bic">
<a class="viewcode-back" href="../../../susie.html#src.susie.ephemeris.Ephemeris.plot_running_delta_bic">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">plot_running_delta_bic</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model1</span><span class="p">,</span> <span class="n">model2</span><span class="p">,</span> <span class="n">save_plot</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">save_filepath</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Plots a scatterplot of epochs vs. :math:`\\Delta BIC` for each epoch.</span>

<span class="sd">        Starting at the third epoch, will plot the value of :math:`\\Delta BIC` for all previous epochs,</span>
<span class="sd">        showing how the value of :math:`\\Delta BIC` progresses over time with more observations.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">            model1: str</span>
<span class="sd">                Either &quot;linear&quot;, &quot;quadratic&quot;, or &quot;precession&quot;. One of the ephemerides being compared.</span>
<span class="sd">            model2: str</span>
<span class="sd">                Either &quot;linear&quot;, &quot;quadratic&quot;, or &quot;precession&quot;. One of the ephemerides being compared.</span>
<span class="sd">            save_plot: bool </span>
<span class="sd">                If True, will save the plot as a figure.</span>
<span class="sd">            save_filepath: Optional(str)</span>
<span class="sd">                The path used to save the plot if `save_plot` is True.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Create empty array to store values</span>
        <span class="n">delta_bics</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">timing_data</span><span class="o">.</span><span class="n">epochs</span><span class="p">))</span>
        <span class="n">uncertainties</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">timing_data</span><span class="o">.</span><span class="n">epochs</span><span class="p">))</span>
        <span class="c1"># Create copy of each variable to be used</span>
        <span class="n">all_epochs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">timing_data</span><span class="o">.</span><span class="n">epochs</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">all_mid_times</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">timing_data</span><span class="o">.</span><span class="n">mid_times</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">all_uncertainties</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">timing_data</span><span class="o">.</span><span class="n">mid_time_uncertainties</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">all_tra_or_occ</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">timing_data</span><span class="o">.</span><span class="n">tra_or_occ</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="c1"># For each epoch, calculate delta BIC using all data up to that epoch</span>
        <span class="n">ks</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_k_value</span><span class="p">(</span><span class="n">model1</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_k_value</span><span class="p">(</span><span class="n">model2</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">ks</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">timing_data</span><span class="o">.</span><span class="n">epochs</span><span class="p">)):</span>
            <span class="n">timing_data</span> <span class="o">=</span> <span class="n">TimingData</span><span class="p">(</span><span class="s2">&quot;jd&quot;</span><span class="p">,</span> <span class="n">all_epochs</span><span class="p">[:</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">],</span> <span class="n">all_mid_times</span><span class="p">[:</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">],</span> <span class="n">all_uncertainties</span><span class="p">[:</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">],</span> <span class="n">all_tra_or_occ</span><span class="p">[:</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">],</span> <span class="s2">&quot;tdb&quot;</span><span class="p">)</span>
            <span class="c1"># Create new model object with new timing data</span>
            <span class="n">model</span> <span class="o">=</span> <span class="n">Ephemeris</span><span class="p">(</span><span class="n">timing_data</span><span class="p">)</span>
            <span class="c1"># Get delta bic of the two models</span>
            <span class="n">delta_bic</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">calc_delta_bic</span><span class="p">(</span><span class="n">model1</span><span class="p">,</span> <span class="n">model2</span><span class="p">)</span>
            <span class="n">delta_bics</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">delta_bic</span>
            <span class="c1"># Get uncertainties of the delta bic</span>
            <span class="n">uncertainties</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="mi">2</span><span class="o">*</span><span class="n">i</span><span class="o">-</span><span class="nb">sum</span><span class="p">(</span><span class="n">ks</span><span class="p">)))</span>
        <span class="c1"># Plot the data</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="o">*</span><span class="p">(</span><span class="mi">16</span><span class="o">/</span><span class="mi">9</span><span class="p">),</span> <span class="mi">6</span><span class="p">))</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">timing_data</span><span class="o">.</span><span class="n">epochs</span><span class="p">,</span> <span class="n">delta_bics</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;#0033A0&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s2">&quot;-&quot;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">timing_data</span><span class="o">.</span><span class="n">epochs</span><span class="p">,</span> <span class="n">delta_bics</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;#0033A0&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s2">&quot;-&quot;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">timing_data</span><span class="o">.</span><span class="n">epochs</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">delta_bics</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;#D64309&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">rf</span><span class="s2">&quot;Final $\Delta$BIC=BIC$_</span><span class="se">{{</span><span class="si">{</span><span class="n">model1</span><span class="si">}</span><span class="se">}}</span><span class="s2">$ - BIC$_</span><span class="se">{{</span><span class="si">{</span><span class="n">model2</span><span class="si">}</span><span class="se">}}</span><span class="s2">$=</span><span class="si">{</span><span class="n">delta_bics</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">timing_data</span><span class="o">.</span><span class="n">epochs</span><span class="p">,</span> <span class="n">delta_bics</span><span class="o">-</span><span class="n">uncertainties</span><span class="p">,</span> <span class="n">delta_bics</span><span class="o">+</span><span class="n">uncertainties</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>
        <span class="c1"># ax.plot(self.timing_data.epochs, delta_bics, color=&#39;#0033A0&#39;, marker=&#39;.&#39;, markersize=6, mec=&quot;#D64309&quot;, ls=&quot;--&quot;, linewidth=2)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;grey&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Epoch&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$\Delta$BIC&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">rf</span><span class="s2">&quot;Evolution of $\Delta$BIC Comparing </span><span class="si">{</span><span class="n">model1</span><span class="o">.</span><span class="n">capitalize</span><span class="p">()</span><span class="si">}</span><span class="s2"> and </span><span class="si">{</span><span class="n">model2</span><span class="o">.</span><span class="n">capitalize</span><span class="p">()</span><span class="si">}</span><span class="s2"> Models&quot;</span>
                    <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
                    <span class="sa">rf</span><span class="s2">&quot;as Observational Epochs Increase&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.25</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
        <span class="c1"># Save if save_plot and save_filepath have been provided</span>
        <span class="k">if</span> <span class="n">save_plot</span> <span class="ow">and</span> <span class="n">save_filepath</span><span class="p">:</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">save_filepath</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">)</span>
        <span class="c1"># Return the axis (so it can be further edited if needed)</span>
        <span class="k">return</span> <span class="n">ax</span></div>

    
<div class="viewcode-block" id="Ephemeris.plot_delta_bic_omit_one">
<a class="viewcode-back" href="../../../susie.html#src.susie.ephemeris.Ephemeris.plot_delta_bic_omit_one">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">plot_delta_bic_omit_one</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model1</span><span class="o">=</span><span class="s2">&quot;linear&quot;</span><span class="p">,</span> <span class="n">model2</span><span class="o">=</span><span class="s2">&quot;quadratic&quot;</span><span class="p">,</span> <span class="n">outlier_percentage</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">save_plot</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">save_filepath</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">            model1: str</span>

<span class="sd">            model2: str</span>

<span class="sd">            outlier_percentage: int</span>

<span class="sd">            save_plot: bool</span>

<span class="sd">            save_filepath: str</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Need to remove the data point at each index and calculate the BIC value</span>
        <span class="c1"># Plotting the BIC value when the point at each epoch is removed</span>
        <span class="c1"># If outlier percentage: calculate a percentage for each</span>
        <span class="n">delta_bic</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calc_delta_bic</span><span class="p">(</span><span class="n">model1</span><span class="p">,</span> <span class="n">model2</span><span class="p">)</span>
        <span class="n">delta_bics</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">timing_data</span><span class="o">.</span><span class="n">epochs</span><span class="p">))</span>
        <span class="n">delta_bic_percentages</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">timing_data</span><span class="o">.</span><span class="n">epochs</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">timing_data</span><span class="o">.</span><span class="n">epochs</span><span class="p">)):</span>
            <span class="c1"># Create new timing data with elements at the given index removed</span>
            <span class="n">epochs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">timing_data</span><span class="o">.</span><span class="n">epochs</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
            <span class="n">mid_times</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">timing_data</span><span class="o">.</span><span class="n">mid_times</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
            <span class="n">mid_time_uncertainties</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">timing_data</span><span class="o">.</span><span class="n">mid_time_uncertainties</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
            <span class="n">tra_or_occs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">timing_data</span><span class="o">.</span><span class="n">tra_or_occ</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
            <span class="n">timing_data</span> <span class="o">=</span> <span class="n">TimingData</span><span class="p">(</span><span class="s2">&quot;jd&quot;</span><span class="p">,</span> <span class="n">epochs</span><span class="p">,</span> <span class="n">mid_times</span><span class="p">,</span> <span class="n">mid_time_uncertainties</span><span class="p">,</span> <span class="n">tra_or_occs</span><span class="p">,</span> <span class="s2">&quot;tdb&quot;</span><span class="p">)</span>
            <span class="c1"># Create new model object with new timing data</span>
            <span class="n">model</span> <span class="o">=</span> <span class="n">Ephemeris</span><span class="p">(</span><span class="n">timing_data</span><span class="p">)</span>
            <span class="c1"># Get delta BIC</span>
            <span class="n">d_bic</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">calc_delta_bic</span><span class="p">(</span><span class="n">model1</span><span class="p">,</span> <span class="n">model2</span><span class="p">)</span>
            <span class="n">delta_bics</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">d_bic</span><span class="p">)</span>
            <span class="c1"># Calculate the percentage difference </span>
            <span class="n">perc_diff</span> <span class="o">=</span> <span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">d_bic</span> <span class="o">-</span> <span class="n">delta_bic</span><span class="p">)</span> <span class="o">/</span> <span class="p">((</span><span class="n">d_bic</span> <span class="o">+</span> <span class="n">delta_bic</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">))</span> <span class="o">*</span> <span class="mi">100</span>
            <span class="n">delta_bic_percentages</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">perc_diff</span><span class="p">)</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="o">*</span><span class="p">(</span><span class="mi">16</span><span class="o">/</span><span class="mi">9</span><span class="p">),</span> <span class="mi">6</span><span class="p">))</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">timing_data</span><span class="o">.</span><span class="n">epochs</span><span class="p">,</span> <span class="n">delta_bics</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;#0033A0&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">calc_delta_bic</span><span class="p">(</span><span class="n">model1</span><span class="p">,</span> <span class="n">model2</span><span class="p">),</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;#D64309&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">rf</span><span class="s2">&quot;$\Delta$BIC = BIC$_</span><span class="se">{{</span><span class="si">{</span><span class="n">model1</span><span class="si">}</span><span class="se">}}</span><span class="s2">$ - BIC$_</span><span class="se">{{</span><span class="si">{</span><span class="n">model2</span><span class="si">}</span><span class="se">}}</span><span class="s2">$ = </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">calc_delta_bic</span><span class="p">(</span><span class="n">model1</span><span class="p">,</span><span class="w"> </span><span class="n">model2</span><span class="p">)</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="c1"># If we are given a percentage difference to mark, then plot that</span>
        <span class="k">if</span> <span class="n">outlier_percentage</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">is_outlier</span> <span class="o">=</span> <span class="n">delta_bic_percentages</span> <span class="o">&gt;=</span> <span class="n">outlier_percentage</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">timing_data</span><span class="o">.</span><span class="n">epochs</span><span class="p">[</span><span class="n">is_outlier</span><span class="p">],</span> <span class="n">delta_bics</span><span class="p">[</span><span class="n">is_outlier</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;s&quot;</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">rf</span><span class="s2">&quot;Shifts $\Delta$ BIC by ≥ </span><span class="si">{</span><span class="n">outlier_percentage</span><span class="si">}</span><span class="s2">%&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Epochs&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$\Delta$BIC&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;Final $\Delta$BIC if we Omit One Point&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.25</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
        <span class="c1"># Save if save_plot and save_filepath have been provided</span>
        <span class="k">if</span> <span class="n">save_plot</span> <span class="ow">and</span> <span class="n">save_filepath</span><span class="p">:</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">save_filepath</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">ax</span></div>


<div class="viewcode-block" id="Ephemeris.plot_running_analytical_delta_bic_quadratic">
<a class="viewcode-back" href="../../../susie.html#src.susie.ephemeris.Ephemeris.plot_running_analytical_delta_bic_quadratic">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">plot_running_analytical_delta_bic_quadratic</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">save_plot</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">save_filepath</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            delta_bic = 0.25(dPdE)^2 * sum(()^2) - ln(N) + 1</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Grab a copy of all timing data</span>
        <span class="n">all_epochs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">timing_data</span><span class="o">.</span><span class="n">epochs</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">tra_mask</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">all_mid_times</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">timing_data</span><span class="o">.</span><span class="n">mid_times</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">tra_mask</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">all_uncertainties</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">timing_data</span><span class="o">.</span><span class="n">mid_time_uncertainties</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">tra_mask</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">all_tra_or_occ</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">timing_data</span><span class="o">.</span><span class="n">tra_or_occ</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">tra_mask</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="c1"># Create some empty arrays to hold data</span>
        <span class="n">numerical_delta_bics</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">timing_data</span><span class="o">.</span><span class="n">epochs</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">tra_mask</span><span class="p">]))</span>
        <span class="n">numerical_delta_bic_errs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">timing_data</span><span class="o">.</span><span class="n">epochs</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">tra_mask</span><span class="p">]))</span>
        <span class="n">analytical_delta_bics</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">timing_data</span><span class="o">.</span><span class="n">epochs</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">tra_mask</span><span class="p">]))</span>
        <span class="n">analytical_delta_bic_errs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">timing_data</span><span class="o">.</span><span class="n">epochs</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">tra_mask</span><span class="p">]))</span>
        <span class="c1"># Grab the tidal decay rate for the analytical calculation</span>
        <span class="n">dPdE</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fit_model</span><span class="p">(</span><span class="s2">&quot;quadratic&quot;</span><span class="p">)[</span><span class="s2">&quot;period_change_by_epoch&quot;</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">timing_data</span><span class="o">.</span><span class="n">epochs</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">tra_mask</span><span class="p">])):</span>
            <span class="n">timing_data</span> <span class="o">=</span> <span class="n">TimingData</span><span class="p">(</span><span class="s2">&quot;jd&quot;</span><span class="p">,</span> <span class="n">all_epochs</span><span class="p">[:</span><span class="n">i</span><span class="p">],</span> <span class="n">all_mid_times</span><span class="p">[:</span><span class="n">i</span><span class="p">],</span> <span class="n">all_uncertainties</span><span class="p">[:</span><span class="n">i</span><span class="p">],</span> <span class="n">all_tra_or_occ</span><span class="p">[:</span><span class="n">i</span><span class="p">],</span> <span class="s2">&quot;tdb&quot;</span><span class="p">)</span>
            <span class="c1"># Create new model object with new timing data</span>
            <span class="n">model</span> <span class="o">=</span> <span class="n">Ephemeris</span><span class="p">(</span><span class="n">timing_data</span><span class="p">)</span>
            <span class="c1"># quad_model = model.fit_model(&quot;quadratic&quot;)</span>
            <span class="c1"># Calculate the numerical delta BIC</span>
            <span class="n">numerical_delta_bic</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">calc_delta_bic</span><span class="p">(</span><span class="s2">&quot;linear&quot;</span><span class="p">,</span> <span class="s2">&quot;quadratic&quot;</span><span class="p">)</span>
            <span class="n">numerical_delta_bics</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">numerical_delta_bic</span>
            <span class="c1"># Calculate the analytical delta BIC</span>
            <span class="n">analytical_delta_bic</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">_calc_analytical_delta_bic_quad</span><span class="p">(</span><span class="n">dPdE</span><span class="p">)</span>
            <span class="n">analytical_delta_bics</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">analytical_delta_bic</span>
            <span class="c1"># Calculate the err</span>
            <span class="n">numerical_delta_bic_errs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="mi">5</span><span class="p">)))</span>
            <span class="n">analytical_delta_bic_errs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="mi">5</span><span class="p">)))</span>
        <span class="c1"># Plot the data</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="o">*</span><span class="p">(</span><span class="mi">16</span><span class="o">/</span><span class="mi">9</span><span class="p">),</span> <span class="mi">6</span><span class="p">))</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">timing_data</span><span class="o">.</span><span class="n">epochs</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">tra_mask</span><span class="p">],</span> <span class="n">numerical_delta_bics</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;#0033A0&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">7</span><span class="p">,</span> <span class="n">mec</span><span class="o">=</span><span class="s2">&quot;#0033A0&quot;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s2">&quot;-&quot;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">1.5</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;Evolution of Numerical $\Delta$BIC as Observational Epochs Increase&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">timing_data</span><span class="o">.</span><span class="n">epochs</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">tra_mask</span><span class="p">],</span> <span class="n">analytical_delta_bics</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;#D64309&quot;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">7</span><span class="p">,</span> <span class="n">mec</span><span class="o">=</span><span class="s2">&quot;#D64309&quot;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">1.5</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;Evolution of Analytical $\Delta$BIC as Observational Epochs Increase&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">timing_data</span><span class="o">.</span><span class="n">epochs</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">tra_mask</span><span class="p">],</span> <span class="n">numerical_delta_bics</span><span class="o">-</span><span class="n">numerical_delta_bic_errs</span><span class="p">,</span> <span class="n">numerical_delta_bics</span><span class="o">+</span><span class="n">numerical_delta_bic_errs</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">timing_data</span><span class="o">.</span><span class="n">epochs</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">tra_mask</span><span class="p">],</span> <span class="n">analytical_delta_bics</span><span class="o">-</span><span class="n">analytical_delta_bic_errs</span><span class="p">,</span> <span class="n">analytical_delta_bics</span><span class="o">+</span><span class="n">analytical_delta_bic_errs</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;grey&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Epoch&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$\Delta$BIC&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">rf</span><span class="s2">&quot;Evolution of $\Delta$BIC Comparing Linear and Quadratic Models&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.25</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
        <span class="c1"># Save if save_plot and save_filepath have been provided</span>
        <span class="k">if</span> <span class="n">save_plot</span> <span class="ow">and</span> <span class="n">save_filepath</span><span class="p">:</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">save_filepath</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">)</span>
        <span class="c1"># Return the axis (so it can be further edited if needed)</span>
        <span class="k">return</span> <span class="n">ax</span></div>


<div class="viewcode-block" id="Ephemeris.plot_running_analytical_delta_bic_precession">
<a class="viewcode-back" href="../../../susie.html#src.susie.ephemeris.Ephemeris.plot_running_analytical_delta_bic_precession">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">plot_running_analytical_delta_bic_precession</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">save_plot</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">save_filepath</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Plot the running analytical delta BIC</span>

<span class="sd">        NOTES: Using synthetic precession data generated from Brian&#39;s nb,</span>
<span class="sd">        Brian&#39;s parameters:</span>
<span class="sd">         &#39;period&#39;: 1.091419633,</span>
<span class="sd">         &#39;conjunction_time&#39;: 2456305.45488,</span>
<span class="sd">         &#39;eccentricity&#39;: 0.0031,</span>
<span class="sd">         &#39;pericenter&#39;: 2.62,</span>
<span class="sd">         &#39;pericenter_change_by_epoch&#39;: 0.000984</span>
<span class="sd">        precession model parameters:</span>
<span class="sd">         &#39;period&#39;: 1.0914194950612286, </span>
<span class="sd">         &#39;conjunction_time&#39;: 2456305.4547539037, </span>
<span class="sd">         &#39;eccentricity&#39;: 0.004492419251877544,</span>
<span class="sd">         &#39;pericenter&#39;: 3.748694994358649,</span>
<span class="sd">         &#39;pericenter_change_by_epoch&#39;: 0.0005248792790545403</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Create copy of each variable to be used</span>
        <span class="n">all_epochs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">timing_data</span><span class="o">.</span><span class="n">epochs</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">tra_mask</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">all_mid_times</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">timing_data</span><span class="o">.</span><span class="n">mid_times</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">tra_mask</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">all_uncertainties</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">timing_data</span><span class="o">.</span><span class="n">mid_time_uncertainties</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">tra_mask</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">all_tra_or_occ</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">timing_data</span><span class="o">.</span><span class="n">tra_or_occ</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">tra_mask</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="c1"># Create some empty arrays to hold data</span>
        <span class="n">numerical_delta_bics</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">timing_data</span><span class="o">.</span><span class="n">epochs</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">tra_mask</span><span class="p">]))</span>
        <span class="n">analytical_delta_bics</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">timing_data</span><span class="o">.</span><span class="n">epochs</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">tra_mask</span><span class="p">]))</span>
        <span class="c1"># Grab precession model to calcualte the cos_ws</span>
        <span class="n">precession_model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fit_model</span><span class="p">(</span><span class="s2">&quot;precession&quot;</span><span class="p">)</span>
        <span class="n">e</span> <span class="o">=</span> <span class="n">precession_model</span><span class="p">[</span><span class="s2">&quot;eccentricity&quot;</span><span class="p">]</span>
        <span class="n">w0</span> <span class="o">=</span> <span class="n">precession_model</span><span class="p">[</span><span class="s2">&quot;pericenter&quot;</span><span class="p">]</span>
        <span class="n">dwdE</span> <span class="o">=</span> <span class="n">precession_model</span><span class="p">[</span><span class="s2">&quot;pericenter_change_by_epoch&quot;</span><span class="p">]</span>
        <span class="n">Pa</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calc_anomalistic_period</span><span class="p">(</span><span class="n">precession_model</span><span class="p">[</span><span class="s2">&quot;period&quot;</span><span class="p">],</span> <span class="n">dwdE</span><span class="p">)</span>
        <span class="c1"># Iterate through all data points</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">timing_data</span><span class="o">.</span><span class="n">epochs</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">tra_mask</span><span class="p">])):</span>
            <span class="n">timing_data</span> <span class="o">=</span> <span class="n">TimingData</span><span class="p">(</span><span class="s2">&quot;jd&quot;</span><span class="p">,</span> <span class="n">all_epochs</span><span class="p">[:</span><span class="n">i</span><span class="p">],</span> <span class="n">all_mid_times</span><span class="p">[:</span><span class="n">i</span><span class="p">],</span> <span class="n">all_uncertainties</span><span class="p">[:</span><span class="n">i</span><span class="p">],</span> <span class="n">all_tra_or_occ</span><span class="p">[:</span><span class="n">i</span><span class="p">],</span> <span class="s2">&quot;tdb&quot;</span><span class="p">)</span>
            <span class="c1"># Create new model object with new timing data</span>
            <span class="n">model</span> <span class="o">=</span> <span class="n">Ephemeris</span><span class="p">(</span><span class="n">timing_data</span><span class="p">)</span>
            <span class="c1"># Calculate the numerical delta BIC</span>
            <span class="n">numerical_delta_bic</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">calc_delta_bic</span><span class="p">(</span><span class="s2">&quot;linear&quot;</span><span class="p">,</span> <span class="s2">&quot;quadratic&quot;</span><span class="p">)</span>
            <span class="n">numerical_delta_bics</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">numerical_delta_bic</span>
            <span class="c1"># Calculate the analytical delta BIC</span>
            <span class="n">analytical_delta_bic</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">_calc_analytical_delta_bic_prec</span><span class="p">(</span><span class="n">Pa</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">w0</span><span class="p">,</span> <span class="n">dwdE</span><span class="p">)</span>
            <span class="n">analytical_delta_bics</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">analytical_delta_bic</span>
        <span class="c1"># Plot the data</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="o">*</span><span class="p">(</span><span class="mi">16</span><span class="o">/</span><span class="mi">9</span><span class="p">),</span> <span class="mi">6</span><span class="p">))</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">timing_data</span><span class="o">.</span><span class="n">epochs</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">tra_mask</span><span class="p">],</span> <span class="n">numerical_delta_bics</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;#0033A0&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">7</span><span class="p">,</span> <span class="n">mec</span><span class="o">=</span><span class="s2">&quot;#0033A0&quot;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s2">&quot;-&quot;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">1.5</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;Evolution of Numerical $\Delta$BIC as Observational Epochs Increase&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">timing_data</span><span class="o">.</span><span class="n">epochs</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">tra_mask</span><span class="p">],</span> <span class="n">analytical_delta_bics</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;#D64309&quot;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">7</span><span class="p">,</span> <span class="n">mec</span><span class="o">=</span><span class="s2">&quot;#D64309&quot;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">1.5</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;Evolution of Analytical $\Delta$BIC as Observational Epochs Increase&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;grey&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Epochs&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$\Delta$BIC&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;Evolution of $\Delta$BIC Comparing Linear and Precession Ephemerides&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.25</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
        <span class="c1"># Save if save_plot and save_filepath have been provided</span>
        <span class="k">if</span> <span class="n">save_plot</span> <span class="ow">and</span> <span class="n">save_filepath</span><span class="p">:</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">save_filepath</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">ax</span></div>
</div>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="c1"># STEP 1: Upload datra from file</span>
    <span class="n">bjd_filepath</span> <span class="o">=</span> <span class="s2">&quot;../../example_data/wasp12b_tra_occ.csv&quot;</span>
    <span class="n">bjd_no_occs_filepath</span> <span class="o">=</span> <span class="s2">&quot;../../example_data/WASP12b_transit_ephemeris.csv&quot;</span>
    <span class="n">isot_filepath</span> <span class="o">=</span> <span class="s2">&quot;../../example_data/wasp12b_isot_utc.csv&quot;</span>
    <span class="n">jd_utc_filepath</span> <span class="o">=</span> <span class="s2">&quot;../../example_data/wasp12b_jd_utc.csv&quot;</span>
    <span class="n">jd_utc_no_occs_filepath</span> <span class="o">=</span> <span class="s2">&quot;../../example_data/wasp12b_jd_utc_tra.csv&quot;</span>
    <span class="n">test_filepath</span> <span class="o">=</span> <span class="s2">&quot;../../example_data/test_data.csv&quot;</span>
    <span class="n">precession_test_filepath</span> <span class="o">=</span> <span class="s2">&quot;../../example_data/precession_test_data.csv&quot;</span>
    <span class="n">wasp12_tra_only</span> <span class="o">=</span> <span class="s2">&quot;../../example_data/WASP12b_transit_ephemeris.csv&quot;</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">genfromtxt</span><span class="p">(</span><span class="n">bjd_filepath</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="s1">&#39;,&#39;</span><span class="p">,</span> <span class="n">names</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
    <span class="c1"># bjd_data_no_occs = np.genfromtxt(bjd_no_occs_filepath, delimiter=&#39;,&#39;, names=True, dtype=None, encoding=None)</span>
    <span class="c1"># isot_data = np.genfromtxt(isot_filepath, delimiter=&#39;,&#39;, names=True, dtype=None, encoding=None)</span>
    <span class="c1"># jd_utc_data = np.genfromtxt(jd_utc_filepath, delimiter=&#39;,&#39;, names=True, dtype=None, encoding=None)</span>
    <span class="c1"># jd_utc_no_occs_data = np.genfromtxt(jd_utc_no_occs_filepath, delimiter=&#39;,&#39;, names=True, dtype=None, encoding=None)</span>
    <span class="c1"># test_data = np.genfromtxt(test_filepath, delimiter=&#39;,&#39;, names=True, dtype=None, encoding=None)</span>

    <span class="c1"># STEP 2: Break data up into epochs, mid-times, and error</span>
    <span class="c1"># STEP 2.5 (Optional): Make sure the epochs are integers and not floats</span>
    <span class="n">tra_or_occs</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;tra_or_occ&quot;</span><span class="p">]</span> <span class="c1"># Base tra_or_occs</span>
    <span class="c1"># tra_or_occs = None # Base tra_or_occs</span>
    <span class="n">epochs</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;epoch&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;int&#39;</span><span class="p">)</span> <span class="c1"># Epochs with tra_or_occs</span>
    <span class="c1"># epochs_no_occs = bjd_data_no_occs[&quot;epochs&quot;]</span>
    <span class="n">mid_times</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;mid_time&quot;</span><span class="p">]</span> <span class="c1"># BJD mid times</span>
    <span class="n">mid_time_errs</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;mid_time_err&quot;</span><span class="p">]</span> <span class="c1"># BJD mid time errs</span>
    <span class="c1"># print(f&quot;epochs: {list(epochs)}&quot;)</span>
    <span class="c1"># print(f&quot;mid_times: {list(mid_times)}&quot;)</span>
    <span class="c1"># print(f&quot;mid_time_errs: {list(mid_time_errs)}&quot;)</span>
    <span class="c1"># print(f&quot;tra_or_occ: {list(tra_or_occs)}&quot;)</span>

    <span class="c1"># STEP 3: Create new transit times object with above data</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;NOTE: ISOT (NO UNCERTAINTIES)&quot;&quot;&quot;</span>
    <span class="c1"># times_obj1 = TimingData(&#39;isot&#39;, epochs, mid_times, tra_or_occ=tra_or_occs, object_ra=97.64, object_dec=29.67, observatory_lat=43.60, observatory_lon=-116.21)</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;NOTE: JD UTC&quot;&quot;&quot;</span>
    <span class="c1"># times_obj1 = TimingData(&#39;jd&#39;, epochs, mid_times, mid_time_errs, tra_or_occ=tra_or_occs, object_ra=97.64, object_dec=29.67, observatory_lat=43.60, observatory_lon=-116.21)</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;NOTE: JD UTC NO UNCERTAINTIES&quot;&quot;&quot;</span>
    <span class="c1"># times_obj1 = TimingData(&#39;jd&#39;, epochs, mid_times, tra_or_occ=tra_or_occs, object_ra=97.64, object_dec=29.67, observatory_lat=43.60, observatory_lon=-116.21)</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;NOTE: JD UTC NO UNCERTAINTIES NO TRA_OR_OCC&quot;&quot;&quot;</span>
    <span class="c1"># times_obj1 = TimingData(&#39;jd&#39;, epochs_no_occs, mid_times, object_ra=97.64, object_dec=29.67, observatory_lat=43.60, observatory_lon=-116.21)</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;NOTE: JD TDB (BJD) NO TRA_OR_OCC&quot;&quot;&quot;</span>
    <span class="c1"># times_obj1 = TimingData(&#39;jd&#39;, epochs_no_occs, mid_times, mid_time_errs, time_scale=&#39;tdb&#39;)</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;NOTE: JD TDB (BJD) ALL INFO&quot;&quot;&quot;</span>
    <span class="n">times_obj1</span> <span class="o">=</span> <span class="n">TimingData</span><span class="p">(</span><span class="s1">&#39;jd&#39;</span><span class="p">,</span> <span class="n">epochs</span><span class="p">,</span> <span class="n">mid_times</span><span class="p">,</span> <span class="n">mid_time_errs</span><span class="p">,</span> <span class="n">time_scale</span><span class="o">=</span><span class="s1">&#39;tdb&#39;</span><span class="p">,</span> <span class="n">tra_or_occ</span><span class="o">=</span><span class="n">tra_or_occs</span><span class="p">)</span>
    
    <span class="c1"># STEP 4: Create new model object with transit times object</span>
    <span class="n">ephemeris_obj1</span> <span class="o">=</span> <span class="n">Ephemeris</span><span class="p">(</span><span class="n">times_obj1</span><span class="p">)</span>
    
    <span class="c1"># STEP 5: Get model data &amp; BIC values</span>
    <span class="c1"># LINEAR MODEL</span>
    <span class="n">linear_model</span> <span class="o">=</span> <span class="n">ephemeris_obj1</span><span class="o">.</span><span class="n">fit_model</span><span class="p">(</span><span class="s1">&#39;linear&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">linear_model</span><span class="p">)</span>
    <span class="n">linear_model_uncertainties</span> <span class="o">=</span> <span class="n">ephemeris_obj1</span><span class="o">.</span><span class="n">get_model_uncertainties</span><span class="p">(</span><span class="n">linear_model</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">linear_model_uncertainties</span><span class="p">)</span>
    <span class="n">lin_bic</span> <span class="o">=</span> <span class="n">ephemeris_obj1</span><span class="o">.</span><span class="n">calc_bic</span><span class="p">(</span><span class="n">linear_model</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">lin_bic</span><span class="p">)</span>
    <span class="c1"># QUADRATIC MODEL</span>
    <span class="n">quad_model</span> <span class="o">=</span> <span class="n">ephemeris_obj1</span><span class="o">.</span><span class="n">fit_model</span><span class="p">(</span><span class="s1">&#39;quadratic&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">quad_model</span><span class="p">)</span>
    <span class="n">quad_model_uncertainties</span> <span class="o">=</span> <span class="n">ephemeris_obj1</span><span class="o">.</span><span class="n">get_model_uncertainties</span><span class="p">(</span><span class="n">quad_model</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">quad_model_uncertainties</span><span class="p">)</span>
    <span class="n">quad_bic</span> <span class="o">=</span> <span class="n">ephemeris_obj1</span><span class="o">.</span><span class="n">calc_bic</span><span class="p">(</span><span class="n">quad_model</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">quad_bic</span><span class="p">)</span>
    <span class="c1"># PRECESSION MODEL</span>
    <span class="n">precession_model</span> <span class="o">=</span> <span class="n">ephemeris_obj1</span><span class="o">.</span><span class="n">fit_model</span><span class="p">(</span><span class="s2">&quot;precession&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">precession_model</span><span class="p">)</span>
    <span class="n">prec_bic</span> <span class="o">=</span> <span class="n">ephemeris_obj1</span><span class="o">.</span><span class="n">calc_bic</span><span class="p">(</span><span class="n">precession_model</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">prec_bic</span><span class="p">)</span>
    <span class="c1"># STEP 5.5a: Get the delta BIC value for the linear and quadratic ephemerides</span>
    <span class="n">delta_bic_lq</span> <span class="o">=</span> <span class="n">ephemeris_obj1</span><span class="o">.</span><span class="n">calc_delta_bic</span><span class="p">(</span><span class="s2">&quot;linear&quot;</span><span class="p">,</span> <span class="s2">&quot;quadratic&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">delta_bic_lq</span><span class="p">)</span>
    <span class="c1"># STEP 5.5b: Get the delta BIC value for the linear and precession ephemerides</span>
    <span class="n">delta_bic_lp</span> <span class="o">=</span> <span class="n">ephemeris_obj1</span><span class="o">.</span><span class="n">calc_delta_bic</span><span class="p">(</span><span class="s2">&quot;linear&quot;</span><span class="p">,</span> <span class="s2">&quot;precession&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">delta_bic_lp</span><span class="p">)</span>
    <span class="c1"># STEP 5.5c: Get the delta BIC value for the quadratic and precession ephemerides</span>
    <span class="n">delta_bic_qp</span> <span class="o">=</span> <span class="n">ephemeris_obj1</span><span class="o">.</span><span class="n">calc_delta_bic</span><span class="p">(</span><span class="s2">&quot;quadratic&quot;</span><span class="p">,</span> <span class="s2">&quot;precession&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">delta_bic_qp</span><span class="p">)</span>
    
    <span class="c1"># STEP 6: Show a plot of the model data</span>
    <span class="n">ephemeris_obj1</span><span class="o">.</span><span class="n">plot_model</span><span class="p">(</span><span class="n">linear_model</span><span class="p">,</span> <span class="n">save_plot</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    <span class="n">ephemeris_obj1</span><span class="o">.</span><span class="n">plot_model</span><span class="p">(</span><span class="n">quad_model</span><span class="p">,</span> <span class="n">save_plot</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    <span class="n">ephemeris_obj1</span><span class="o">.</span><span class="n">plot_model</span><span class="p">(</span><span class="n">precession_model</span><span class="p">,</span> <span class="n">save_plot</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

    <span class="c1"># STEP 7: Uncertainties plot</span>
    <span class="n">ephemeris_obj1</span><span class="o">.</span><span class="n">plot_timing_uncertainties</span><span class="p">(</span><span class="n">linear_model</span><span class="p">,</span> <span class="n">save_plot</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    <span class="n">ephemeris_obj1</span><span class="o">.</span><span class="n">plot_timing_uncertainties</span><span class="p">(</span><span class="n">quad_model</span><span class="p">,</span> <span class="n">save_plot</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    
    <span class="c1"># STEP 8: O-C Plot</span>
    <span class="n">ephemeris_obj1</span><span class="o">.</span><span class="n">plot_oc_plot</span><span class="p">(</span><span class="s2">&quot;quadratic&quot;</span><span class="p">,</span> <span class="n">save_plot</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    <span class="n">ephemeris_obj1</span><span class="o">.</span><span class="n">plot_oc_plot</span><span class="p">(</span><span class="s2">&quot;precession&quot;</span><span class="p">,</span> <span class="n">save_plot</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

    <span class="c1"># STEP 9: Plot running delta BICs</span>
    <span class="n">ephemeris_obj1</span><span class="o">.</span><span class="n">plot_running_delta_bic</span><span class="p">(</span><span class="s2">&quot;linear&quot;</span><span class="p">,</span> <span class="s2">&quot;quadratic&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    <span class="n">ephemeris_obj1</span><span class="o">.</span><span class="n">plot_running_delta_bic</span><span class="p">(</span><span class="s2">&quot;linear&quot;</span><span class="p">,</span> <span class="s2">&quot;precession&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    <span class="n">ephemeris_obj1</span><span class="o">.</span><span class="n">plot_running_delta_bic</span><span class="p">(</span><span class="s2">&quot;quadratic&quot;</span><span class="p">,</span> <span class="s2">&quot;precession&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

    <span class="n">ephemeris_obj1</span><span class="o">.</span><span class="n">plot_delta_bic_omit_one</span><span class="p">(</span><span class="s2">&quot;linear&quot;</span><span class="p">,</span> <span class="s2">&quot;quadratic&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    <span class="n">ephemeris_obj1</span><span class="o">.</span><span class="n">plot_delta_bic_omit_one</span><span class="p">(</span><span class="s2">&quot;linear&quot;</span><span class="p">,</span> <span class="s2">&quot;precession&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    <span class="n">ephemeris_obj1</span><span class="o">.</span><span class="n">plot_delta_bic_omit_one</span><span class="p">(</span><span class="s2">&quot;quadratic&quot;</span><span class="p">,</span> <span class="s2">&quot;precession&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

    <span class="n">ephemeris_obj1</span><span class="o">.</span><span class="n">plot_running_analytical_delta_bic_quadratic</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

    <span class="c1"># STEP 10: Get observing schedule</span>
    <span class="c1"># ephemeris_obj1._get_eclipse_duration(&quot;TrES-3 b&quot;)</span>
    <span class="c1"># observer_obj = ephemeris_obj1.create_observer_obj(timezone=&quot;US/Mountain&quot;, longitude=-116.208710, latitude=43.602,</span>
    <span class="c1">#                                                   elevation=821, name=&quot;BoiseState&quot;)</span>
    <span class="c1"># target_obj = ephemeris_obj1.create_target_obj(&quot;TrES-3&quot;)</span>
    <span class="c1"># obs_sch = ephemeris_obj1.get_observing_schedule(quad_model, &quot;US/Mountain&quot;, observer_obj, target_obj, 10, 2, &quot;2024-12-04&quot;, exoplanet_name=&quot;TrES-3&quot;)</span>

    <span class="c1"># TODO: Do timezone checks and stuff in observing sched </span>

    <span class="c1"># STEP 9: Running delta BIC plot</span>
    <span class="c1"># ephemeris_obj1.plot_running_delta_bic(model1=&quot;linear&quot;, model2=&quot;precession&quot;, save_plot=False)</span>
    <span class="c1"># plt.show()</span>

    <span class="c1"># nea_data = ephemeris_obj1._get_eclipse_system_params(&quot;WASP-12 b&quot;, ra=None, dec=None)</span>
    <span class="c1"># # nea_data = ephemeris_obj1._query_nasa_exoplanet_archive(&quot;WASP-12 b&quot;, select_query=&quot;pl_ratror,pl_orbsmax,pl_imppar,pl_orbincl&quot;)</span>
    <span class="c1"># print(nea_data)</span>
    <span class="c1"># print(np.arcsin(0.3642601363) * 0.3474 * 24)</span>
    <span class="c1"># ephemeris_obj1.plot_delta_bic_omit_one(outlier_percentage=5)</span>
    <span class="c1"># plt.show()lta_bic_omit_one(outlier_percentage=5)</span>
    <span class="c1"># plt.show()</span>
</pre></div>

            <div class="clearer"></div>
          </div>
        </div>
      </div>
    

      <div class="clearer"></div>
    </div>
    <div class="button_nav_wrapper">
        <div class="button_nav">
            <div class="left">
                
            </div>

            <div class="right">
                
            </div>
        </div>
    </div>


    <div class="footer" role="contentinfo">
    &#169; Copyright 2023, Boise State University.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 8.1.3.
    </div>

<p id="theme_credit">Styled using the <a href="https://github.com/piccolo-orm/piccolo_theme">Piccolo Theme</a></p>
  </body>
</html>